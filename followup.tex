\documentclass[10pt]{amsart}

\title[Commutative Character Sheaves]{Commutative Character Sheaves}
%with an application to geometric types for supercuspidal representations
\author{Clifton Cunningham}
\address{Department of Mathematics and Statistics, University of Calgary, 2500 University Drive Northwest, Calgary, AB, Canada, {T2N~1N4}.}
\email{cunning@math.ucalgary.ca}
\author{David Roe}
\address{Department of Mathematics, University of Pittsburgh, 301 Thackeray Hall, Pittsburgh, PA , United States, 15260.}
\email{roed.math@gmail.com}

\subjclass[2010]{14F05 (primary), 14L15 (secondary), 22E50 (tertiary)}
\keywords{character sheaves}

\usepackage{amssymb}
\usepackage{amsrefs}
% Fonts
\usepackage{mathrsfs}
% Enumitem
\usepackage{enumitem}
% Hyperrefs
\usepackage{hyperref}

\usepackage{tikz}
\usetikzlibrary{shapes,arrows,calc,matrix}
\usepackage{tikz-cd}

%%%%%%%%%%%%%%% THEOREM STYLES %%%%%%%%%%%%%%%
\theoremstyle{plain}
      \newtheorem{theorem}{Theorem}[section]
      \newtheorem*{theorem*}{Theorem}
      \newtheorem{proposition}[theorem]{Proposition}
      \newtheorem{lemma}[theorem]{Lemma}
      \newtheorem{corollary}[theorem]{Corollary}

      \theoremstyle{definition}
      \newtheorem{definition}[theorem]{Definition}

      %\theoremstyle{remark}
      \newtheorem{remark}[theorem]{Remark}
      \newtheorem{example}[theorem]{Example}
      
%%%%%%%%%%%%%%% RINGS AND GROUPS %%%%%%%%%%%%%%%
\newcommand{\FF}{{\mathbb{F}}}
\newcommand{\ZZ}{{\mathbb{Z}}}
\newcommand{\NN}{{\mathbb{N}}}
\newcommand{\CC}{{\mathbb{C}}}
\newcommand{\QQ}{{\mathbb{Q}}}
\newcommand{\RR}{{\mathbb{R}}}
\newcommand{\EE}{\mathbb{\bar Q}_\ell}
\newcommand{\OK}{\mathcal{O}_K}
\newcommand{\OL}{\mathcal{O}_L}
\newcommand{\OO}[1]{\mathcal{O}_{#1}}
\newcommand{\bFq}{\bar{k}}
\newcommand{\Fq}{k}
\newcommand{\Fqm}{k_m}
\newcommand{\EEx}{\EE^\times}
\newcommand{\ZEx}{\mathbb{\bar Z}_\ell^\times}
\newcommand{\Weil}[1]{\mathcal{W}_{#1}}
\newcommand{\m}{{\mathfrak{m}}}
%%%%%%%%%%%%%%% ALGEBRAIC GROUPS %%%%%%%%%%%%%%%
\newcommand{\Gm}[1]{\mathbb{G}_{\hskip-1pt\textbf{m},#1}}
\DeclareMathOperator{\GL}{GL}
\newcommand{\comp}{\Pi} % Component group
\newcommand{\G}{\textbf{G}}
%%%%%%%%%%%%%%% NAMED OPERATORS %%%%%%%%%%%%%%%
\DeclareMathOperator{\Gal}{Gal}
\newcommand{\Frob}[1]{\operatorname{Fr}_{#1}}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\Gr}{Gr}
\DeclareMathOperator{\Irrep}{Irrep}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Hh}{H}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\Nm}{Nm}
\DeclareMathOperator{\trace}{Tr}
\DeclareMathOperator{\obj}{obj}
\DeclareMathOperator{\mor}{mor}
\DeclareMathOperator{\Lang}{Lang}
\DeclareMathOperator{\image}{im}
\DeclareMathOperator{\Loc}{Loc}
\DeclareMathOperator{\Tot}{Tot}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\SL}{SL}
\DeclareMathOperator{\PGL}{PGL}
\newcommand{\gal}[1]{{\operatorname{Gal}\hskip-1pt\left( {\bar #1}/#1 \right)}}
\newcommand{\Spec}[1]{{\operatorname{Spec}(#1)}}
\newcommand{\op}{_{\operatorname{op}}}
\newcommand{\der}{_{\operatorname{der}}}
\newcommand{\ab}{_{\operatorname{ab}}}

%%%%%%%%%%%% MISCELLANEOUS OPERATORS %%%%%%%%%%%%
\newcommand{\sheafHom}{{\mathscr{H}\hskip-4pt{\it o}\hskip-2pt{\it m}}}
\newcommand{\abs}[1]{{\vert #1 \vert}}
\newcommand{\ceq}{{\, :=\, }}
\newcommand{\tq}{{\ \vert\ }}
\newcommand{\iso}{{\ \cong\ }}
\newcommand{\trFrob}[1]{t_{#1}}
\newcommand{\TrFrob}[1]{\operatorname{Tr}_{#1}}
%% Limits
\newcommand{\invlim}[1]{\lim\limits_{\overleftarrow{#1}}}
\newcommand{\dirlim}[1]{\lim\limits_{\overrightarrow{#1}}}
\newcommand{\limit}[1]{\mathop{\textsc{lim}}\limits_{#1}}
\newcommand{\colimit}[1]{\mathop{\textsc{colim}}\limits_{#1}}
%% Fonts for quasicharacter sheaves
\newcommand{\cs}[1]{{\mathcal{#1}}}
\newcommand{\gcs}[1]{{\mathcal{\bar #1}}}
\newcommand{\dualgcs}[1]{\gcs{#1}^\dagger}
\newcommand{\dualcs}[1]{\cs{#1}^\dagger}
%% Categories
\newcommand{\CS}{{\mathcal{C\hskip-0.8pt S}}}
\newcommand{\CCS}{{\mathcal{C\hskip-.8pt C\hskip-0.8pt S}}}
\newcommand{\bCS}{{\CS_0}}
\newcommand{\catname}[1]{\normalfont{\textsf{#1}}}
\newcommand{\Sch}[1]{{\catname{Sch}_{/#1}}}
\newcommand{\QCS}{{\mathcal{QC\hskip-0.8pt S}}}
\newcommand{\CSiso}[1]{\CS(#1)_{/\text{iso}}}
\newcommand{\bCSiso}[1]{\bCS(#1)_{/\text{iso}}}
\newcommand{\QCSiso}[1]{\QCS(#1)_{/\text{iso}}}
\newcommand{\CCSiso}[1]{\CCS(#1)_{/\text{iso}}}
%% Labeled items
\makeatletter
\newcommand{\labitem}[2]{
\def\@itemlabel{\textbf{#1}}
\item
\def\@currentlabel{#1}\label{#2}}
\makeatother
%% Shorthand for bars
\renewcommand{\bf}{\bar{f}}
\newcommand{\bg}{{\bar{g}}}
\newcommand{\bm}{\bar{m}}
\newcommand{\bG}{\bar{G}}
\newcommand{\bH}{\bar{H}}
\newcommand{\brho}{{\bar\rho}}
\newcommand{\bx}{{\bar{x}}}
%% Spacing control
\newcommand{\tight}[3]{\hspace{-#1pt}{#2}\hspace{-#3pt}}
\newcommand{\GxG}{\text{$G \tight{1}{\times}{1} G$}}
\newcommand{\bGxG}{\text{$\bar{G} \tight{1}{\times}{1} \bar{G}$}}
\newcommand{\bfxf}{\text{$\bar{f} \tight{1}{\times}{1} \bar{f}$}}
\newcommand{\GxxG}{\text{$G \tight{1}{\times}{1} G$}}
\newcommand{\LxL}{\text{$\gcs{L} \tight{0}{\boxtimes}{0} \gcs{L}$}}

%% Hyphenation override
\hyphenation{quasi-character}

%%%%%%%%%%%% BEGIN DOCUMENT %%%%%%%%%%%
\usepackage{todonotes}

\begin{document}

\begin{abstract}
We introduce and establish the basic properties of  the category of \emph{commutative character sheaves} on smooth group schemes $G$ over finite fields $\Fq$. 
We use this category to geometrize all generic types for supercuspidal representations of $p$-adic groups. 
\end{abstract}

\maketitle

\tableofcontents

\section*{Introduction}
We introduce and establish the basic properties of  the category of \emph{commutative character sheaves} on smooth group schemes $G$ over finite fields $\Fq$. 
Expanding on work by the same authors, we show that all character sheaves on $G\ab$ are commutative, when $G\ab$ is connected and of finite type.
We give three applications.
First, we use commutative character sheaves to produce a functorial geometrization of characters of $G(\Fq)$ in all cases, thus repairing a defect in the function-sheaf dictionary for algebraic groups $G$ which appears when the component group of $G$ is $\Hh^2(\pi_0(\bG),\EEx)^{\Frob{}}$ is non-trivial. 
Second, we revisit the motivations for the stacky abelianization construction, and show that, after replacing the rank-$1$ character sheaves on $G$ with commutative character sheaves on $G$, the schematic abelianization $G \to G\ab$ is the correct quotient.
This is an immediate consequence of the fact that the category of commutative character sheaves on $G$ is equivalent to the category of commutative character sheaves on $G\ab$. 
Finally, we provide a geometrization of generic types for supercuspidal representations of connected reductive linear algebraic groups over local fields.
This last application puts all the ingredients needed to parametrize supercuspidal representations of arbitrary depth in the same category: perverse sheaves on group schemes over finite fields.




Fragments: 
The additional condition distinguishing which character sheaves on $G$ are commutative, has several benefits, as we will see in this note.
\begin{enumerate}
\labitem{(1)}{b1}
A character sheaf $\cs{L}$ on $G$ is invisible if and only if $\cs{L}$ is not commutative.
Recall from \cite{cunningham-roe:13a}*{Def. 2.8} that a character sheaf $\cs{L}$ in $G$ is {\it invisible} if $\cs{L}  \ncong \EE$ yet $\trFrob{\cs{L}} =1$.
These are exactly the non-trivial character sheaves in the kernel of the surjective group homomorphism 
\[
\TrFrob{G} : \CSiso{G} \to G(\Fq)^*
\]
 given by the trace of Frobenius.
\labitem{(2)}{b2}
This note shows that $\TrFrob{G} : \CSiso{G} \to G(\Fq)^*$ admits a canonical section, and thus a splitting of the short exact sequence 
\[
\begin{tikzcd}
0 \arrow{r} & \Hh^2(\pi_0(\bG),\EEx)^{\Weil{}} \arrow{r} & \CSiso{G} \arrow{r}{\TrFrob{G}} & G(\Fq)^* \arrow{r} & 0
\end{tikzcd}
\]
found in \cite{cunningham-roe:13a}*{Thm. 3.6}.
\labitem{(3)}{b3}
Like the category $\CS(G)$ of character sheaves on $G$, which is described completely in \cite{cunningham-roe:13a}, $\CCS(G)$ is a rigid monoidal category.
Since $\CCS(G)$ is a full subcategory of $\CS(G)$, and since Item \ref{b2} above shows $\CCSiso{G} \iso G(\Fq)^*$, canonically, the category $\CCS(G)$ is now completely described by the following consequence of \cite{cunningham-roe:13a}*{Thm. 3.9}: in $\CCS(G)$, every morphism $\cs{L} \to \cs{L}'$ is either trivial (zero on stalks) or and isomorphism, and
\[
\Aut(\cs{L}) \iso  \Hh^1(\pi_0(\bG), \EEx)^{\Weil{}}.
\]
Consequently, we have a complete description of category $\CCS(G)$.
\end{enumerate}




\section{Recollections and definitions}

Let $G$ be a smooth group scheme over a finite field $\Fq$; that is, let $G$ be a group scheme over $\Fq$
for which the structure morphism $G \to \Spec{\Fq}$ is smooth in the sense of [include reference for this definition].
This implies $G \to \Spec{\Fq}$ is locally of finite type, but not that it is of finite type.
We remark that the identity component $G^0$ of $G$ is of finite type over $\Fq$, while the component group scheme
$\pi_0(G)$ of $G$ is an \'etale group scheme over $\Fq$, and both are smooth over $\Fq$.


In this paper we use a common formalism for Weil sheaves, writing $\cs{L}$ for the pair $(\gcs{L},\phi)$ and writing $\alpha : \cs{L} \to \cs{L}'$ for a morphism $\alpha : \gcs{L} \to \gcs{L}$ such that 
\[
\begin{tikzcd}
\Frob{}^* \gcs{L} \arrow{d}{\phi} \arrow{r}{\Frob{}^*\alpha} &  \Frob{}^* \gcs{L} \arrow{d}{\phi'}\\
\gcs{L} \arrow{r}{\alpha} & \gcs{L}
\end{tikzcd}
\]
commutes, where $\cs{L}'$ refers to $(\gcs{L}',\phi')$.
While this simplifies notation considerably, it is, unfortunately, not consistent with our earlier paper.



\subsection{Main definition}

Let $\theta : G\times G \to G\times G$ be given by $\theta(g,h) = (h,g)$.
Write $m : G \times G \to G$ for the multiplication morphism
and define $m\op : G \times G \to G$ by $m\op = m \circ \theta$.
For any Weil local system $\cs{L}$ on $G$ there is an isomorphism
$\vartheta : \cs{L}\boxtimes\cs{L} \to \theta^*(\cs{L}\boxtimes\cs{L})$ given on stalks by the canonical map
$\gcs{L}_{g} \otimes \gcs{L}_{h} \to \gcs{L}_{h} \otimes \gcs{L}_{g}$.


When $G$ is commutative, recall \cite{cunningham-roe:13a}*{Def. 1.1} that a character sheaf on $G$ is a triple $(\gcs{L}, \mu, \phi)$,
where $\gcs{L}$ is a rank-one $\ell$-adic local system on $\bG$, 
$\mu : \bm^* \gcs{L} \to \LxL$ is an isomorphism
of sheaves on $\bG \times \bG$, 
and $\phi : \Frob{G}^* \gcs{L} \to \gcs{L}$ is an isomorphism of sheaves on $\bG$;
the triple $(\gcs{L}, \mu, \phi)$ must also satisfy compatibility conditions specified in \cite{cunningham-roe:13a}*{Def. 1.1}.
Writing $\cs{L}$ for the Weil local system $(\gcs{L}, \mu, \phi)$, these compatibility conditions are simply this: $\mu : m^*\cs{L} \to \cs{L}\boxtimes\cs{L}$ is an isomorphism of Weil local systems.
The category of character sheaves on $G$ is denoted by $\CS(G)$.

The definition of $\CS(G)$ also makes sense for non-commutative $G$.  
In order to distinguish the resulting objects from
the character sheaves of Lusztig, we will refer to the former as \emph{linear character sheaves} (to evoke the one-dimensional character sheaves of \cite{Kamgarpour})
and again write $\CS(G)$ for the resulting category, with morphisms defined as in \cite{cunningham-roe:13a}*{Def. 1.1}.

\begin{definition}\label{def:CCS}
A linear character sheaf on $G$ is a \emph{commutative character sheaf} if there is an isomorphism $m^* \cs{L} \to m\op^* \cs{L}$ of local systems on $G\times G$ such that the following diagram commutes.
  \[
  \begin{tikzcd}[row sep=30]
   m^*\cs{L} \arrow{d} \arrow{r}{\mu} & \cs{L}\boxtimes\cs{L} \arrow{d}{\vartheta}\\
   m\op^*\cs{L} \arrow{r}{{\theta}^*\mu} &  {\bar \theta}^*(\cs{L}\boxtimes\cs{L})
  \end{tikzcd}
  \]
We write $\CCS(G)$ for the full subcategory of $\CS(G)$ consisting of commutative character sheaves.
 \end{definition}


\begin{lemma}
If the isomorphism $m^* \cs{L} \to m\op^* \cs{L}$ exists and satisfies the condition of Definition~\ref{def:CCS}, then it is unique.
\end{lemma}

\begin{proof}
Why is this true?
\end{proof}

\section{Eliminating Invisible Character Sheaves}\label{sec:defect}

If $M$ is a $\bG$-module, then we say a cohomology class in $\Hh^2(\bG, M)$ is \emph{symmetric} if it is represented
by a symmetric $2$-cocycle.  Since every coboundary is symmetric, either all cocycles in a given class will be symmetric
or none will.

\begin{lemma} \label{lem:symtriv}
Let $\bG$ be a commutative group.  Then the only symmetric class in $\Hh^2(\bG, \EEx)$ is the trivial class.
\end{lemma}

\begin{proof}
By the universal coefficient theorem,
\[
0 \to \Ext^1_\ZZ(\Hh_{n-1}(\bG, \ZZ), \EEx) \to \Hh^n(\bG, \EEx) \to \Hom(\Hh_n(\bG, \ZZ), \EEx) \to 0
\]
for all $n > 0$.  When $n = 2$, using the fact that $\bG$ is commutative, we have that $\Hh_1(\bG, \ZZ) \cong \bG$
and that $\Hh_2(\bG, \ZZ) \cong \wedge^2 \bG$. We get
\[
0 \to \Ext^1_\ZZ(\bG, \EEx) \to \Hh^2(\bG, \EEx) \to \Hom(\wedge^2 \bG, \EEx) \to 0.
\]
The map $\Hh^2(\bG, \EEx) \to \Hom(\wedge^2 \bG, \EEx)$ maps a $2$-cocycle $f$ to the alternating function
\[
(x,y) \mapsto \frac{f(x,y)}{f(y,x)}.
\]
Thus the cohomology classes represented by symmetric cocycles are precisely those in the image of $\Ext^1_\ZZ(\bG, \EEx)$.
But $\Ext^1_\ZZ(-, \EEx)$ vanishes because $\EEx$ is divisible.
\end{proof}

For a character sheaf $\cs{L}$ on $G$, recall from \cite{cunningham-roe:13a}*{\S 2.3} that $S_G : \CSiso{G} \to \Hh^2(E_G^\bullet)$ maps
$[\cs{L}]$ to $[\alpha \oplus \beta]$, where $E_G^\bullet$ is the total space of the zeroth page
of the Hochschild-Serre spectral sequence, $\alpha \in C^0(\Weil{}, C^2(\bG, \EEx))$ is obtained from $\mu$ and
$\beta \in C^1(\Weil{}, C^1(\bG, \EEx))$ is obtained from $\phi$.

\begin{lemma} \label{lem:conncomm}
If $G$ is a connected commutative algebraic group over $\Fq$ then every character sheaf on $G$ is commutative.
\end{lemma}

\begin{proof}
We can use \'etale descent to see that pullback by the Lang isogeny defines an equivalence
of categories between local systems on $G$ and $G(\Fq)$-equivariant local systems on $G$.  Thus every character
sheaf on $G$ arises through the Lang isogeny; since the covering group is $G$ itself, which is commutative,
every character sheaf on $G$ is commutative.
\end{proof}

\begin{theorem} \label{thm:trfrobiso}
If $G$ is a smooth commutative group scheme over $\Fq$ then $\TrFrob{G} : \CCSiso{G} \to G(\Fq)^*$ is an isomorphism.
\end{theorem}

\begin{proof}
Suppose first that $G$ is \'etale.  Consider the isomorphism of short exact sequences
\[
\begin{tikzcd}
 0 \arrow{r} & \ker \TrFrob{G} \arrow{d} \arrow{r} & \CSiso{G}\arrow{d}{S_G} \arrow{r}{\TrFrob{G}} \arrow{r} & G(\Fq)^* \arrow{d} \arrow{r} & 0\\
  0 \arrow{r} & \Hh^0(\Weil{},\Hh^2(\bG,\EEx)) \arrow{r} & \Hh^2(E^\bullet_G) \arrow{r} & \Hh^1(\Weil{},\Hh^1(\bG,\EEx)) \arrow{r} & 0
 \end{tikzcd}
 \]
from \cite{cunningham-roe:13a}*{Prop. 2.7}.

Suppose that $\cs{L}$ is a commutative character sheaf
with $\trFrob{\cs{L}} = 1$.  Then $S_G([\cs{L}])$ is in the image of $\Hh^2(\bG, \EEx)^\Weil{}$, so is cohomologous to
$[\alpha', 0]$.  Since $\alpha$ is symmetric and coboundaries are symmetric, $\alpha'$ is symmetric as well.
So by Lemma \ref{lem:symtriv}, $\alpha'$ is cohomologically trivial, and thus $[\cs{L}]$ is trivial as well.

To see that $\TrFrob{G}$ is still surjective on $\CCSiso{G}$, note that the character sheaf constructed in the proof of
\cite{cunningham-roe:13a}*{Prop. 2.6} has trivial $\alpha$, and is thus commutative.

For general smooth commutative group schemes, we use Lemma \ref{lem:conncomm} and the snake lemma.
\end{proof}

\begin{remark}
Since $\Hh^0(\Weil{},\Hh^2(\bG,\EEx))$ is not necessarily trivial \cite{cunningham-roe:13a}*{Ex. 2.10}, the functor
$\CCS(G) \to \CS(G)$ is not an equivalence of categories in general.
\end{remark}


\section{Descent to the Abelianization}

\subsection{Derived subgroup and abelianization}

Let $G$ be a smooth group scheme.
Let $G\der \hookrightarrow G$ denote the closed subgroup generated by the smooth morphism $G\times G \to G$ given by $(x,y)\mapsto xyx^{-1}y^{-1}$. Then $G \times G \to G\der$ is a dominant morphism \cite{SGA3}*{{VI}$_B$, 7.2}
and $G$ is commutative if and only if $G\der$ is trivial.

While the subgroup $G\der$ is smooth, it need not be connected. The restriction of $G\times G\to G\der$ to identity components gives a dominant morphism $G^0\times G^0 \to G^0\der$ by [SGA3, Tome 6B, Expos\'e 7, Prop 7.8]


The quotient $G\ab\ceq G/G\der$ exists in schemes over $\Fq$ by SGA3, Expos\'e VI, Tome B, Th\'eor\`eme 3.2, which also shows that the quotient $G \to G\ab$ is a faithfully flat and a $G$-torsor in the fppf topology.
\[
\begin{tikzcd}
{} & G\times G \arrow{d}{} &&&\\
1 \arrow{r} & G\der \arrow{r}{} & G \arrow{r}{q} & G\ab \arrow{r} & 1
\end{tikzcd}
\]
 
 \subsection{Statement of the main result}


As in [CS], every morphism of group schemes $G \to G'$ induces . .  
 
Another hypothesis: suppose the smooth morphism $G\times G\to G\der$ is of relative dimension on each connected component of its image in $G\der$.\todo{This is another condition on $G$. Does it come from smoothness of $G$?}

\begin{theorem}\label{thm:Gab}
Under these hypotheses, pull-back along the abelianization $q : G \to G\ab$
\[
q^* : \CCS(G\ab) \to \CCS(G)
\]
is an equivalence of categories.
\end{theorem}


Theorem~\ref{thm:Gab} will be proved by factoring $\CCS(G\ab) \to \CCS(G\ab)$ according to the following diagram, which will be explained below, 
and by showing that each functor is an equivalence.
\[
\begin{tikzcd}
 \CCS(G)  &&& \arrow{lll}[swap]{q^*}  \CCS(G\ab) \arrow{d}{\text{Descent along torsor}} \\
\CCS_G(G)  \arrow{u}{\text{Equivariance}} &&& \arrow{lll}{\text{Change of Action}} \CCS_{G\der}(G) 
\end{tikzcd}
\]

\begin{remark}
Theorem~\ref{thm:Gab} provides an indication that $\CCS(G)$ is the correct category in which to geometrize characters of $G(\Fq)$. 
By contrast, $\CS(G)$ and $\CS(G\ab)$ are generally not isomorphic categories, not even when $G$ is a connected reductive algebraic group and $\Hh^1(\Fq,G\der)=0$, as we will see in Section~\ref{sec:stacky}.
\end{remark}

\subsection{Equivariance}

We wish to consider the categories $\CCS_G(G)$ (resp $\CS_G(G)$) of $G$-equivariant commutative character sheaves (linear character sheaves) on $G$. To that end, in this section we introduce that notion in its general context.

Let $G$ and $H$ be group schemes; let $n : H \times G\to G$ be a group action and write $p : H\times G \to G$ for projection. 
An $H$-equivariant Weil local sytem on $G$ is a Weil local system $\cs{L}$ on $G$ together with an isomorphism  $\nu : n^*\cs{L} \to p^*\cs{L}$ of Weil local systems on $G\times G$ such that the following diagram commutes,
\[
\begin{tikzcd}
\ &  n_0^*  n^*\, \mathcal{L} \arrow{r}{n_0^*\nu} & n_0^* p^*\, \mathcal{L} & \\
n_1^* n^*\, \mathcal{L} \arrow{dr}[swap]{n_1^*\nu} \arrow[equal]{ur} &&& \arrow[equal]{ul}  \arrow{dl}{p_2^*\nu} p_2^* n^*\, \mathcal{L} \\
& n_1^* p^*\, \mathcal{L} \arrow[equal]{r} & p_2^* p^*\, \mathcal{L}, & 
\end{tikzcd}
\]
where $n_0(a,b,x) = (a,n(b,x))$ and $n_1(a,b,x) = (n(ab),x)$ and $p_2(a,b,x) = (b,x)$.
Morphisms of $H$-equivariant Weil local systems are morphisms of Weil local systems $\alpha: \cs{L}\to \cs{L}'$ for which . . .

An $H$-equivariant linear character sheaf on $G$ is a triple $(\cs{L},\mu, \nu)$ where $(\cs{L},\mu)$ with no condition tying $\mu$ and $\nu$ together.
Write $\CS_H(G)$ for the category of $H$-equivariant linear character sheaves on $G$.\todo{Under construction}

Finally, an $H$-equivariant commutative character sheaf on $G$ is an $H$-equivariant linear character sheaf $(\cs{L},\mu, \nu)$ for whuch 

\begin{lemma}\label{lem:equivariant}
Categories $\CCS(G)$ and $\CCS_G(G)$ are equivalent.
\end{lemma}

\begin{proof}
Let $a : G \times G \to G$ be the conjugation action of $G$ on $G$ and let $p : G \times G \to G$ be projection to the second factor.
Then $a = m \circ (m \times (\iota \circ p_1))$ while $m\op \circ (m \times (\iota \circ p_1)) = p$;
likewise, $m = a \circ (p_1\times m\op)$ while $p \circ (p_1\times m\op) = m\op$.

Let $(\cs{L},\mu)$ be a commutative character sheaf on $G$.
Let $c: m^*\cs{L} \to m\op^*\cs{L}$ be an isomorphism satisfying the condition of Definition~\ref{def:CCS}. Then
\begin{align*}
a^* \cs{L} 
&= (m \circ (m \times (\iota \circ p_1)))^* \cs{L}\\
&= (m \times (\iota \circ p_1))^* m^* \cs{L}\\
&\iso (m \times (\iota \circ p_1))^* m\op^* \cs{L}\\
&= (m\op \circ (m \times (\iota \circ p_1)))^* \cs{L}\\
&= p^*\cs{L}.
\end{align*}
The isomorphism above is 
\[
(m \times (\iota \circ p_1))^* c: a^*\cs{L} \to p^*\cs{L},
\]
 so $(\cs{L}, (m \times (\iota \circ p_1))^* c)$ is a $G$-equivariant commutative character sheaf.

 
Let $(\cs{L}, \nu)$ be an equivariant linear character sheaf.
Then
\begin{align*}
m^* \cs{L} 
&= (a \circ (p_1 \times m\op))^* \cs{L}\\
&= (p_1 \times m\op)^* a^* \cs{L}\\
&\iso (p_1 \times m\op)^* p^* \cs{L}\\
&= (p\circ (p_1 \times m\op))^* \cs{L}\\
&= m\op^* \cs{L}.
\end{align*}
The isomorphism above is
\[
(p_1 \times m\op)^* \nu : m^* \cs{L}  \to m\op^* \cs{L},
\]
so $(\cs{L},\mu)$ is a commutative character sheaf.
\todo{This proof is under construction.}
\end{proof}



\begin{remark}
Lemma~\ref{lem:equivariant} shows that the `canonical functor' $\CCS(G) \to \CS(G)$ is a forgetful functor and also provides an alternate characterization of commutative character sheaves as linear (rank-$1$), multiplicative ($\mu$) and conjugation-equivariant ($\nu$) Weil local systems ($\phi$) on $\bG$. [Is this correct?]
\end{remark}


\subsection{Descent along torsors}

Let $G$ be a $k$-group scheme and let $H \to G$ be a closed subgroup scheme over $S$.


Write $n : H \times_S G \to G$ for the left action of $H$ on $G$; let $p : H\times_S G \to G$ be projection.


We now suppose that $H$ is normal in $G$ and that the fppf-quotient $G \to G'\ceq H\backslash G$ exists in group schemes over $\Fq$.
Then $q : G \to G'$ is a regular epimorphism with kernel pair $(n,p)$ in the category of schemes.
\[
\begin{tikzcd}
H\times G
 \arrow{r}[shift left]{n}
  \arrow{r}[shift right,swap]{p}
&
G 
\arrow{r}{q}
& 
G'
\end{tikzcd}
\]
%In particular, $G \times_{G'} G \iso H\times_S G'$, so $G \to G'$ is a $G$-torsor in the fppf topology.
In this case we may factor the functor $\CCS(G') \to \CCS(G)$  . . . 
\[
\begin{tikzcd}
\CCS(G) &&\arrow{ll}[swap]{q^*} 
\CCS(G') \arrow{dl}{\text{`comparison'}}\\
& \arrow{ul}{\text{forget}} \CCS_{H}(G) & 
\end{tikzcd}
\]

\begin{lemma}\label{lem:descent}
The comparison functor $\CCS(G') \to \CCS_{H}(G)$ is an equivalence.
\end{lemma}  
  
\begin{proof}
By descent theory, the functor $\Loc(G') \to \Loc_H(G)$ induced by $q: G \to G'$ is an equivalence of categories. Expand . . . 
\todo{Need to study the extra structure coming with character sheaves.}

%Let $j : C \hookrightarrow G$ be the kernel of $q : G \to G\ab$ and let $m : G\times G \to G$ be multiplication for $G$. 
Let $n : G\der \times G \to G$ be the restriction of $m: G\times G \to G$.
Then $n = m \circ (j \times \id)$, so
\begin{align*}
n^* \cs{L} 
&= (m \circ (j \times \id))^* \cs{L}\\
&= (j \times \id))^* m^*\cs{L}\\
&\iso (j \times \id))^* (\cs{L} \boxtimes \cs{L})\\
&= (j^*\cs{L}) \boxtimes \cs{L}\\
&= (\cs{L}\vert_C) \boxtimes \cs{L}\\
&= (\EE)_C \boxtimes \cs{L}\\
&= p^* \cs{L}.
\end{align*}
Thus, every commutative character sheaf $\cs{L}$ on $G$ is $G\der$-equivariant.
It now follows from Lemma~\ref{lem:Lder} that the forgetful functor $\CCS_{G\der}(G) \to \CCS(G)$ is an equivalence. 
\end{proof}


\subsection{Change of action}

\[
\begin{tikzcd}
\arrow{dd}[swap]{f} G_1 \times G \arrow{dr}[swap]{a_1}{p} & \\
& G \\
G_2 \times G \arrow{ur}{a_2}[swap]{p} & 
\end{tikzcd}
\]

\begin{lemma}\label{lem:action}
The canonical functor
\[
\CS_{G_2}(G) \to \CS_{G_1}(G)
\]
is an equivalence if $f$ is dominant and  smooth of relative dimension on the connected components in its image.
\end{lemma}
\begin{proof}
\end{proof}

\subsection{Proof of the main result}

\begin{proof}[Proof of Theorem~\ref{thm:Gab}]
First we must see that $q^*$ factors according to . . . 
\[
\begin{tikzcd}
 \CCS(G)  &&& \arrow{lll}[swap]{q^*}  \CCS(G\ab) \arrow{d}{\text{Lem~\ref{lem:descent}}} \\
\CCS_G(G)  \arrow{u}{\text{Lem~\ref{lem:equivariant}}} &&& \arrow{lll}{\text{Lem~\ref{lem:action}}} \CCS_{G\der}(G) 
\end{tikzcd}
\]
\end{proof}

\begin{lemma}\label{lem:Lder}
If $\cs{L}\in \CCS(G)$ then $\cs{L}\vert_{G\der} \iso (\EE)_{G\der}$.
% Suppose Z(G) = 1$. If $\cs{L}\in \CS(G)$ and $\cs{L}\vert_{G\der} \iso (\EE)_{G\der}$ then $\cs{L}\in \CCS(G)$. 
\end{lemma}

\begin{proof}
By construction, $c : G \times G \to G\der$ is dominant. 
Note that $j\circ c = m\circ (m \times (\iota\circ m\op)) : G \times G \to G$ is $(g,h) \mapsto gh g^{-1}h^{-1}$ while $m\op\circ (m \times (\iota\circ m\op))= e : G \times G \to G$ is $(g,h) \mapsto 1_G$. 
Pick $\cs{L}\in \CCS(G)$. 
Then
\begin{align*}
c^* (\cs{L}\vert_{G\der})
&=  (j\circ c)^*\cs{L} \\
&= (m\circ (m \times (\iota\circ m\op)))^* \cs{L} \\
&= (m \times (\iota\circ m\op))^* m^* \cs{L} \\
&\iso (m \times (\iota\circ m\op))^* m\op^* \cs{L} \\
&= (m\op\circ (m \times (\iota\circ m\op)))^* \cs{L} \\
&= e^* \cs{L}\\
&= (\EE)_{G\times G}.
\end{align*}
Since $c : G \times G \to G\der$ is schematically dense, $c^* (\cs{L}\vert_{G\der}) \iso (\EE)_{G\times G}$ implies $\cs{L}\vert_{G\der} \iso (\EE)_{G\der}$ by Lemma~\ref{lem:dominant}.

%Now, suppose $Z(G) =1$. Pick $\cs{L}\in \CS(G)$ and suppose $\cs{L}\vert_{G\der} \iso (\EE)_{G\der}$.
\end{proof}

\section{Geometrization of linear characters}


 \begin{corollary}
 If $\Hh^1(\Fq,G\der)=0$ then
the following diagram of isomorphisms commutes.
\[
\begin{tikzcd}
\CCSiso{G} \arrow{r} & G(\Fq)^*\\
\arrow{u}{q^*} \CCSiso{G\ab} \arrow{r} & \arrow{u} G\ab(\Fq)^* 
\end{tikzcd}
\]
 \end{corollary}
 
 \begin{proof}
 By Theorem \ref{thm:trfrobiso}, $\CCSiso{G}\to G(\Fq)^*$ and $\CCSiso{G\ab}\to G\ab(\Fq)^*$ are isomorphisms.
By Theorem~\ref{thm:Gab}, $\CCSiso{G} \iso \CCSiso{G\ab}$.
Since $\Hh^1(\Fq,G\der)=0$, we have  $G\ab(\Fq) = G(\Fq)/G\der(\Fq)$.
Thus, all characters of $G(\Fq)$ factor through
 $G\ab(\Fq)$. . . . 
 The isomorphisms are compatible because  . . . 
 \end{proof}


\section{Stacky abelianization, revisited}\label{sec:stacky}
 
 Talk about relationship with \cite{kamgarpour:09a}.  In particular, explain why the rank-$1$ character sheaf corresponding
 to the cover
 \[
 1 \to \mu_n \to \SL_n \to \PGL_n \to 1
 \]
 is not commutative.  
 %Explain how our character sheaves are not just representations of a fundamental group (or are they?), but instead have extra data like $\mu$ and $\phi$.
%\todo{I got this wrong. I think our sheaves are not extra information in the commutative case. Masound's definition is designed to match the definition coming from central extensions, while we have one that matches Ext1 in Ab, in the connected case. So, I think the modification is easy: add mop to diagram 2.4 in Masoud's paper. \\ -CC}

\section{Applications to supercuspidal representations}

\subsection{Commutative quasicharacter sheaves}

Let $K$ be a local field with residue field $\Fq$.
Let $\underline{G}$ be a smooth group scheme over $K$.
Set $G_n = \Gr^R_n(\underline{G})$; this is a smooth group scheme over $\Fq$.
Set $G = \Gr_R(\underline{G})$; this is a group scheme over $\Fq$ equipped with $G = \varprojlim_{n\in \NN} G_n$.
Let $\QCS(G)$ be the category of commutative character sheaves on $G$. . . .  as in \cite{cunningham-roe:13a}.

\begin{proposition}\label{prop:QCS}
$\Hom(\underline{G}(\OK),\EEx) \iso \QCSiso{G}$.
\end{proposition}

 \subsection{Geometric types for supercuspidal representations}


As proved in \cite{kim:07a}, many (complex) supercuspidal representations of $p$-adic groups can be built from the generic data of \cite{yu:01a}*{\S 15} and, moreover, the type (in the sense of \cite{bushnell-kutzko:98a}) of the resulting supercuspidal representations can be constructed directly from the generic data. 
Let us refer to the types arising in this manner as {\it generic types}.
In this section we show that, after fixing an isomorphism $\CC \approx \EE$, every generic type is geometrizable, in the sense that every part of generic type admits a description as a perverse sheaf, from which the type can be recovered.

Let $K$ be a $p$-adic field. Let $\G$ be a connected reductive linear algebraic group over $K$. 
A generic datum is a triple $(\vec{\G}, \pi_0, \vec{\phi})$ where: $\vec{\G}$ is a tower of $p$-adic groups $\G^0(K) \subset \G^1(K) \subset \cdots  \subset \G^d(K) = \G(K)$ (proper containment); $\pi_0$ is a depth-zero representation of $\G^0(K)$, and $\vec{\phi} = (\phi_0, \ldots , \phi_{d-1})$ where each $\phi_i : \G^i(K) \to \EEx$ is a quasicharacter (continuous group homomorphism).  

%The generic datum $(\vec{\G}, \pi_0, \vec{\phi})$ determines a type (in the sense of \cite{bushnell-kutzko:98a}) $(C, \rho)$ for $\G$, as explained in \cite{yu:construction}*{\S 15}, where $C \subset \G(K)$ is compact mod centre subgroup and $\rho$ is a representation of $C$. In \cite{yu:smooth} it is shown that the $C$ admits a smooth integral model, in the sense that there is a smooth group scheme $\underline{C}$ over $\OK$ such that $\underline{C}(\OK) = C$.

In \cite{yu:03a} it is shown that, for $0 \leq i < d$, the $p$-adic group $\G^i(K)$ admits a smooth integral model, in the sense that there is a smooth group scheme $\underline{G}^i$ over $\OK$ such that $\underline{G}^i(\OK) = \G^i(K)$.
Set $G^i_n \ceq \Gr^R_n(\underline{G}^i)$ and $G^i \ceq \Gr_R(\underline{G}^i)$; 
then \[G^i(\Fq) = \G^i(K)\] (canonical isomorphism of groups).
In this way, $\vec{\G}$ determines a tower $\vec{G}$ of group schemes $G^0 \subset G^1 \subset \cdots  \subset G^{d-1}$ (proper containment) over $\Fq$, from which the tower of $p$-adic groups
$\G^0(K) \subset \G^1(K) \subset \cdots  \subset \G^{d-1}(K)$ can be recovered.

Using Corollary~\ref{cor:QCS} we see that each quasicharacter $\phi_i : G^i(\Fq) \to \EEx$ determines a quasicharacter sheaf $\cs{L}^i$, unique up to isomorphism, from which the quasicharacter $\phi_i$ can be recovered using the trace of Frobenius. 
In fact, more is true. Let $n_{\phi_i}$ be the smallest non-negative integer $n$ such that $\phi_i : G^i(\Fq) \to \EEx$ factors through $G^i(\Fq) \to G^i_n(\Fq)$.
Then $\phi_i$ determines a commutative character sheaf $\cs{L}_{n_{\phi_i}}^i$, unique up to isomorphism, from which the quasicharacter $\phi_i$ can be recovered.
Then $\cs{A}_i\ceq \cs{L}_{n_{\phi_i}}^i[\dim G_{n_{\phi_i}}^i]$ is a perverse sheaf on $G_{n_{\phi_i}}^i$ from which the quasicharacter $\phi_i$ can be recovered.
In this way,  $\vec{\phi} = (\phi_0, \ldots , \phi_{d-1})$ determines perverse sheaves $\vec{\cs{A}} = (\cs{A}_0, \ldots , \cs{A}_{d-1})$ from which $\vec{\phi}$ can be recovered. 

Finally, consider the depth-zero supercuspidal representation $\pi_0$ of $\G^0(K)$.
Then $\pi_0$ is produced by compact induction from representation $\sigma$ of a compact mod centre subgroup $\underline{C}_0(\OK) \subset \G^0(K)$. Moreover, $C_0$ admits a smooth integral model $\underline{C}$ ...

\subsection{Toral supercuspidal representations of $p$-adic groups}



\bibliography{bibliography/Biblio}

\end{document}