\documentclass[10pt]{amsart}

\title[Commutative Character Sheaves]{Commutative Character Sheaves}
%with an application to geometric types for supercuspidal representations
\author{Clifton Cunningham}
\address{Department of Mathematics and Statistics, University of Calgary, 2500 University Drive Northwest, Calgary, AB, Canada, {T2N~1N4}.}
\email{cunning@math.ucalgary.ca}
\author{David Roe}
\address{Department of Mathematics, University of Pittsburgh, 301 Thackeray Hall, Pittsburgh, PA , United States, 15260.}
\email{roed.math@gmail.com}

\subjclass[2010]{14F05 (primary), 14L15 (secondary), 22E50 (tertiary)}
\keywords{character sheaves}

\usepackage{amssymb}
\usepackage{amsrefs}
% Fonts
\usepackage{mathrsfs}
% Enumitem
\usepackage{enumitem}
% Hyperrefs
\usepackage{hyperref}

\usepackage{tikz}
\usetikzlibrary{shapes,arrows,calc,matrix}
\usepackage{tikz-cd}

%%%%%%%%%%%%%%% THEOREM STYLES %%%%%%%%%%%%%%%
\theoremstyle{plain}
      \newtheorem{theorem}{Theorem}[section]
      \newtheorem*{theorem*}{Theorem}
      \newtheorem{proposition}[theorem]{Proposition}
      \newtheorem{lemma}[theorem]{Lemma}
      \newtheorem{corollary}[theorem]{Corollary}

      \theoremstyle{definition}
      \newtheorem{definition}[theorem]{Definition}

      %\theoremstyle{remark}
      \newtheorem{remark}[theorem]{Remark}
      \newtheorem{example}[theorem]{Example}
      
%%%%%%%%%%%%%%% RINGS AND GROUPS %%%%%%%%%%%%%%%
\newcommand{\FF}{{\mathbb{F}}}
\newcommand{\ZZ}{{\mathbb{Z}}}
\newcommand{\NN}{{\mathbb{N}}}
\newcommand{\CC}{{\mathbb{C}}}
\newcommand{\QQ}{{\mathbb{Q}}}
\newcommand{\RR}{{\mathbb{R}}}
\newcommand{\EE}{\mathbb{\bar Q}_\ell}
\newcommand{\OK}{\mathcal{O}_K}
\newcommand{\OL}{\mathcal{O}_L}
\newcommand{\OO}[1]{\mathcal{O}_{#1}}
\newcommand{\bFq}{\bar{k}}
\newcommand{\Fq}{k}
\newcommand{\Fqm}{k_m}
\newcommand{\EEx}{\EE^\times}
\newcommand{\ZEx}{\mathbb{\bar Z}_\ell^\times}
\newcommand{\Weil}[1]{\mathcal{W}_{#1}}
\newcommand{\m}{{\mathfrak{m}}}
%%%%%%%%%%%%%%% ALGEBRAIC GROUPS %%%%%%%%%%%%%%%
\newcommand{\Gm}[1]{\mathbb{G}_{\hskip-1pt\textbf{m},#1}}
\DeclareMathOperator{\GL}{GL}
\newcommand{\comp}{\Pi} % Component group
\newcommand{\G}{\textbf{G}}
%%%%%%%%%%%%%%% NAMED OPERATORS %%%%%%%%%%%%%%%
\DeclareMathOperator{\Gal}{Gal}
\newcommand{\Frob}[1]{\operatorname{Fr}_{#1}}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\Gr}{Gr}
\DeclareMathOperator{\Irrep}{Irrep}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Hh}{H}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\Nm}{Nm}
\DeclareMathOperator{\trace}{Tr}
\DeclareMathOperator{\obj}{obj}
\DeclareMathOperator{\mor}{mor}
\DeclareMathOperator{\Lang}{Lang}
\DeclareMathOperator{\image}{im}
\DeclareMathOperator{\Loc}{Loc}
\DeclareMathOperator{\Tot}{Tot}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\SL}{SL}
\DeclareMathOperator{\PGL}{PGL}
\newcommand{\gal}[1]{{\operatorname{Gal}\hskip-1pt\left( {\bar #1}/#1 \right)}}
\newcommand{\Spec}[1]{{\operatorname{Spec}(#1)}}
\newcommand{\op}{_{\operatorname{op}}}
\newcommand{\der}{_{\operatorname{der}}}
\newcommand{\ab}{_{\operatorname{ab}}}

%%%%%%%%%%%% MISCELLANEOUS OPERATORS %%%%%%%%%%%%
\newcommand{\sheafHom}{{\mathscr{H}\hskip-4pt{\it o}\hskip-2pt{\it m}}}
\newcommand{\abs}[1]{{\vert #1 \vert}}
\newcommand{\ceq}{{\, :=\, }}
\newcommand{\tq}{{\ \vert\ }}
\newcommand{\iso}{{\ \cong\ }}
\newcommand{\trFrob}[1]{t_{#1}}
\newcommand{\TrFrob}[1]{\operatorname{Tr}_{#1}}
%% Limits
\newcommand{\invlim}[1]{\lim\limits_{\overleftarrow{#1}}}
\newcommand{\dirlim}[1]{\lim\limits_{\overrightarrow{#1}}}
\newcommand{\limit}[1]{\mathop{\textsc{lim}}\limits_{#1}}
\newcommand{\colimit}[1]{\mathop{\textsc{colim}}\limits_{#1}}
%% Fonts for quasicharacter sheaves
\newcommand{\cs}[1]{{\mathcal{#1}}}
\newcommand{\gcs}[1]{{\mathcal{\bar #1}}}
\newcommand{\dualgcs}[1]{\gcs{#1}^\dagger}
\newcommand{\dualcs}[1]{\cs{#1}^\dagger}
%% Categories
\newcommand{\CS}{{\mathcal{C\hskip-0.8pt S}}}
\newcommand{\CCS}{{\mathcal{C\hskip-.8pt C\hskip-0.8pt S}}}
\newcommand{\bCS}{{\CS_0}}
\newcommand{\catname}[1]{\normalfont{\textsf{#1}}}
\newcommand{\Sch}[1]{{\catname{Sch}_{/#1}}}
\newcommand{\QCS}{{\mathcal{QC\hskip-0.8pt S}}}
\newcommand{\CSiso}[1]{\CS(#1)_{/\text{iso}}}
\newcommand{\bCSiso}[1]{\bCS(#1)_{/\text{iso}}}
\newcommand{\QCSiso}[1]{\QCS(#1)_{/\text{iso}}}
\newcommand{\CCSiso}[1]{\CCS(#1)_{/\text{iso}}}
%% Labeled items
\makeatletter
\newcommand{\labitem}[2]{
\def\@itemlabel{\textbf{#1}}
\item
\def\@currentlabel{#1}\label{#2}}
\makeatother
%% Shorthand for bars
\renewcommand{\bf}{\bar{f}}
\newcommand{\bg}{{\bar{g}}}
\newcommand{\bm}{\bar{m}}
\newcommand{\bG}{\bar{G}}
\newcommand{\bH}{\bar{H}}
\newcommand{\brho}{{\bar\rho}}
\newcommand{\bx}{{\bar{x}}}
%% Spacing control
\newcommand{\tight}[3]{\hspace{-#1pt}{#2}\hspace{-#3pt}}
\newcommand{\GxG}{\text{$G \tight{1}{\times}{1} G$}}
\newcommand{\bGxG}{\text{$\bar{G} \tight{1}{\times}{1} \bar{G}$}}
\newcommand{\bfxf}{\text{$\bar{f} \tight{1}{\times}{1} \bar{f}$}}
\newcommand{\GxxG}{\text{$G \tight{1}{\times}{1} G$}}
\newcommand{\LxL}{\text{$\gcs{L} \tight{0}{\boxtimes}{0} \gcs{L}$}}

%% Hyphenation override
\hyphenation{quasi-character}

%%%%%%%%%%%% BEGIN DOCUMENT %%%%%%%%%%%
\usepackage{todonotes}

\begin{document}

\begin{abstract}
We introduce and establish the basic properties of  the category of \emph{commutative character sheaves} on smooth group schemes $G$ over finite fields $\Fq$, building on earlier work by the same authors.
We use this category to geometrize types for supercuspidal representations of $p$-adic groups. 
\end{abstract}

\maketitle

\tableofcontents

\section*{Introduction}
We introduce and establish the basic properties of  the category of \emph{commutative character sheaves} on smooth group schemes $G$ over finite fields $\Fq$. 
Expanding on work by the same authors, we show that all character sheaves on $G\ab$ are commutative, when $G\ab$ is connected and of finite type.
We give three applications.
First, we use commutative character sheaves to produce a functorial geometrization of characters of $G(\Fq)$ in all cases, thus repairing a defect in the function-sheaf dictionary for algebraic groups $G$ which appears when the component group of $G$ is $\Hh^2(\pi_0(\bG),\EEx)^{\Frob{}}$ is non-trivial. 
Second, we revisit the motivations for the stacky abelianization construction, and show that, after replacing the rank-$1$ character sheaves on $G$ with commutative character sheaves on $G$, the schematic abelianization $G \to G\ab$ is the correct quotient.
This is an immediate consequence of the fact that the category of commutative character sheaves on $G$ is equivalent to the category of commutative character sheaves on $G\ab$. 
Finally, we provide a geometrization of generic types for supercuspidal representations of connected reductive linear algebraic groups over local fields.
This last application puts all the ingredients needed to parametrize supercuspidal representations of arbitrary depth in the same category: perverse sheaves on group schemes over finite fields.




Fragments: 
The additional condition distinguishing which character sheaves on $G$ are commutative, has several benefits, as we will see in this note.
\begin{enumerate}
\labitem{(1)}{b1}
A character sheaf $\cs{L}$ on $G$ is invisible if and only if $\cs{L}$ is not commutative.
Recall from \cite{cunningham-roe:13a}*{Def. 2.8} that a character sheaf $\cs{L}$ in $G$ is {\it invisible} if $\cs{L}  \ncong \EE$ yet $\trFrob{\cs{L}} =1$.
These are exactly the non-trivial character sheaves in the kernel of the surjective group homomorphism 
\[
\TrFrob{G} : \CSiso{G} \to G(\Fq)^*
\]
 given by the trace of Frobenius.
\labitem{(2)}{b2}
This note shows that $\TrFrob{G} : \CSiso{G} \to G(\Fq)^*$ admits a canonical section, and thus a splitting of the short exact sequence 
\[
\begin{tikzcd}
0 \arrow{r} & \Hh^2(\pi_0(\bG),\EEx)^{\Weil{}} \arrow{r} & \CSiso{G} \arrow{r}{\TrFrob{G}} & G(\Fq)^* \arrow{r} & 0
\end{tikzcd}
\]
found in \cite{cunningham-roe:13a}*{Thm. 3.6}.
\labitem{(3)}{b3}
Like the category $\CS(G)$ of character sheaves on $G$, which is described completely in \cite{cunningham-roe:13a}, $\CCS(G)$ is a rigid monoidal category.
Since $\CCS(G)$ is a full subcategory of $\CS(G)$, and since Item \ref{b2} above shows $\CCSiso{G} \iso G(\Fq)^*$, canonically, the category $\CCS(G)$ is now completely described by the following consequence of \cite{cunningham-roe:13a}*{Thm. 3.9}: in $\CCS(G)$, every morphism $\cs{L} \to \cs{L}'$ is either trivial (zero on stalks) or an isomorphism, and
\[
\Aut(\cs{L}) \iso  \Hh^1(\pi_0(\bG), \EEx)^{\Weil{}}.
\]
Consequently, we have a complete description of category $\CCS(G)$.
\end{enumerate}




\section{Recollections and definitions} \label{sec:defs}

Let $G$ be a smooth group scheme over a finite field $\Fq$; that is, let $G$ be a group scheme over $\Fq$
for which the structure morphism $G \to \Spec{\Fq}$ is smooth in the sense of \todo{include reference for this definition}.
This implies $G \to \Spec{\Fq}$ is locally of finite type, but not that it is of finite type.
We remark that the identity component $G^0$ of $G$ is of finite type over $\Fq$, while the component group scheme
$\pi_0(G)$ of $G$ is an \'etale group scheme over $\Fq$, and both are smooth over $\Fq$.

In this paper we use a common formalism for Weil sheaves, writing $\cs{L}$ for the pair $(\gcs{L},\phi)$ and writing $\alpha : \cs{L} \to \cs{L}'$ for a morphism $\alpha : \gcs{L} \to \gcs{L}$ such that 
\[
\begin{tikzcd}
\Frob{}^* \gcs{L} \arrow{d}[swap]{\phi} \arrow{r}{\Frob{}^*\alpha} &  \Frob{}^* \gcs{L} \arrow{d}{\phi'}\\
\gcs{L} \arrow{r}{\alpha} & \gcs{L}
\end{tikzcd}
\]
commutes, where $\cs{L}'$ refers to $(\gcs{L}',\phi')$.
While this simplifies notation considerably, it is, unfortunately, not consistent with our earlier paper.

We write $m : G \times G \to G$ for the multiplication morphism, and $G(k)^*$ for $\Hom(G(k), \EEx)$.
Define $\theta : G\times G \to G\times G$ by $\theta(g,h) = (h,g)$.

\subsection{Commutative character sheaves on commutative groups}\label{ssec:comcom}

Suppose now that $G$ is commutative.
Recall \cite{cunningham-roe:13a}*{Def. 1.1} that a character sheaf on $G$ is a triple $(\gcs{L}, \mu, \phi)$,
where $\gcs{L}$ is a rank-one $\ell$-adic local system on $\bG$, 
$\mu : \bm^* \gcs{L} \to \LxL$ is an isomorphism
of sheaves on $\bG \times \bG$, 
and $\phi : \Frob{G}^* \gcs{L} \to \gcs{L}$ is an isomorphism of sheaves on $\bG$;
the triple $(\gcs{L}, \mu, \phi)$ must also satisfy compatibility conditions specified in \emph{loc. cite}.
The category of character sheaves on $G$ is denoted by $\CS(G)$.

Let $\cs{L}$ be a character sheaf on $G$.  Since $m = m \circ \theta$ in the commutative case,
there is a canonical isomorphism $\xi : m^* \cs{L} \to \theta^* m^* \cs{L}$.
There is also an isomorphism $\vartheta : \cs{L}\boxtimes\cs{L} \to \theta^*(\cs{L}\boxtimes\cs{L})$
given on stalks by the canonical map $\gcs{L}_{g} \otimes \gcs{L}_{h} \to \gcs{L}_{h} \otimes \gcs{L}_{g}$.

\begin{definition}\label{def:CCScom}
A character sheaf $(\cs{L}, \mu)$ on a smooth commutative group scheme $G$ is \emph{commutative}
if the following diagram of Weil sheaves on $G \times G$ commutes.
  \[
  \begin{tikzcd}[row sep=30]
   m^*\cs{L} \arrow{d}[swap]{\xi} \arrow{r}{\mu} & \cs{L}\boxtimes\cs{L} \arrow{d}{\vartheta}\\
   \theta^*(m^*\cs{L}) \arrow{r}{{\theta}^*\mu} &  \theta^*(\cs{L}\boxtimes\cs{L})
  \end{tikzcd}
  \]
We write $\CCS(G)$ for the full subcategory of $\CS(G)$ consisting of commutative character sheaves.
 \end{definition}

\todo{Add some remarks and/or promise examples showing that $\CCS(G)$ need not be $\CS(G)$, even in the Abelian case.}
I'm wondering about the structure of the paper. 
Would it make sense to really explore the Abelian case, before moving to the non-Abelian case?
That would mean moving the material from Section~Invisible up to here. 

\subsection{Commutative character sheaves on non-commutative groups}

We now drop the assumption that $G$ is commutative, and assume only that it is smooth.
The category $\CS(G)$ still makes sense in this context, defined as in \cite{cunningham-roe:13a}*{Def. 1.1}.
In order to distinguish the resulting objects from
the character sheaves of Lusztig, we will refer to the former as \emph{linear character sheaves}
(to evoke the one-dimensional character sheaves of \cite{Kamgarpour})
and again write $\CS(G)$ for the resulting category, with morphisms defined as in \emph{loc. cite}.

\iffalse
In order to define the category of commutative character sheaves on $G$ in this generality, we need to review ... 
Let $G\der \hookrightarrow G$ be the derived subgroup scheme.
We recall that this closed normal subgroup scheme is generated by a family of smooth morphisms
$c_n: (G\times G)^n \to G$ given by $c_1: (x,y)\mapsto xyx^{-1}y^{-1}$ and ...
%Then $G \times G \to G\der$ is a dominant morphism \cite{SGA3}*{Expos\'e {VI}$_B$, \S 7.2}.
The group scheme $G$ is commutative if and only if $G\der$ is trivial.
When $G$ is not connected, $G\der$ need not be connected, though it is smooth.
%The restriction of $G\times G\to G\der$ to identity components gives a dominant morphism $G^0\times G^0 \to G^0\der$ \cite{SGA3}*{Expos\'e {VI}$_B$, Prop. 7.8}.
\fi


If $\chi \in G(k)^*$ is a character, it must vanish on the derived subgroup $G\der(k)$.
Kamgarpour gives an example \cite{kamgarpour:09a}*{(1.1)} of a character sheaf
that does not vanish on $G\der$, defined by the extension
\[
1 \to \mu_n \to \SL_n \to \PGL_n \to 1.
\]
In order to obtain a relationship between character sheaves on $G$ and characters of $G(k)$,
he opts to give a different definition of commutator.  Since we already need to adapt our
notion of character sheaf, even in the commutative case, we instead add restrictions
to the definition of commutative character sheaf and leave the definition of $G\der$ unchanged.

The first step in this process is to rule out character sheaves as above.
The following proposition will be proven in Section \ref{sec:descent}.
\begin{proposition} \label{prop:Gder_triv}
Suppose $G$ is a smooth group scheme and $\cs{L} \in \CS(G)$ is a linear character sheaf on $G$.
Then the restriction of $\cs{L}$ to $G\der$ is trivial if and only if $\cs{L} \cong q^*(\cs{L}\ab)$ for some
character sheaf $\cs{L}\ab$ on $G\ab$.
\end{proposition}

We may now define commutative character sheaves on $G$.
%
Suppose $(\cs{L},\mu)$ is a linear character sheaf on $G$ such that its pull-back along $G\der \hookrightarrow G$ is trivial;
let $\beta : \cs{L}\vert_{G\der} \to (\EE)_{G\der}$ be an isomorphism in $\CS(G\der)$.
Let $\CS'(G)$ be the category of such triples, $(\cs{L},\mu,\beta)$, in which a morphism $(\cs{L},\mu,\beta)\to (\cs{L}',\mu',\beta')$ is a morphism $\alpha : (\cs{L},\mu)\to (\cs{L}',\mu')$ in $\CS(G)$ such that $\beta = \beta' \circ \alpha\vert_{G\der}$.
%

Every $\beta : \cs{L}\vert_{G\der} \to (\EE)_{G\der}$ determines an isomorphism $\gamma : m^*\cs{L} \to \theta^*m^*\cs{L}$ as follows.
Let $c : G\times G\to G\der$ be the commutator map, defined by $c(x,y)= xyx^{-1}y^{-1}$.
Then $c$ is a smooth morphism of $\Fq$ schemes and $c = m \circ (m \times (i \circ m \circ \theta))$.
Thus, $\beta : \cs{L}\vert_{G\der} \to (\EE)_{G\der}$ determines
\[
\begin{tikzcd}
m^*\cs{L} \otimes \theta^* m^* i^*\cs{L} \arrow{r}{c = m \circ (m \times (i \circ m \circ \theta))} & c^* \cs{L}\vert_{G\der} \arrow{r}{c^*(\beta)} &  c^*(\EE)_{G\der} \arrow{r} & (\EE)_G\otimes (\EE)_G.
\end{tikzcd}
\]
Using the monadic structure of the category of Weil local systems on $G\times G$, this isomorphism, in turn, defines an isomorphism
\[
\begin{tikzcd}
m^*\cs{L} \arrow{r}  & (\theta^* m^* i^*\cs{L})^\vee.
\end{tikzcd}
\] 
Since $(\theta^* m^* i^*\cs{L})^\vee \iso \theta^* m^* i^* (\cs{L}^\vee)$ canonically, and since $\cs{L}^\vee \iso i^*\cs{L}$, canonically, this defines the promised isomorphism
\[
\begin{tikzcd}
\gamma : m^*\cs{L} \arrow{r} & \theta^* m^* \cs{L}.
\end{tikzcd}
\]

\begin{definition}\label{def:CCS}
The category $\CCS(G)$ of commutative character sheaves on $G$ is the full subcategory of $\CS'(G)$ consisting of triples $(\cs{L},\mu,\beta)$ such that the following diagram of Weil sheaves on $G \times G$ commutes,
  \[
  \begin{tikzcd}[row sep=30]
   m^*\cs{L} \arrow{d}[swap]{\gamma} \arrow{r}{\mu} & \cs{L}\boxtimes\cs{L} \arrow{d}{\vartheta}\\
   \theta^*(m^*\cs{L}) \arrow{r}{{\theta}^*\mu} &  \theta^*(\cs{L}\boxtimes\cs{L})
  \end{tikzcd}
  \]
where $\gamma : m^*\cs{L} \to \theta^* m^* \cs{L}$ is the isomorphism built from $\beta : \cs{L}\vert_{G\der} \to (\EE)_{G\der}$, above.
\end{definition}

%We will see that, when $\beta$ exists for $(\cs{L},\mu)\in \CS(G)$, it is essentially unique.

\begin{theorem}\label{thm:Gab}
Pull-back along the abelianization $q : G \to G\ab$
\[
q^* : \CCS(G\ab) \to \CCS(G)
\]
defines an equivalence of categories.
\end{theorem}

%\todo{Masound's definition is designed to match the definition coming from central extensions, while we have one that matches Ext1 in Ab, in the connected case. So, I think the modification is easy: add mop to diagram 2.4 in Masoud's paper. \\ -CC}


\iffalse
\begin{definition}
A linear character sheaf $\cs{L}$ on a smooth group scheme $G$ is \emph{commutative} if
\[
\cs{L} \cong q^* \cs{L}\ab
\]
for a commutative character sheaf $\cs{L}\ab$ on $G\ab$.  As in the commutative case,
we write $\CCS(G)$ for the full subcategory of $\CS(G)$ consisting of commutative character sheaves.
\end{definition}
\fi

\iffalse
Note that we may also pull back the map $\xi\ab : m\ab^* \cs{L}\ab \to \theta\ab^*(m\ab^* \cs{L})$ from Definition \ref{def:CCScom}.
The following proposition will be proven in Section \ref{sec:descent}.

\begin{proposition} \label{prop:Gdiagram}
A linear character sheaf $(\cs{L}, \mu)$ on a smooth group scheme $G$ is commutative if and only if
\begin{enumerate}
\item $\cs{L} \cong q^* \cs{L}\ab$ for some character sheaf $\cs{L}\ab$ on $G\ab$,
\item the following diagram of Weil sheaves on $G \times G$ commutes.
  \[
  \begin{tikzcd}[row sep=30]
   m^*\cs{L} \arrow{d}[swap]{(q\times q)^*\xi\ab} \arrow{r}{\mu} & \cs{L}\boxtimes\cs{L} \arrow{d}{\vartheta}\\
   \theta^*(m^*\cs{L}) \arrow{r}{{\theta}^*\mu} &  \theta^*(\cs{L}\boxtimes\cs{L})
  \end{tikzcd}
  \]
\end{enumerate}
\end{proposition}
\fi

\section{Eliminating Invisible Character Sheaves}\label{sec:defect}

If $M$ is a $\bG$-module, then we say a cohomology class in $\Hh^2(\bG, M)$ is \emph{symmetric} if it is represented
by a symmetric $2$-cocycle.  Since every coboundary is symmetric, either all cocycles in a given class will be symmetric
or none will.

\begin{lemma} \label{lem:symtriv}
Let $\bG$ be a commutative group.  Then the only symmetric class in $\Hh^2(\bG, \EEx)$ is the trivial class.
\end{lemma}

\begin{proof}
By the universal coefficient theorem,
\[
0 \to \Ext^1_\ZZ(\Hh_{n-1}(\bG, \ZZ), \EEx) \to \Hh^n(\bG, \EEx) \to \Hom(\Hh_n(\bG, \ZZ), \EEx) \to 0
\]
for all $n > 0$.  When $n = 2$, using the fact that $\bG$ is commutative, we have that $\Hh_1(\bG, \ZZ) \cong \bG$
and that $\Hh_2(\bG, \ZZ) \cong \wedge^2 \bG$. We get
\[
0 \to \Ext^1_\ZZ(\bG, \EEx) \to \Hh^2(\bG, \EEx) \to \Hom(\wedge^2 \bG, \EEx) \to 0.
\]
The map $\Hh^2(\bG, \EEx) \to \Hom(\wedge^2 \bG, \EEx)$ maps a $2$-cocycle $f$ to the alternating function
\[
(x,y) \mapsto \frac{f(x,y)}{f(y,x)}.
\]
Thus the cohomology classes represented by symmetric cocycles are precisely those in the image of $\Ext^1_\ZZ(\bG, \EEx)$.
But $\Ext^1_\ZZ(-, \EEx)$ vanishes because $\EEx$ is divisible.
\end{proof}

For a character sheaf $\cs{L}$ on $G$, recall from \cite{cunningham-roe:13a}*{\S 2.3} that $S_G : \CSiso{G} \to \Hh^2(E_G^\bullet)$ maps
$[\cs{L}]$ to $[\alpha \oplus \beta]$, where $E_G^\bullet$ is the total space of the zeroth page
of the Hochschild-Serre spectral sequence, $\alpha \in C^0(\Weil{}, C^2(\bG, \EEx))$ is obtained from $\mu$ and
$\beta \in C^1(\Weil{}, C^1(\bG, \EEx))$ is obtained from $\phi$.

\begin{lemma} \label{lem:conncomm}
If $G$ is a connected commutative algebraic group over $\Fq$ then every character sheaf on $G$ is commutative.
\end{lemma}

\begin{proof}
We can use \'etale descent to see that pullback by the Lang isogeny defines an equivalence
of categories between local systems on $G$ and $G(\Fq)$-equivariant local systems on $G$.  Thus every character
sheaf on $G$ arises through the Lang isogeny; since the covering group is $G$ itself, which is commutative,
every character sheaf on $G$ is commutative.
\end{proof}

\begin{theorem} \label{thm:trfrobiso}
If $G$ is a smooth commutative group scheme over $\Fq$ then $\TrFrob{G} : \CCSiso{G} \to G(\Fq)^*$ is an isomorphism.
\end{theorem}

\begin{proof}
Suppose first that $G$ is \'etale.  Consider the isomorphism of short exact sequences
\[
\begin{tikzcd}
 0 \arrow{r} & \ker \TrFrob{G} \arrow{d} \arrow{r} & \CSiso{G}\arrow{d}{S_G} \arrow{r}{\TrFrob{G}} \arrow{r} & G(\Fq)^* \arrow{d} \arrow{r} & 0\\
  0 \arrow{r} & \Hh^0(\Weil{},\Hh^2(\bG,\EEx)) \arrow{r} & \Hh^2(E^\bullet_G) \arrow{r} & \Hh^1(\Weil{},\Hh^1(\bG,\EEx)) \arrow{r} & 0
 \end{tikzcd}
 \]
from \cite{cunningham-roe:13a}*{Prop. 2.7}.

Suppose that $\cs{L}$ is a commutative character sheaf
with $\trFrob{\cs{L}} = 1$.  Then $S_G([\cs{L}])$ is in the image of $\Hh^2(\bG, \EEx)^\Weil{}$, so is cohomologous to
$[\alpha', 0]$.  Since $\alpha$ is symmetric and coboundaries are symmetric, $\alpha'$ is symmetric as well.
So by Lemma \ref{lem:symtriv}, $\alpha'$ is cohomologically trivial, and thus $[\cs{L}]$ is trivial as well.

To see that $\TrFrob{G}$ is still surjective on $\CCSiso{G}$, note that the character sheaf constructed in the proof of
\cite{cunningham-roe:13a}*{Prop. 2.6} has trivial $\alpha$, and is thus commutative.

For general smooth commutative group schemes, we use Lemma \ref{lem:conncomm} and the snake lemma.
\end{proof}

\begin{remark}
Since $\Hh^0(\Weil{},\Hh^2(\bG,\EEx))$ is not necessarily trivial \cite{cunningham-roe:13a}*{Ex. 2.10}, the functor
$\CCS(G) \to \CS(G)$ is not an equivalence of categories in general.
\end{remark}


\section{Descent to the Abelianization} \label{sec:descent}

In this section we use descent along the abelianization $q : G \to G\ab$ to prove Propositions~1.2 and 1.4, and Theorem~\ref{thm:Gab}.
This approach requires introducing equivariant linear character sheaves, as defined in Section~[].

\subsection{Equivariant Weil local systems}

Let $G$ be as above.
Let $H$ be a group scheme and write $n : H \times H \to H$ for the multiplication morphism.
Let $a : H \times G\to G$ be a group action compatible with the group structure on $G$ and write $p : H\times G \to G$ for projection. 
Consider the morphisms
\[
\begin{tikzcd}
H \times H \times G 
\arrow[shift left=4]{r}{b_1, b_2, b_3} 
\arrow{r}{}
\arrow[shift right=4]{r}{} 
& H \times G 
\arrow[shift left=2]{r}{a}
\arrow[shift right=2]{r}[swap]{p}
 & G 
\end{tikzcd}
\]
defined by $b_1(h_1,h_2,g) = (n(h_1,h_2),g)$,  $b_2(h_1,h_2,g) = (h_1,a(h_2,g))$ and $b_3(h_1,h_2,g) = (h_2,g)$.
Then, $a\circ b_1 = a\circ b_2$ and $a\circ b_3 = p\circ b_2$ and $p\circ b_1 = p\circ b_3$.
An $H$-equivariant Weil local sytem on $G$ is a Weil local system $\cs{L}$ on $G$ together with an isomorphism  
\[
\nu : a^*\cs{L} \to p^*\cs{L}
\] 
of Weil local systems on $H\times G$ such that the following diagram of isomorphisms of local systems on $H\times H\times G$ commutes,
\[
\begin{tikzcd}
\ &  \arrow{dl}{a\circ b_1 = a\circ b_2}  b_2^*  a^*\, \mathcal{L} \arrow{rr}{b_2^*(\nu)} && b_2^* p^*\, \mathcal{L} \arrow{dr}[swap]{p\circ b_2 = a\circ b_3} & \\
b_1^* a^*\, \mathcal{L} \arrow{dr}{b_1^*(\nu)} &&&&   \arrow{dl}[swap]{b_3^*(\nu)} b_3^* a^*\, \mathcal{L} \\
& b_1^* p^*\, \mathcal{L}  && \arrow{ll}[swap]{p\circ b_3 = p\circ b_1} b_3^* p^*\, \mathcal{L}, & 
\end{tikzcd}
\]
and $s^*(\nu) = \id_{\cs{L}}$.
In the diagram above, the arrows labeled with equations come from canonical isomorphisms of functors on Weil sheaves derived from the equations above; so, for example, the top left isomorphism comes from $b_1^* a^* \iso b_2^* a^*$ since $a\circ b_1 = a\circ b_2$.
\iffalse
On stalks, this condition is ...
\[
\begin{tikzcd}
\ &  \cs{L}_{h_1\cdot(h_2\cdot g)} \arrow{r}{\nu_{h_1,h_2\cdot g}} & \cs{L}_{h_2\cdot g} & \\
\cs{L}_{(h_1 h_2) \cdot g} \arrow{dr}[swap]{\nu_{(h_1h_2),g}} \arrow[equal]{ur} &&& \arrow[equal]{ul}  \arrow{dl}{\nu_{h_2,g}} \cs{L}_{h_2\cdot g} \\
& \cs{L}_g \arrow[equal]{r} & \cs{L}_g & 
\end{tikzcd}
\]
\fi
Morphisms of $H$-equivariant Weil local systems $(\cs{L},\nu)\to (\cs{L}',\nu')$ are morphisms of Weil local systems $\alpha: \cs{L}\to \cs{L}'$ for which the diagram
\[
\begin{tikzcd}
\arrow{d}[swap]{\nu} a^*\cs{L} \arrow{r}{a^*(\alpha)} & a^*\cs{L}' \arrow{d}{\nu'} \\
p^*\cs{L} \arrow{r}{p^*(\alpha)} & p^*\cs{L}'
\end{tikzcd}
\]
commutes.
This defines $\Loc_H(G)$, the category of $H$-equivariant Weil local systems on $G$.

\subsection{Equivariant linear character sheaves}

An $H$-equivariant linear character sheaf on $G$ is a triple $(\cs{L},\mu, \nu)$ where $(\cs{L},\mu)$ is a linear character sheaf and $\nu$ is compatible with $\mu$ in the sense. 
Consider the following morphisms: $c_0 : H\times G \times G\to H\times G \times H \times G$ defined by $c_0(h,g_1,g_2)\ceq(h,g_1,h,g_2)$;
$c_1 : H \times G\times G \to G\times G$ defined by $c_1(h, g_1, g_2) \ceq (a(h,g_1),a(h,g_2))$;  $c_2 : H \times G\times G \to H\times G$ defined by $c_2(h,g_1,g_2) \ceq (h, m(g_1,g_2))$; and $c_3 : H \times G\times G \to G\times G$ defined by $c_3(h, g_1, g_2) = (g_1, g_2)$. 
Then $(\cs{L},\mu,\nu)$ is an $H$-equivariant linear character sheaf on $G$ if $(\cs{L},\mu)$ is a linear character sheaf on $G$ and the following diagram of Weil local systems on $H \times G\times G$ commutes.
\[
\begin{tikzcd}
\ & \arrow{dl}{c_2\circ a = m\circ c_1}  c_2^* a^* \cs{L} \arrow{r}{c_2^*(\nu)} & c_2^* p^* \cs{L} \arrow{dr}[swap]{p\circ c_2 = m\circ c_3}  &  \\
\arrow{d}[swap]{c_1^*(\mu)} c_1^* m^* \cs{L} &&& c_3^* m^*\cs{L} \arrow{d}{c_3^*(\mu)} \\
c_1^*(\cs{L}\boxtimes \cs{L}) \arrow{dr}{p_i\circ c_1 = a\circ p_i\circ c_0} &&& \arrow{dl}[swap]{p\circ p_i\circ c_0 = p_i \circ c_3} c_3^*(\cs{L}\boxtimes \cs{L}) \\
 & c_0^*(a^*\cs{L}\boxtimes a^*\cs{L}) \arrow{r}{c_0^*(\nu\boxtimes \nu)} & c_0^*(p^*\cs{L} \boxtimes p^*\cs{L}) & 
\end{tikzcd}
\]
\iffalse
On stalks, this condition is
\[
\begin{tikzcd}
\arrow{d}[swap]{\mu_{(h\cdot g_1, h\cdot g_2)}} \cs{L}_{(h\cdot g_1)(h\cdot g_2)} & \arrow[equal]{l}  \cs{L}_{h\cdot(g_1 g_2)} \arrow{r}{\nu_{(h, g_2 g_2)}} & \cs{L}_{g_1 g_2} \arrow[equal]{r} & \cs{L}_{g_1 g_2} \arrow{d}{\mu_{(g_1,g_2)}} \\
\cs{L}_{h\cdot g_1}\otimes \cs{L}_{h\cdot g_2} \arrow[equal]{r} & \cs{L}_{h\cdot g_1}\otimes \cs{L}_{h\cdot g_2} \arrow{r}{\nu_{(h,g_1)}\otimes \nu_{(h,g_2)}} & \cs{L}_{g_1}\otimes \cs{L}_{g_2} & \arrow[equal]{l} \cs{L}_{g_1} \otimes \cs{L}_{g_2},
\end{tikzcd}
\]
for all $(h,g_1,g_2)\in H\times G\times G$.
\fi

A morphism of $H$-equivariant linear character sheaves $(\cs{L},\mu,\nu) \to (\cs{L}',\mu',\nu')$ is a morphism of $H$-equivariant Weil sheaves $\alpha : \cs{L}\to \cs{L}'$ which is also a morphism of linear character sheaves, so
\[
\begin{tikzcd}
\arrow{d}[swap]{\mu} m^*\cs{L} \arrow{r}{m^*(\alpha)} & m^*\cs{L}' \arrow{d}{\mu'} \\
\cs{L}\boxtimes \cs{L} \arrow{r}{\alpha\boxtimes\alpha} & \cs{L}'\boxtimes\cs{L}' 
\end{tikzcd}
\]
commutes.
%
Let $\CS_H(G)$ be the category of $H$-equivariant linear character sheaves on $G$.

%Is $\CS_H(G)$ a rigid monoidal category?

%If $(\cs{L},\mu,\nu)$ and $(\cs{L},\mu,\nu')$ in $\CS_H(G)$, then $\nu = \nu'$?

\subsection{Descent along a torsor}

Now suppose $q : G \to G'$ is a regular epimorphism with kernel pair $(a,p)$ in the category of schemes
\[
\begin{tikzcd}
H\times G
 \arrow[shift left=2]{r}{a}
  \arrow[shift right=2,swap]{r}{p}
&
G 
\arrow{r}{q}
& 
G'
\end{tikzcd}
\]
Let $\cs{L}'$ be a linear character sheaf on $G'$.
Consider the functor
\[
q^* : \CS(G') \to \CS(G)
\]
given on objects by $(\cs{L}',\mu') \mapsto (q^*\cs{L}', (q\times q)^* \mu', \nu_{\cs{L}'})$; cf [Dictionary].
Then $q^*\cs{L}'$ is an $H$-equivariant linear character sheaf on $G$ when equipped with the canonical isomorphism
\[
\nu_{\cs{L}'} : a^* q^* \cs{L}' \mathop{\longrightarrow}\limits^{\iso} (q\circ a)^* \cs{L}' = (q\circ p)^*\cs{L}' \mathop{\longrightarrow}\limits^{\iso} p^* q^*\cs{L}.
\]
This simple observation shows that the functor $q^* : \CS(G') \to \CS(G)$  factors according to the following commuting diagram of functors
\[
\begin{tikzcd}
\CS(G) &\arrow{l}[swap]{q^*} 
\CS(G') \arrow{dl}{\text{comparison}}\\
\arrow{u}{\text{forget}} \CS_{H}(G). & 
\end{tikzcd}
\]

\begin{lemma}
If $q : G \to G'$ is an $H$-torsor in the fppf topology then the comparison functor $\CS(G') \to \CS_H(G)$ is an equivalence.
\end{lemma}

\begin{proof}
First we show that the comparison functor $\Loc(G') \to \Loc_H(G)$ is an equivalence. 
To see this, observe first that $\Loc$ is a stack on schemes over $\Fq$ in the Zariski topology.
Moreover, if $Y \to X$ is a flat surjective morphism of affine schemes over $\Fq$, then the comparison functor $\Loc(X) \to \Loc(Y\to X)$ is an equivalence, with $\Loc(Y\to X)$ defined as in [].
It follows that $\Loc$ is a stack over schemes over $\Fq$ in the fppf topology.
(This is a small variation on the proof that quasicoherent sheaves form a stack on sheaves in the fppf topology.)
Since $q : G\to G'$ is an $H$-torsor in the fppf topology, is now follows from descent theory that the comparison functor $\Loc(G') \to \Loc_H(G)$ is an equivalence.
The same argument shows that pull-back along $q\times q$ determines an equivalence $\Loc(G'\times G') \to \Loc_{H\times H}(G\times G)$.


\end{proof}

\subsection{Change of perspective}

We now suppose that $i : H \hookrightarrow G$ is a closed subgroup and that the action $a : H\times G\to G$ is obtained by restricting the action $m : G \times G\to G$ to $H\times G$.
Then we have the diagram
\[
\begin{tikzcd}
\ &  \arrow{dl}[swap]{a} H \times G \arrow{dr}{p} \arrow{dd}[swap]{f} & \\
G & & G \\
& \arrow{ul}{m} G \times G \arrow{ur}[swap]{p_2} & 
\end{tikzcd}
\]
where $f(h,g) = (i(h),g)$.
% (a(h,g) g^{-1}, g) = (h,g)$.
%Define $f_1: H\times G \to G$ by $f_1(h,g)\ceq (i\circ p_1)$; then $f(h,g) = (f_1(h,g),g)$ and $f_1(h_1 h_2,g) = f_1(h_1, h_2\cdot g) f_1(h_2,g)$.
Then every $H$-equivariant linear character sheaf $(\cs{L},\mu, \nu)$ uniquely determines an isomorphism 
\[
\beta : \cs{L}\vert_H \to (\EE)_{H}
\]
by 
\[
\nu = (\beta \boxtimes \id) \circ  f^*\mu,
\] 
or more precisely, by the following diagram of isomorphisms.
\[
\begin{tikzcd}
\ & a^*\cs{L} \arrow{dl}{m\circ f = a} \arrow{r}{\nu} & p^*\cs{L} & \\
f^* m^*\cs{L} \arrow{dr}{f^*\mu} &&& (\EE)_{H} \boxtimes \cs{L} \arrow{ul}{p= p_1} \\ 
& f^*(\cs{L}\boxtimes \cs{L}) \arrow{r}{p_\circ f = i}[swap]{p_2\circ f = \id}  & 
\cs{L}\vert_{H} \boxtimes \cs{L} \arrow{ur}{\beta\boxtimes \id} & 
\end{tikzcd}
\]
In this way we see we may replace $(\cs{L},\mu,\nu)$ with a triple, $(\cs{L},\mu,\beta)$, from which $(\cs{L},\mu,\nu)$ may be recovered.
The isomorphism $\beta : \cs{L}\vert_{H} \to (\EE)_{H}$ is constrained conditions from Sections [] and [].


\begin{lemma}
$\CS_H(G)$ is equivalent to the category $\CS'(G)$ of triples $(\cs{L},\mu,\beta)$ where $(\cs{L},\mu)\in \CS(G)$ and $\beta : \cs{L}\vert_H \to (\EE)_H$ is an isomorphism in $\CS(H)$, with morphisms $\alpha : (\cs{L},\mu,\beta) \to (\cs{L}',\mu',\beta')$ defined by the condition
$\alpha : (\cs{L},\mu) \to (\cs{L}',\mu')$ is a morphism in $\CS(G)$ and $\beta = \beta' \circ \alpha\vert_{H}$.
\end{lemma}

\begin{proof}
\end{proof}

\subsection{Proofs}

We can now give the missing proofs from Section \ref{sec:defs}.

\begin{proof}[Proof of Proposition~\ref{prop:Gder_triv}]
The abelianization $G\ab\ceq G/G\der$ exists in schemes over $\Fq$ \cite{SGA3}*{Expos\'e {VI}$_A$, Thm. 3.2}.
Now,
\[
\begin{tikzcd}
%{} & G\times G \arrow{d}{c} &&&\\
1 \arrow{r} & G\der \arrow{r}{i} & G \arrow{r}{q} & G\ab \arrow{r} & 1
\end{tikzcd}
\]
gives
\[
\begin{tikzcd}
\CS(G\der) & \arrow{l}[swap]{i^*} \CS(G) &\arrow{l}[swap]{q^*} 
\CS(G\ab) \arrow{dl}{\text{comparison}} \\
\arrow{u}{\text{forget}} \CS'(G)  \arrow{r}{\beta \mapsto \nu} &  \CS_{G\der}(G) \arrow{u}{\text{forget}}  & 
\end{tikzcd}
\]
%
Since the quotient $q : G \to G\ab$ is a trivial $G\der$-torsor in the fppf topology \cite{SGA3}*{Expos\'e {VI}$_A$, Thm. 3.2}, 
it now follows from Lemma~[] that the comparison functor $\CS(G\ab)\to \CS_{G\der}(G)$ is an equivalence.
On the other hand, by Lemma~[], $\CS'(G) \to \CS_{G\der}(G)$, defined by $(\cs{L},\mu,\beta)\mapsto (\cs{L},\mu, \nu)$, is an equivalence.
Since the essential image of the forgetful functor $\CS'(G)\to \CS(G)$ is precisely the category of $(\cs{L},\mu)\in \CS(G)$ such that $\cs{L}\vert_{G\der} \iso (\EE)_{G\der}$, this completes the proof of Proposition~\ref{prop:Gder_triv}.
%that $\cs{L}\vert_{G\der} \iso (\EE)_{G\der}$ if and only if $\cs{L} = q^*\cs{L}\ab$ for some $\cs{L}\ab \in \CS(G\ab)$.
\end{proof}

\begin{proof}[Proof of Theorem~\ref{thm:Gab}] 
By Definition~\ref{def:CCScom}, $\CCS(G\ab) \to \CS(G\ab)$ is a full subcategory.
Since the comparison functor $\CS(G\ab) \to \CS_{G\der}(G)$ is an equivalence, it determines a full subcategory $\CCS_{G\der}(G)$ which is equivalent to $\CCS(G\ab)$. 
\[
\begin{tikzcd}
\CS(G\der) & \arrow{l}[swap]{i^*} \CS(G) &\arrow{l}[swap]{q^*} 
\CS(G\ab) \arrow{dl}{} \\
\arrow{u}{\text{forget}} \CS'(G)  \arrow{r}{\beta \mapsto \nu} &  \CS_{G\der}(G) \arrow{u}{\text{forget}}  & \CCS(G\ab) \arrow{u} \arrow{dl} \\
\CCS(G) \arrow{u} \arrow{r}{\beta \mapsto \nu} & \arrow{u}  \CCS_{G\der}(G) & 
\end{tikzcd}
\]
The proof of Theorem~\ref{thm:Gab} now reduces to the following claim: the essential image of the equivalence $\CS_{G\der}(G) \to \CS'(G)$ is $\CCS(G)$.
To that end, suppose $(\cs{L},\mu,\beta)\in \CS'(G)$ and $(\cs{L},\mu,\nu) = q^*(\cs{L}\ab,\mu\ab)$;
we must show that $(\cs{L},\mu,\beta)\in \CCS(G)$ if and only if $(\cs{L}\ab,\mu\ab)\in \CCS(G\ab)$.
Let $\xi : m\ab^*\cs{L}\ab \to \theta^* m\ab^*\cs{L}$ be the isomorphism attached to $(\cs{L}\ab,\mu\ab)\in \CS(G\ab)$ in Section~\ref{ssec:comcom}.
This determines a rigidification $r : \cs{L}_1 \to \EE$ by ....\todo{I've sorted this out, but have also run out of steam for the day. I'll write it up tomorrow.}
\end{proof}


%\begin{proof}[Proof of Proposition~\ref{prop:Gdiagram}]
%\end{proof}


\iffalse

\subsection{Change of action}

Now, let $a' : H'\times G \to G$ be another group action on $G$ and suppose $f: H \times G \to H'\times G$ makes the following diagram commute.
\[
\begin{tikzcd}
&  \arrow{dl}[swap]{a} H \times G \arrow{dr}{p} \arrow{dd}[swap]{f} & \\
G & & G \\
& \arrow{ul}{a'} H' \times G \arrow{ur}[swap]{p} & 
\end{tikzcd}
\]
Then pull-back along $f: H\times G \to H'\times G$ defines a monoidal functor 
\[
\CS_{H'}(G) \to \CS_{H}(G).
\]


Then $f : H\times G \to H'\times G$ is given by $f(h,g) = (k(h,g),g)$ for some $k : H\times G\to H'$. 
Define $d : H\to H'$ by $d(h) = k(h,1)$.




\begin{lemma}\label{lem:action}
The canonical functor
\[
\CS_{H}(G) \to \CS_{H'}(G)
\]
is an equivalence if ...
\end{lemma}
\begin{proof}
\end{proof}

\subsection{Conjugation}

We close this section with an alternate characterization of $\CS'(G)$, the category of linear character sheaves $\cs{L}$ on $G$ for which $\cs{L}\vert_{G\der} \iso (\EE)_{G\der}$.
Recall that $\CS'(G)$ is a full subcategory of $\CS(G)$ and that $\CCS(G)$ is a full subcategory of $\CS'(G)$.

Consider the following case of Section~\ref{ssec:action}.

\fi

\section{Applications to supercuspidal representations}

\subsection{Linear Characters}

For non-commutative $G$, we aim to model homomorphisms from $G(k)$ to $\EEx$ using the category $\CCS(G)$.
The precise nature of the relationship between $G(k)^*$ and $\CCSiso{G}$ is described by Galois cohomology.
Let $\Delta$ be the image of the boundary homomorphism $\delta$ in the sequence
\[
1 \to G\der(k) \to G(k) \to G\ab(k) \xrightarrow{\delta} \Hh^1(k, G\der),
\]
yielding a short exact sequence
\[
1 \to G(k) / G\der(k) \to G\ab(k) \to \Delta \to 1.
\]
Applying $\Hom(-, \EEx)$ and using the fact that every homomorphism $G(k) \to \EEx$ vanishes on $G\der(k)$, we get
\[
1 \to \Delta^* \to G\ab(k)^* \to G(k)^* \to 1.
\]

Combining Theorems \ref{thm:trfrobiso} and \ref{thm:Gab} gives an isomorphism $\CCSiso{G} \to G\ab(k)^*$.
We may thus ask for a condition on a commutative character sheaf on $G$ that corresponds to having trivial
trace of Frobenius, with the expectation that the isomorphism classes of such commutative character sheaves
should be in natural bijection with $\Delta^*$.

Note that when $\Hh^1(k,G\der) = 0$, as is the case when $G\der(\bFq)$ ``is simply connected,'' then
we succeed in geometrizing characters of $G(k)$ on the nose.

% \begin{corollary}
% If $\Hh^1(\Fq,G\der)=0$ then
%the following diagram of isomorphisms commutes.
%\[
%\begin{tikzcd}
%\CCSiso{G} \arrow{r} & G(\Fq)^*\\
%\arrow{u}{q^*} \CCSiso{G\ab} \arrow{r} & \arrow{u} G\ab(\Fq)^* 
%\end{tikzcd}
%\]
% \end{corollary}
% 
% \begin{proof}
% By Theorem \ref{thm:trfrobiso}, $\CCSiso{G}\to G(\Fq)^*$ and $\CCSiso{G\ab}\to G\ab(\Fq)^*$ are isomorphisms.
%By Theorem~\ref{thm:Gab}, $\CCSiso{G} \iso \CCSiso{G\ab}$.
%Since $\Hh^1(\Fq,G\der)=0$, we have  $G\ab(\Fq) = G(\Fq)/G\der(\Fq)$.
%Thus, all characters of $G(\Fq)$ factor through
% $G\ab(\Fq)$. . . . 
% The isomorphisms are compatible because  . . . 
% \end{proof}


\subsection{Commutative quasicharacter sheaves}

Let $K$ be a local field with residue field $\Fq$.
Let $\underline{G}$ be a smooth group scheme over $K$.
Set $G_n = \Gr^R_n(\underline{G})$; this is a smooth group scheme over $\Fq$.
Set $G = \Gr_R(\underline{G})$; this is a group scheme over $\Fq$ equipped with $G = \varprojlim_{n\in \NN} G_n$.
Let $\QCS(G)$ be the category of commutative character sheaves on $G$. . . .  as in \cite{cunningham-roe:13a}.

\begin{proposition}\label{prop:QCS}
$\Hom(\underline{G}(\OK),\EEx) \iso \QCSiso{G}$.
\end{proposition}

 \subsection{Geometric types for supercuspidal representations}


As proved in \cite{kim:07a}, many (complex) supercuspidal representations of $p$-adic groups can be built from the generic data of \cite{yu:01a}*{\S 15} and, moreover, the type (in the sense of \cite{bushnell-kutzko:98a}) of the resulting supercuspidal representations can be constructed directly from the generic data. 
Let us refer to the types arising in this manner as {\it generic types}.
In this section we show that, after fixing an isomorphism $\CC \approx \EE$, every generic type is geometrizable, in the sense that every part of generic type admits a description as a perverse sheaf, from which the type can be recovered.

Let $K$ be a $p$-adic field. Let $\G$ be a connected reductive linear algebraic group over $K$. 
A generic datum is a triple $(\vec{\G}, \pi_0, \vec{\phi})$ where: $\vec{\G}$ is a tower of $p$-adic groups $\G^0(K) \subset \G^1(K) \subset \cdots  \subset \G^d(K) = \G(K)$ (proper containment); $\pi_0$ is a depth-zero representation of $\G^0(K)$, and $\vec{\phi} = (\phi_0, \ldots , \phi_{d-1})$ where each $\phi_i : \G^i(K) \to \EEx$ is a quasicharacter (continuous group homomorphism).  

%The generic datum $(\vec{\G}, \pi_0, \vec{\phi})$ determines a type (in the sense of \cite{bushnell-kutzko:98a}) $(C, \rho)$ for $\G$, as explained in \cite{yu:construction}*{\S 15}, where $C \subset \G(K)$ is compact mod centre subgroup and $\rho$ is a representation of $C$. In \cite{yu:smooth} it is shown that the $C$ admits a smooth integral model, in the sense that there is a smooth group scheme $\underline{C}$ over $\OK$ such that $\underline{C}(\OK) = C$.

In \cite{yu:03a} it is shown that, for $0 \leq i < d$, the $p$-adic group $\G^i(K)$ admits a smooth integral model, in the sense that there is \todo{is $\underline{G}^i$ canonically determined?} a smooth group scheme $\underline{G}^i$ over $\OK$ such that $\underline{G}^i(\OK) = \G^i(K)$.
Set $G^i_n \ceq \Gr^R_n(\underline{G}^i)$ and $G^i \ceq \Gr_R(\underline{G}^i)$; 
then \[G^i(\Fq) = \G^i(K)\] (canonical isomorphism of groups).
In this way, $\vec{\G}$ determines a tower $\vec{G}$ of group schemes $G^0 \subset G^1 \subset \cdots  \subset G^{d-1}$ (proper containment) over $\Fq$, from which the tower of $p$-adic groups
$\G^0(K) \subset \G^1(K) \subset \cdots  \subset \G^{d-1}(K)$ can be recovered.

Using Corollary~\ref{cor:QCS} \todo{broken reference} we see that each quasicharacter $\phi_i : G^i(\Fq) \to \EEx$ determines a quasicharacter sheaf $\cs{L}^i$, unique up to isomorphism, from which the quasicharacter $\phi_i$ can be recovered using the trace of Frobenius. 
In fact, more is true. Let $n_i$ be the smallest non-negative integer $n$ such that $\phi_i : G^i(\Fq) \to \EEx$ factors through $G^i(\Fq) \to G^i_n(\Fq)$.
Then $\phi_i$ determines a commutative character sheaf $\cs{L}_{n_i}^i$, unique up to isomorphism, from which the quasicharacter $\phi_i$ can be recovered.
Then $\cs{A}_i\ceq \cs{L}_{n_i}^i[\dim G_{n_i}^i]$ is a perverse sheaf on $G_{n_i}^i$ from which the quasicharacter $\phi_i$ can be recovered.
In this way,  $\vec{\phi} = (\phi_0, \ldots , \phi_{d-1})$ determines perverse sheaves $\vec{\cs{A}} = (\cs{A}_0, \ldots , \cs{A}_{d-1})$ from which $\vec{\phi}$ can be recovered. 

Finally, consider the depth-zero supercuspidal representation $\pi_0$ of $\G^0(K)$.
Then $\pi_0$ is produced by compact induction from representation $\sigma$ of a compact mod centre subgroup $\underline{C}_0(\OK) \subset \G^0(K)$. Moreover, $C_0$ admits a smooth integral model $\underline{C}$ ...

\subsection{Toral supercuspidal representations of $p$-adic groups}



\bibliography{bibliography/Biblio}

\end{document}

Suppose there is some $f : H\times G\to G\times G$ such that the following diagram commutes.
\[
\begin{tikzcd}
\ &  \arrow{dl}[swap]{a} H \times G \arrow{dr}{p} \arrow{dd}[swap]{f} & \\
G & & G \\
& \arrow{ul}{m} G \times G \arrow{ur}[swap]{p_2} & 
\end{tikzcd}
\]
Then $f(h,g) = (a(h,g) g^{-1}, g)$.
Define $f_1: H\times G \to G$ by $f_1(h,g)\ceq a(h,g) g^{-1}$; then $f(h,g) = (f_1(h,g),g)$ and $f_1(h_1 h_2,g) = f_1(h_1, h_2\cdot g) f_1(h_2,g)$.

Every $H$-equivariant linear character sheaf $(\cs{L},\mu, \nu)$ uniquely determines an isomorphism 
\[
\beta_1 : f_1^*\cs{L} \to (\EE)_{H\times G}
\]
by $\beta \otimes \id_{p^*\cs{L}} = \nu \circ f^*\mu^{-1}$, or more precisely, by the following diagram of isomorphisms,
\[
\begin{tikzcd}
a^*\cs{L} \arrow{d}{m\circ f = a} \arrow{rrr}{\nu}
&&& p^*\cs{L}\\
f^* m^*\cs{L} \arrow{r}{f^*\mu} & 
f^*(\cs{L}\boxtimes \cs{L}) \arrow{d} & 
f_1^*\cs{L} \otimes p^*\cs{L} \arrow{r}{\beta\otimes \id_{p^*\cs{L}}} & 
(\EE)_{H\times G} \otimes p^*\cs{L} \arrow{u} \\
& f^*(p_1^*\cs{L}\otimes p_2^*\cs{L}) \arrow{r} & f^*p_1^*\cs{L}\otimes f^* p_2^*\cs{L} \arrow{u}{f_1 = p_1\circ f}[swap]{p = p_2\circ f} &
\end{tikzcd}
\]
In this way we see we may replace $(\cs{L},\mu,\nu)$ with an alternate triple, $(\cs{L},\mu,\beta_1)$, from which $(\cs{L},\mu,\nu)$ may be recovered.
The isomorphism $\beta_1 : f_1^*\cs{L} \to (\EE)_{H\times G}$ is constrained by two properties, corresponding to the diagrams in Sections [] and [].

\subsection{Quotient and restriction}

We now combine the material of the last two sections, by specializing to the following case: $H$ is a closed subgroup of $G$ and $q : G \to G/H$ is the fppf quotient, which exists in schemes by  . . .
