%%------------------------------------------------------%%
%% This file should be the main file of your article.   %%
%% Please uncomment exactly one of the following lines. %%
%%------------------------------------------------------%%

%% \documentclass[CM,Submssn]{degruyter-crelle}       %% Equations numbered as (1), (2) etc.
 \documentclass[CM,Submssn,SecEq]{degruyter-crelle} %% Equations numbered as (1.1), (1.2) etc.

%% Do not alter the following line.
\firstpage{}\volume{}\volumeyear{}\copyrightyear{}\doiyear{}\doi{}\received{XXX}\revised{XXX}

\title[The function-sheaf dictionary for smooth commutative group schemes]{The function-sheaf dictionary for smooth commutative group schemes over finite fields}

\author{Clifton}{Cunningham}{C.~Cunningham}{Calgary}
\author{David}{Roe}{D.~Roe}{Calgary}

\contact{Department of Mathematics and Statistics, University of Calgary, 2500 University Drive, T2N 1N4, Calgary, Canada}{cunning@math.ucalgary.ca}
\contact{Pacific Institute for the Mathematical Sciences, University of Calgary, 2500 University Drive, T2N 1N4, Calgary, Canada}{roed.math@gmail.com}

%\subjclass[2010]{14F05 (primary), 14L15 (secondary)}
%\keywords{function-sheaf dictionary, trace of Frobenius, geometrization, categorification, quasicharacters, quasicharacter sheaves, smooth commutative group schemes, finite fields, local fields, algebraic tori, Neron models, Greenberg functor}

\researchsupported{We gratefully acknowledge the financial support of the Pacific Institute for the Mathematical Sciences and the National Science and Engineering Research Council (Canada), as well the hospitality of the Banff International Research Station during a Research in Teams program.}

%% Define theorem-like environments as usual:

%\theoremstyle{plain}
 %\newtheorem{theorem}{Theorem}[section]

%\theoremstyle{definition}
% \newtheorem{remark}[theorem]{Remark}

%%%%%%%%%%%%%%%%% PACKAGES %%%%%%%%%%%%%%%%%
% Encodings
%\usepackage[utf8]{inputenc}
%\usepackage[T1]{fontenc}
% AMS packages
%\usepackage{amsmath, amsthm, amssymb}
\usepackage{todonotes}%, showkeys}
\usepackage{amsrefs}
% Fonts
\usepackage{mathrsfs, yfonts}
%Geometry
%\usepackage{geometry}
% Enumitem
\usepackage{enumitem}
% TikZ
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,calc,matrix}
\usepackage{tikz-cd}
% Hyperrefs
\usepackage{hyperref}

%%%%%%%%%%%%%%% COUNTER %%%%%%%%%%%%%%%
%\setcounter{section}{-1}
%%%%%%%%%%%%%%% THEOREM STYLES %%%%%%%%%%%%%%%
\theoremstyle{plain}
      \newtheorem{theorem}{Theorem}[section]
      \newtheorem*{theorem*}{Theorem}
      \newtheorem{proposition}[theorem]{Proposition}
      \newtheorem{lemma}[theorem]{Lemma}
      \newtheorem{corollary}[theorem]{Corollary}

      \theoremstyle{definition}
      \newtheorem{definition}[theorem]{Definition}

      \theoremstyle{remark}
      \newtheorem{remark}[theorem]{Remark}

%%%%%%%%%%%%%%%% TIKZ SETTINGS %%%%%%%%%%%%%%%%
\tikzset{every picture/.style={>=stealth},label/.style={font=\footnotesize}}

%%%%%%%%%%%%%%% RINGS AND GROUPS %%%%%%%%%%%%%%%
\newcommand{\FF}{{\mathbb{F}}}
\newcommand{\ZZ}{{\mathbb{Z}}}
\newcommand{\NN}{{\mathbb{N}}}
\newcommand{\CC}{{\mathbb{C}}}
\newcommand{\QQ}{{\mathbb{Q}}}
\newcommand{\RR}{{\mathbb{R}}}
\newcommand{\EE}{\mathbb{\bar Q}_\ell}
\newcommand{\Zl}{\mathbb{\bar Z}_\ell}
\newcommand{\OK}{\mathcal{O}_K}
%\newcommand{\pK}{\mathfrak{p}_K}
%\newcommand{\OKp}{\mathcal{O}_{K'}}
%\newcommand{\pKp}{\mathfrak{p}_{K'}}
\newcommand{\OL}{\mathcal{O}_L}
\newcommand{\OO}[1]{\mathcal{O}_{#1}}
%\newcommand{\Zp}{\mathbb{Z}_p}
%\newcommand{\Qp}{\mathbb{Q}_p}
\newcommand{\bFq}{\bar{k}}
\newcommand{\Fq}{k}
\newcommand{\Fqm}{k_m}
%\newcommand{\WW}{\mathbb{W}}
\newcommand{\EEx}{\EE^\times}
\newcommand{\Zlx}{\mathbb{\bar Z}_\ell^\times}
\newcommand{\Weil}[1]{\mathcal{W}_{#1}}
\newcommand{\m}{{\mathfrak{m}}}
%%%%%%%%%%%%%%% ALGEBRAIC GROUPS %%%%%%%%%%%%%%%
%\newcommand{\mathswab}[1]{\operatorname{\textswab{#1}}}
\newcommand{\Gm}[1]{\mathbb{G}_{\hskip-1pt\textbf{m},#1}}
%\newcommand{\GN}[1]{\mathswab{#1}}
%\newcommand{\bGN}[1]{{\bar{\mathswab{#1}}}}
%\newcommand{\TT}{\underline{T}}
%\newcommand{\TL}{\underline{T_L}}
%\newcommand{\TTp}{\underline{T}'}
\newcommand{\comp}{\Pi} % Component group
%%%%%%%%%%%%%%% NAMED OPERATORS %%%%%%%%%%%%%%%
\DeclareMathOperator{\Gal}{Gal}
\DeclareMathOperator{\W}{W}
\newcommand{\Frob}[1]{\operatorname{F}_{#1}}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\ord}{ord}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\Gr}{Gr}
\DeclareMathOperator{\Irrep}{Irrep}
\DeclareMathOperator{\Pic}{Pic}
\DeclareMathOperator{\id}{id}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Hh}{H}
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\Nm}{Nm}
\DeclareMathOperator{\trace}{Tr}
\DeclareMathOperator{\obj}{obj}
\DeclareMathOperator{\mor}{mor}
\DeclareMathOperator{\Lang}{Lang}
\DeclareMathOperator{\image}{im}
\DeclareMathOperator{\Loc}{Loc}
\DeclareMathOperator{\Tot}{Tot}
\newcommand{\gal}[1]{{\operatorname{Gal}\hskip-1pt\left( {\bar #1}/#1 \right)}}
\newcommand{\Spec}[1]{{\operatorname{Spec}\hskip-1pt( #1 )}}
%%%%%%%%%%%% MISCELLANEOUS OPERATORS %%%%%%%%%%%%
\newcommand{\sheafHom}{{\mathscr{H}\hskip-4pt{\it o}\hskip-2pt{\it m}}}
\newcommand{\abs}[1]{{\vert #1 \vert}}
\newcommand{\ceq}{{\, :=\, }}
\newcommand{\tq}{{\ \vert\ }}
\newcommand{\iso}{{\ \cong\ }}
\newcommand{\trFrob}[1]{t_{#1}}
\newcommand{\TrFrob}[1]{T_{#1}}
\newcommand{\lTrFrob}[1]{\TrFrob{#1}^2}
%% Limits
\newcommand{\invlim}[1]{\lim\limits_{\overleftarrow{#1}}}
\newcommand{\dirlim}[1]{\lim\limits_{\overrightarrow{#1}}}
\newcommand{\limit}[1]{\mathop{\textsc{lim}}\limits_{#1}}
\newcommand{\colimit}[1]{\mathop{\textsc{colim}}\limits_{#1}}
%% Fonts for quasicharacter sheaves
\newcommand{\qcs}[1]{{\mathcal{#1}}}
\newcommand{\gqcs}[1]{{\mathcal{\bar #1}}}
\newcommand{\dualgcs}[1]{\gqcs{#1}^\dagger}
\newcommand{\dualcs}[1]{\qcs{#1}^\dagger}
%% Categories
\newcommand{\QC}{{\mathcal{Q\hskip-0.8pt C}}}
\newcommand{\lQC}{{\QC_\text{flb}}}
\newcommand{\lQCiso}[1]{\lQC(#1)_{/\text{iso}}}
\newcommand{\bQC}{{\QC_0}}
%\newcommand{\fQC}{{\QC_\text{fin}}}
\newcommand{\QCiso}[1]{\QC(#1)_{/\text{iso}}}
\newcommand{\bQCiso}[1]{\bQC(#1)_{/\text{iso}}}
%\newcommand{\fQCiso}[1]{\fQC(#1)_{/\text{iso}}}
\newcommand{\catname}[1]{\normalfont{\textsf{#1}}}
\newcommand{\Sch}[1]{{\catname{Sch}_{/#1}}}
%% amsmath replacements for \atop
\newcommand{\latop}[2]{\genfrac{}{}{0pt}{0}{#1}{#2}}
\newcommand{\partop}[2]{\genfrac{(}{)}{0pt}{0}{#1}{#2}}
%% Labeled items
\makeatletter
\newcommand{\labitem}[2]{
\def\@itemlabel{\textbf{#1}}
\item
\def\@currentlabel{#1}\label{#2}}
\makeatother
%% Shorthand for bars
\renewcommand{\bf}{\bar{f}}
\newcommand{\bg}{\bar{g}}
\newcommand{\bm}{\bar{m}}
\newcommand{\bG}{\bar{G}}
\newcommand{\bH}{\bar{H}}
%% Spacing control
\newcommand{\tight}[3]{\hspace{-#1pt}{#2}\hspace{-#3pt}}
\newcommand{\GxG}{\text{$G \tight{1}{\times}{1} G$}}
\newcommand{\bGxG}{\text{$\bar{G} \tight{1}{\times}{1} \bar{G}$}}
\newcommand{\bfxf}{\text{$\bar{f} \tight{1}{\times}{1} \bar{f}$}}
\newcommand{\GxxG}{\text{$G \tight{1}{\times}{1} G$}}
\newcommand{\LxL}{\text{$\gqcs{L} \tight{0}{\boxtimes}{0} \gqcs{L}$}}
\newcommand{\ExE}{\text{$\qcs{E}\tight{0}{\boxtimes}{0}\qcs{E}$}}
\newcommand{\bExE}{\text{$\gqcs{E}\tight{0}{\boxtimes}{0}\gqcs{E}$}}
\newcommand{\AxA}{\text{$A \tight{1}{\times}{1} A$}}
\newcommand{\BxB}{\text{$B \tight{1}{\times}{1} B$}}
\newcommand{\GzxGz}{\text{$G^0 \tight{1}{\times}{1} G^0$}}
%% Margin notes
\newcommand\Clifton[1]{\marginpar{\smaller\smaller CC: #1}}
\newcommand\David[1]{\marginpar{\smaller\smaller DR: #1}}
%% Hyphenation override
\hyphenation{quasi-character}


%%%%%%%%%%%% BEGIN DOCUMENT %%%%%%%%%%%

\begin{document}

\begin{abstract}
By extending the scope of function-sheaf dictionary for connected commutative algebraic groups, we find a geometrization of characters of all smooth commutative group schemes over finite fields.
As an application, we explain how to geometrize and categorify quasicharacters of all connected commutative algebraic groups over non-Archimedean local fields that admit a locally finite type Neron model, such as algebraic tori, abelian varieties and unipotent K-wound groups.
\end{abstract}

%% \tableofcontents %% Just for papers exceeding 50 pages.


\section*{Introduction}

%\subsection{Overview}

Motivated by an application to the geometrization and categorification of quasicharacters of $p$-adic tori,
this paper extends Deligne's function-sheaf dictionary to smooth commutative group schemes over finite fields. 

As Deligne explained in \cite{deligne:SGA4.5}*{Sommes trig.}, if $G$ is a connected commutative algebraic group over $\FF_q$, then the trace of Frobenius provides a bijection between the group $G(\FF_q)^*$ of $\ell$-adic characters of $G(\FF_q)$ and isomorphism classes of rank-one $\ell$-adic local systems $\mathcal{E}$ on $G$ for which 
\begin{equation}\label{introbox}
m^* \qcs{E} \iso \qcs{E} \boxtimes \qcs{E},%\tag{0}
\end{equation}
where $m : G\times G\to G$ is the multiplication map.
%
If one wishes to make a category from this class of local systems, one is led to consider morphisms $\qcs{E} \to \qcs{E}'$ of sheaves which are compatible with particular choices of \eqref{introbox} for $\qcs{E}$ and $\qcs{E'}$. 
{\it A priori}, the composition $\qcs{E} \to \qcs{E}' \to \qcs{E}''$ of two such morphisms need not be compatible with the choices of \eqref{introbox} for $\qcs{E}$ and $\qcs{E}''$ since the choice for $\qcs{E}'$ might differ.  However, for connected $G$ the isomorphism \eqref{introbox} is unique if it exists, and there is no impediment to making the dictionary categorical.

If $G$ is a commutative algebraic group over $\FF_q$ which is not connected, then the isomorphism \eqref{introbox} need not be unique, so one must keep track of the choice. This leads to the category of pairs $(\qcs{E},\mu_\qcs{E})$ where $\qcs{E}$ is a rank-one local system on $G$ and $\mu_\qcs{E} : m^*\qcs{E} \to \qcs{E}\boxtimes\qcs{E}$ is a chosen isomorphism of local systems on $G\times G$. 
%If the component group scheme $\pi_0(G)$ is not cyclic, then 
In this case, the trace of Frobenius provides an epimorphism from isomorphism classes of pairs $(\qcs{E},\mu_\qcs{E})$ to characters of $G(\FF_q)$, but that group homomorphism need not be injective; consequently,
every character of $G(\FF_q)$ may be geometrized as a pair $(\qcs{E},\mu_\qcs{E})$ but perhaps not uniquely in the category of pairs. 
While this might appear to be a defect in the dictionary for characters of commutative algebraic groups over finite fields, it is not serious: if $(\qcs{E},\mu_\qcs{E})$ and $(\qcs{E}',\mu_\qcs{E}')$ determine the same character of $G(\FF_q)$ then $\qcs{E}\iso \qcs{E}'$ as local systems on $G$.

In order to extend the dictionary from commutative algebraic groups over finite fields to smooth commutative group schemes $G$ over $\FF_q$,
we simply replace the local system $\qcs{E}$ on $G$ with a Weil local system while retaining the extra structure $\mu_\qcs{E}$. 
In this way we are led to the category $\QC(G)$ of {\it quasicharacter sheaves} on $G$ (\S\ref{ssec:category}).
Objects in $\QC(G)$ are triples $(\gqcs{L}, \mu,\phi)$, where $\gqcs{L}$ is a rank-one local system on ${\bar G} := G\times_{\Spec{\FF_q}} \Spec{{\bar \FF}_q}$
and $\phi : \Frob{G}^* \gqcs{L}\to \gqcs{L}$ and $\mu : {\bar m}^* \gqcs{L} \iso \gqcs{L} \boxtimes \gqcs{L}$ are isomorphisms of sheaves satisfying a certain compatibility condition.
Morphisms in $\QC(G)$ are then morphisms of Weil sheaves which are compatible with the extra structure.

We first test the category of quasicharacter sheaves by examining its objects on \'etale commutative group schemes $G$ over $\FF_q$ (\S\ref{sec:etale});
\'etale group schemes form a counterpoint to connected algebraic groups, since the component group of any smooth group scheme is an \'etale group scheme.
Our key tools for understanding the trace of Frobenius in the \'etale case are a reinterpretation of $\QC(G)$ in terms of stalks (\S\ref{ssec:stalks}) and a
relationship with the Hochschild-Serre spectral sequence (\S\ref{ssec:E}) for $\Weil{} \ltimes \bG$, where $\Weil{} \subset \Gal({\bar\FF}_q/\FF_q)$ is the Weil group for $\FF_q$.
We define (\S\ref{ssec:S}) an isomorphism $S_G$ from $\QCiso{G}$ to the second cohomology of the total space of the spectral sequence
\[
E_2^{p,q} \ceq \Hh^p(\Weil{}, \Hh^q(\bG, \EEx)) \Rightarrow \Hh^{p+q}(\Weil{} \ltimes \bG, \EEx).
\]
Paired with the short exact sequence
\[
  0 \to \Hh^0(\Weil{},\Hh^2({\bar G},\EEx)) \to \Hh^2(E^\bullet_G) \to \Hh^1(\Weil{},\Hh^1({\bar G},\EEx)) \to 0
\]
arising from the spectral sequence, the isomorphism $S_G$ allows us to show (\S\ref{ssec:SandT}) that 
%$\TrFrob{G}$ is surjective with kernel $\Hh^2(\bG,\EEx)^{\Weil{}}$. We find that 
the group homomorphism 
\[
T_G: \QCiso{G} \to G(\FF_q)^*
\]
provided by the trace of Frobenius is surjective with kernel $\Hh^2(\bG,\EEx)^{\Weil{}}$.
One can show, using the K\"unneth formula, that $\Hh^2(\bG,\EEx)$ is non-trivial unless $\bG$ is cyclic.
The fact that $T_G$ may not be an isomorphism should not be too troubling: if quasicharacter sheaves $(\gqcs{L}, \mu,\phi)$ and $(\gqcs{L}', \mu',\phi')$
determine the same character of $G(\FF_q)$ then $(\gqcs{L},\phi)$ and $(\gqcs{L}',\phi')$ are isomorphic as Weil sheaves.

Returning to the case of connected commutative algebraic groups $G$, we consider quasicharacter sheaves that arise via base change to $\bFq$ from local systems on $G$ (\S\ref{ssec:descentG}) and
those that appear in a pushforward from a constant sheaf along a discrete isogeny $H \to G$ (\S\ref{ssec:discrete_isogenies}).  While these constructions make sense even for non-connected $G$, in the connected
case we show that every quasicharacter sheaf can be described in both of these ways (\S\ref{ssec:connected}).  We use this fact to prove that $T_G$ is an isomorphism for connected commutative algebraic groups $G$
and to determine the automorphism groups of quasicharacter sheaves on such $G$.

%
%The appearance of $\Hh^2(\bG,\EEx)^{\Gal({\bar\FF}_q/\FF_q)}$ in these two cases is interesting: on the one hand, when $G$ is a connected commutative algebraic group over $\Fq$, isomorphism classes of quasicharacter sheaves on $G$ are measured by $\Hh^2(\bG,\EEx)^{\Gal({\bar\FF}_q/\FF_q)}$ and the trace of Frobenius gives an isomorphism $T_G: \QCiso{G} \to \Hom(G(\FF_q),\EEx)$; on the other hand, if $G$ an etale commutative group scheme over $\FF_q$, then $\Hh^2(\bG,\EEx)^{\Gal({\bar\FF}_q/\FF_q)}$ measures the kernel of $T_G: \QCiso{G} \to \Hom(G(\FF_q),\EEx)$. 
%This observation makes plain the fact that  . . .
%Indeed, quasicharacter sheaves on \'etale commutative group schemes that are trivialized by discrete isogenies are invisible to the trace of Frobenius.

Having understood quasicharacter sheaves on commutative smooth group schemes over $\FF_q$ in two extreme cases --
connected commutative algebraic groups and \'etale commutative group schemes -- we turn to the general case.
We find that the general case can be understood from these two extreme cases using the component group sequence
\[
0 \to G^0 \to G \to \pi_0(G) \to 0.
\]
Using pullbacks of quasicharacter sheaves (\S\ref{ssec:Frob}), we obtain a diagram
\[
  \begin{tikzcd}[row sep=20, column sep=20]
    0 \rar & \QCiso{\pi_0(G)} \rar \dar{\TrFrob{\pi_0(G)}}
    & \QCiso{G} \rar \dar{\TrFrob{G}} & \QCiso{G^0} \rar \dar{\TrFrob{G^0}} & 0\\
    0 \rar & \pi_0(G)(\FF_q)^* \rar & G(\Fq)^* \rar & G^0(\FF_q)^* \rar & 0.
  \end{tikzcd}
\]
The rows of this diagram are exact (\S\S\ref{ssec:restriction},\ref{ssec:component}), so we may apply the snake lemma to prove the main theorem of the paper
\begin{theorem*}[{Thm. \ref{thm:snake}}]
If $G$ is a smooth commutative group scheme over $\FF_q$ then
\[
\TrFrob{G} : \QCiso{G} \to G(\FF_q)^*
\]
is surjective with kernel $\Hh^2(\pi_0(\bG),\EEx)^{\Weil{}}$.
\end{theorem*}
We also illuminate the nature of the category $\QC(G)$ by showing that every morphism in this category is either an isomorphism or trivial, and by showing that
\begin{theorem*}[{Thm. \ref{thm:autornaught}}]
If $G$ is a smooth commutative group scheme over $\FF_q$ then
\[
\Aut(\qcs{L}) \iso \Hom(\pi_0(\bG)_{\Weil{}},\EEx),
\]
for all quasicharacter sheaves $\qcs{L}$ on $G$.
\end{theorem*}

%Here we also see the importance of working with Weil sheaves: sheaves on $G$ itself only allow us to geometrize characters with compact image.
%We conclude in Section~\ref{ssec:basechange} by
%giving functorial versions of the restriction and norm homomorphisms 
%of character groups $G(k')^* \to G(k)^*$ and $G(k)^* \to G(k')^*$
%and describing how quasicharacter sheaves behave under Weil restriction.

%\subsection{Applications over local fields}

As indicated above, our interest in the function-sheaf dictionary for smooth commutative group schemes
over finite fields comes from an application to $p$-adic representation theory. 
However, we found that our method of passing from $p$-adic tori to group schemes over $\FF_q$ applies more generally to
any local field $K$ with finite residue field $\Fq$ and any algebraic group $X_K$ that admits a N\'eron model $X$ over $R$, the ring of integers of $K$.
This class of groups includes abelian varieties and unipotent $K$-wound groups in addition to the tori we initially considered.
In this paper we show that quasicharacters of $X(K)$ are geometrized and categorified by quasicharacter sheaves on the
Greenberg transform $\Gr_R(X)$ of the N\'eron model $X$.
Although not locally of finite type, $\Gr_R(X)$ is a commutative group scheme over $\Fq$ and also a projective limit of smooth commutative group schemes $\Gr^R_n(X)$.
This structure allows us to adapt our work on quasicharacter sheaves to construct (\S\ref{ssec:qc_on_GN}) a category $\QC(X_K)$
of quasicharacter sheaves for $X_K$, which are certain sheaves on $\Gr_R(X)\times_{\Spec{\Fq}} \Spec{\bFq}$, with extra structure.
The ability to generalize the function-sheaf dictionary to non-connected group schemes plays a crucial role in this application.

Having defined quasicharacter sheaves for groups over $K$ and $\Fq$, we consider how
these categories are related as $K$ and $\Fq$ vary.  We describe (\S\ref{ssec:basechange}) functors between categories
of quasicharacter sheaves that model restriction and norm homomorphisms of character groups $G(k')^* \to G(k)^*$ and $G(k)^* \to G(k')^*$,
and describe how quasicharacter sheaves behave under Weil restriction (\S\ref{ssec:wrK}).  We also give (\S\ref{ssec:transfer})
a categorical version of a result of Chai and Yu \cite{chai-yu:01a},
relating quasicharacter sheaves for tori over different local fields, even local fields
with different characteristic.

Specializing to the case that $X = T$ is the N\'eron model of an algebraic torus (\S\ref{ssec:qc_tori}), 
we give a canonical short exact sequence 
\[
0 \to \Hh^2(X_*(T_K)_{\mathcal{I}_K},\EEx)^{\Weil{}} \to \QCiso{T_K} \to \Hom_\text{qc}(T(K),\EEx) \to 0,
\]
where $\Hom_\text{qc}(T(K),\EEx)$ denotes the group of quasicharacters of $T(K)$.
We further show that automorphism groups in $\QC(T)$ are given, for every quasicharacter sheaf $\qcs{F}$ for $T_K$, by
\[
\Aut(\qcs{F}) \iso (\check{T}_\ell)^{\Weil{K}},
\]
where $\Weil{K}$ is the Weil group for $K$ and $\check{T}_\ell$ is the $\ell$-adic dual torus to $T$.
%We also use quasicharacter sheaves to categorify the transfer of quasicharacters of tori between characteristic $0$ and characteristic $p$ local fields.

By any measure, there are more quasicharacter sheaves for $T$ than quasicharacters of $T(K)$.  
In this regard, we are reminded of the work of David Vogan \cite{vogan:93a}, in which he finds a geometrization of complete Langlands parameters for $p$-adic groups 
and, in the process, is led to study the representations of all the pure rational forms of the $p$-adic group simultaneously.
A similar phenomenon appears in recent work by Joseph Bernstein in which his geometric Ansatz leads to the study of certain sheaves on the stacky classifying space of the $p$-adic group, resulting in a category which appears to be tied to the representations of all the pure rational forms of the $p$-adic group \cite{bernstein:vogan_conference}.
Indeed, Bernstein has suggested to us that our category of quasicharacters for $T$ may be tied to quasicharacters of all the pure rational forms of $T$.

The process of creating a category from the group of quasicharacters of a $p$-adic  torus informs our choice of the term quasicharacter sheaf in this paper.
We also want to situate our terminology in a historical context.
It is not uncommon to refer to local systems satisfying \eqref{introbox} on a connected, commutative algebraic group as character sheaves;
see for example, \cite{kamgarpour:09a}*{Intro}.
As we have indicated, quasicharacter sheaves evolved from this notion,
with an eye toward quasicharacters of $p$-adic groups.
However, the main use of the term character sheaf is of course due to Lusztig.
It is applied to certain perverse sheaves on connected reductive algebraic groups over algebraically closed fields in
\cite{lusztig:85a}*{Def.~2.10} and to certain perverse sheaves on reductive groups
over algebraically closed fields with finite cyclic component groups in the series of papers
beginning with \cite{lusztig:disconnected1}.
When commutative, such groups are extensions of finite cyclic groups by algebraic tori,
in which case it is not difficult to relate Frobenius-stable character sheaves to our quasicharacter sheaves.
The new features that we have found pertaining to Weil sheaves and the non-triviality of $\Hh^2(\pi_0({\bar G}),\EEx)^{\Weil{}}$ do not arise in this context.

%\tableofcontents

\section{The category of quasicharacter sheaves} \label{sec:category}


\subsection{Notations}\label{ssec:notation}

Throughout this paper, $G$ is a smooth commutative group scheme
over a finite field $\Fq$, and $m : \GxG\to G$ is its multiplication morphism.

We fix an algebraic closure $\bFq$ of $\Fq$ and write $\bG$ for the
smooth commutative group scheme $G \times_{\Spec{\Fq}} \Spec{\bFq}$ over $\bFq$
obtained by base change from $k$. The multiplication morphism for $\bG$ will be denoted by $\bm$.

Let $\Frob{}$ denote the geometric Frobenius element in $\Gal(\bFq/\Fq)$ as
well as the corresponding automorphism of $\Spec{\bFq}$. The Weil group
$\Weil{}\subset \Gal(\bFq/\Fq)$ is the subgroup generated by $\Frob{}$.
Let $\Frob{G} \ceq \id_{G} \times \Frob{}$ be the Frobenius automorphism of $\bG = G \times_{\Spec{\Fq}} \Spec{\bFq}$.
%When no other fields play a role we will write $\Frob{}$ and $\Weil{}$ instead.

We fix a prime $\ell$, invertible in $\Fq$.
We will work with constructible $\ell$-adic sheaves \citelist{\cite{deligne:80a}*{\S 1.1} \cite{SGA5}*{Expos\'es V, VI}}
on schemes locally of finite type over $\Fq$, employing the standard formalism.
We also make extensive use of the external tensor product of $\ell$-adic sheaves,
defined as follows: if $\mathcal{F}$ and $\mathcal{G}$ are constructible $\ell$-adic
sheaves on schemes $X$ and $Y$ and $p_X : X\times Y\to X$ and $p_Y : X\times Y \to Y$
are the projections, then $\mathcal{F}\boxtimes \mathcal{G} \ceq p_X^* \mathcal{F} \otimes p_Y^*\mathcal{G}$.

For any abelian group $A$, we will write $A^*$ for the dual group $\Hom(A, \EEx)$.

\subsection{The category of quasicharacter sheaves}\label{ssec:category}

\begin{definition}\label{def:QC}
A \emph{quasicharacter sheaf on $G$} is a triple
$\qcs{L}\ceq (\gqcs{L},\mu,\phi)$ where:
\begin{enumerate}
\labitem{(QC.1)}{QC.1} $\gqcs{L}$ is a rank-one $\ell$-adic local system on $\bG$, by which we mean a constructible $\ell$-adic sheaf on $\bG$, {\it lisse} on each connected component of $\bG$, whose stalks are one-dimensional $\EE$-vector spaces;
\labitem{(QC.2)}{QC.2} $\mu: \bm^* \gqcs{L} \to \LxL$ is an isomorphism of
sheaves on $\bGxG$ such that the following diagram commutes,
  where $m_3 \ceq m\circ (m\tight{1}{\times}{2}\id) = m\circ (\id\tight{2}{\times}{1} m)$;
  \[
  \begin{tikzcd}[row sep=30]
  \bm_3^*\gqcs{L} \arrow{rr}{(\bm \tight{1}{\times}{2} \id)^*\mu} \arrow[swap]{d}{(\id \tight{2}{\times}{1} \bm)^*\mu}
    &&  \bm^*\gqcs{L} \boxtimes \gqcs{L} \dar{\mu \tight{0}{\boxtimes}{1} \id} \\
    \gqcs{L} \boxtimes \bm^* \gqcs{L} \arrow{rr}{\id \boxtimes \mu}
    &&  \gqcs{L} \tight{0}{\boxtimes}{0} \LxL
  \end{tikzcd}
  \]
\labitem{(QC.3)}{QC.3} $\phi : \Frob{G}^* \gqcs{L} \to \gqcs{L}$ is an
  isomorphism of constructible $\ell$-adic sheaves on $\bG$ compatible with
  $\mu$ in the sense that the following diagram commutes.
  \[
  \begin{tikzcd}[row sep=20]
  \Frob{\GxxG}^* \bm^* \gqcs{L} \arrow{rr}{\Frob{\GxxG}^*\mu}
    && \Frob{\GxxG}^*(\LxL)\\
    \arrow[equal]{u} \bm^*  \Frob{G}^* \gqcs{L} \arrow[swap]{d}{\bm^* \phi}
    && \Frob{G}^*\gqcs{L}\boxtimes \Frob{G}^*\gqcs{L} \dar{\phi\boxtimes \phi} \arrow[equal]{u} \\
    \bm^*\gqcs{L} \arrow{rr}{\mu}
    && \LxL
  \end{tikzcd}
  \]
\end{enumerate}
\end{definition}

Morphisms in the category of quasicharacter sheaves on $G$, denoted by $\QC(G)$, are defined in the natural way:
\begin{enumerate}
\labitem{(QC.4)}{QC.4} if $\qcs{L} = (\gqcs{L},\mu,\phi)$ and
  $\qcs{L'} = (\gqcs{L'},\mu',\phi')$ are quasicharacter sheaves on $G$ then
  a morphism $\qcs{L} \to \qcs{L}'$ is a map $\rho : \gqcs{L} \to \gqcs{L'}$
  of constructible $\ell$-adic sheaves on $\bG$ such that the following diagrams both commute.
  \[
  \begin{tikzcd}[column sep=40]
  \Frob{G}^* \gqcs{L} \rar{\Frob{G}^* \rho} \arrow[swap]{d}{\phi} & \Frob{G}^* \gqcs{L'} \dar{\phi'}
  & & \arrow[swap]{d}{\mu} m^* \gqcs{L} \rar{m^* \rho} & m^* \gqcs{L'} \dar{\mu'} \\
  \gqcs{L} \rar{\rho} & \gqcs{L'}
  & {} & \LxL \rar{\tight{1}{\rho\boxtimes \rho}{1}} & \gqcs{L'} \tight{0}{\boxtimes}{0} \gqcs{L'}
  \end{tikzcd}
  \]
\end{enumerate}

Category $\QC(G)$ is a rigid monoidal category
\cite{etingof:09a}*{\S1.10} under the tensor product
$\qcs{L} \otimes \qcs{L'}$ defined by $(\gqcs{L}\otimes\gqcs{L'}, \mu\otimes\mu', \phi\otimes \phi')$,
with duals given by applying the sheaf hom functor
$\sheafHom(\ - \ ,\EE)$.
This rigid monoidal category structure for $\QC(G)$ gives the set $\QCiso{G}$
of isomorphism classes in $\QC(G)$ the structure of a group.

\begin{remark}
The category of quasicharacter sheaves on $G$ is not abelian since it is not closed under direct sums and thus $\QC(G)$
is not a tensor category in the sense of \cite{deligne:02a}*{0.1}.  We suspect that requiring that $\mu$ be injective rather than
an isomorphism and dropping the condition that the stalks be one-dimensional would yield an abelian category.
\end{remark}

We will describe the group $\QCiso{G}$ in Theorem~\ref{thm:snake}
and the sets $\Hom(\qcs{L},\qcs{L}')$ in Theorem~\ref{thm:autornaught}; in this way we provide a complete description of the category $\QC(G)$.
%
In the meantime, we close this section with an elementary observation about $\Hom(\qcs{L},\qcs{L}')$.

\begin{lemma}\label{lem:autornaught}
Let $G$ be a smooth commutative group scheme over $\Fq$.
If $\qcs{L}$ and $\qcs{L}'$ are quasicharacter sheaves on $G$ then
every $\rho\in \Hom(\qcs{L},\qcs{L}')$ is either trivial or an isomorphism. 
\end{lemma}

\begin{proof}
Suppose $\rho \in \Hom(\qcs{L},\qcs{L}')$.
We prove the lemma by considering the linear transformations $\rho_{\bar g} : \gqcs{L}_{\bar g} \to \gqcs{L}_{\bar g}$ at the stalks above geometric points ${\bar g}$ on $G$ and showing that, either each $\rho_{\bar g}$ trivial or each $\rho_{\bar g}$ is an isomorphism.
(This idea is expanded upon in Section~\ref{ssec:stalks}.)
Let ${\bar e}$ be the geometric point above the identity $e$ for $G$ determined by our choice of algebraic closure $\bFq$ of $\Fq$.
If $\rho_{\bar e} = 0$ then the second diagram in \ref{QC.4} implies that $\rho_{\bar g} = 0$ for all ${\bar g}$, in which case $\rho$ is trivial.
On the other hand, if $\rho_{\bar e}$ is nontrivial then the second diagram in \ref{QC.4}  implies that $\rho_{\bar g}$ is nontrivial for all ${\bar g}$ and thus an isomorphism, since the stalk of quasicharacter sheaves are one-dimensional; in this case $\rho$ is an isomorphism.
\end{proof}


\subsection{Trace of Frobenius}\label{ssec:Frob}

In this section we introduce two tools which will help us understand isomorphism classes of objects in $\QC(G)$: the map $\QCiso{G} \to G(k)^*$ given by trace of Frobenius and the pullback functor $\QC(G) \to \QC(H)$ associated to a morphism $H \to G$.

%A Weil sheaf $(\gqcs{L},\phi)$ on $G$ may be interpreted as a constructible $\ell$-adic sheaf $\gqcs{L}$ on $\bG$ together with an action of the Weil group $\Weil{}$ on $\gqcs{L}$ compatible with the action of $\Gal(\bFq/\Fq)$ on $\bG$. 
%We now briefly review this point of view for later use in Section~\ref{ssec:basechange}; see also \cite{deligne:80a}*{Def.~1.1.10}.  If $w \ceq \Frob{}^n$ we write $w_G$ for $\Frob{G}^n$.
%For each such $w$ we define an isomorphism $\varphi(w) : w_G^* \gqcs{L}\to \gqcs{L}$ by $\varphi(w) \ceq  \phi \circ \Frob{G}^*(\phi) \circ \cdots \circ (\Frob{G}^{n-1})^*(\phi);$
%these isomorphisms satisfy $\varphi(uv) = \varphi(v) \circ v_G^* \varphi(u)$ for $u,v\in \Weil{}$, and we have $\phi = \varphi(\Frob{})$.
%If we further define $\varphi_1(w) \ceq (w_G)_*(\varphi(w)^{-1})$ then $\varphi_1(w) : (w_G)_* \gqcs{L}\to \gqcs{L}$ is an isomorphism and $\varphi_1(uv) = \varphi_1(u) \circ (u_G)_* \varphi_1(v)$ for $u,v\in \Weil{}$.
%Thus the pair $(\gqcs{L},\varphi_1)$ almost satisfies the criteria for an action of $\Weil{}$ on $\gqcs{L}$ compatible with the action of $\Gal(\bFq/\Fq)$ in the sense of\cite{deligne:SGA4.5}*{Expos\'e XIII, 1.1}, failing only because $\Weil{}$ is not profinite.
%As we will see in Corollary~\ref{cor:bounded-and-finite}, our use of $\Weil{}$ rather than $\Gal(\bFq/\Fq)$ allows quasicharacter sheaves to correspond to unbounded characters.

%Observe that the rule $(\gqcs{L},\mu,\phi) \mapsto (\gqcs{L},\phi)$ defines a forgetful functor from quasicharacter
%sheaves on $G$ to ($\ell$-adic) Weil sheaves on $G$ \cite{deligne:80a}*{Def.~1.1.10 (i)}.
%


Let $(\gqcs{L},\phi)$ be a Weil sheaf on $G$. Every $g\in G(\Fq)$
determines a geometric point $\bg$ fixed by $\Frob{G}$. 
Together with the canonical isomorphism $(\Frob{G}^*\gqcs{L})_{\bg} \iso  \gqcs{L}_{\Frob{G}(\bg)}$, the automorphism $\phi$ determines an automorphism $\phi_{\bg}$ of the $\EE$-vector space $\gqcs{L}_{\bg}$.
Let $\trace(\phi_{\bg};\gqcs{L}_{\bg})$ be the trace of $\phi_{\bg} \in \Aut_{\EE}(\gqcs{L}_{\bg})$ and let $\trFrob{(\gqcs{L},\phi)} : G(\Fq)\to \EE$ be the function defined by 
\begin{equation}\label{trWeil}
%\begin{equation}\label{trWeil}
\trFrob{(\gqcs{L},\phi)}(g) \ceq \trace(\phi_{\bg};\gqcs{L}_{\bg}),
%\end{equation}
\end{equation}
commonly called the {\em trace of Frobenius of $(\gqcs{L},\phi)$}.
Note that if $(\gqcs{L},\phi) \iso (\gqcs{L'},\phi')$ as Weil sheaves, 
then $\trFrob{(\gqcs{L},\phi)} = \trFrob{(\gqcs{L'},\phi')}$ as functions on $G(\Fq)$.

Now suppose $\qcs{L} = (\gqcs{L},\mu,\phi)$ is a quasicharacter sheaf on $G$.
Then $\bm^* \gqcs{L} \iso \gqcs{L} \boxtimes\gqcs{L} $ together with
\ref{QC.3} guarantee
that the function $\trFrob{(\gqcs{L},\phi)} : G(\Fq)\to \EEx$ is a group homomorphism, which we will also denote by $\trFrob{\qcs{L}}$.  Moreover,
this homomorphism depends only on the isomorphism class of $\qcs{L}$, so we obtain a map
\begin{align*}
\TrFrob{G} : \QCiso{G} &\to G(\Fq)^* \\
\qcs{L} &\mapsto \trFrob{\qcs{L}}.
\end{align*}
Since tensor products on the stalks of $\qcs{L}$ induce pointwise multiplication on the trace of Frobenius, $\TrFrob{G}$ is a group homomorphism.  We devote the remainder of this section to
studying the behavior of the trace of Frobenius under morphisms of group schemes.  These simple but important
results on pullbacks and external products will be used in the proofs of many results in this paper.

\begin{lemma}\label{lem:pullback}
  If $f : H\to G$ is a morphism of smooth commutative group schemes over $\Fq$ then
  \begin{align*}
  f^* : \QC(G) &\to \QC(H) \\
  (\gqcs{L},\mu,\phi) &\mapsto (\bf^*\gqcs{L},(\bfxf)^*\mu,\bf^*F)
  \end{align*}
  defines a monoidal functor dual to $f \colon H(\Fq) \to G(\Fq)$:
  \[
  \begin{tikzcd}[row sep=20, column sep=30]
   \QCiso{G} \rar{f^*} \arrow[swap]{d}{\TrFrob{G}} & \QCiso{H} \dar{\TrFrob{H}} \\
   G(\Fq)^* \rar & H(\Fq)^*
  \end{tikzcd}
  \]
  is a commutative diagram of groups.  Moreover, $(f\circ g)^* = g^* \circ f^*$.
\end{lemma}
\begin{proof}
  Let $\qcs{L}$ be a quasicharacter sheaf on $G$. 
  Pullback by $\bf$ takes rank~one local systems to rank~one local systems.
  To see that $(\bfxf)^* \mu$ satisfies \ref{QC.2},
  apply the functor $(\bfxf)^*$
  to \ref{QC.2} for $\qcs{L}$ and use the canonical isomorphism
  $(\bfxf)^*(\LxL) \iso \bf^*\gqcs{L} \tight{-3}{\boxtimes}{-3} \bf^*\gqcs{L}$.
  To show that $f^*\qcs{L}$ satisfies
  \ref{QC.3}, apply the same functor to \ref{QC.3} for $\qcs{L}$.
  Since $f$ is a morphism of group schemes defined over $\Fq$
  it provides isomorphisms $(\bfxf)^*\Frob{\GxxG}^* \iso \Frob{\GxxG}^* (\bfxf)^*$
  and $(\bfxf)^* \bm^*\iso \bm^* \bf^*$ between functors of constructible sheaves.

  Applying $\bf^*$ and $\bf^* \tight{1}{\times}{1}\bf^*$ to \ref{QC.4} defines the action
  of $f^*$ on morphisms of quasicharacter sheaves; arguing as above shows that $f^*$ is
  a functor from $\QC(G)$ to $\QC(H)$.  Since tensor products commute with pullback in schemes,
  $f^* : \QC(G) \to \QC(H)$ is a monoidal functor.
  The diagram relating $f^* : \QC(G) \to \QC(H)$, $f^* : G(k)^* \to H(k)^*$ and trace of Frobenius
  commutes by \cite{laumon:87a}*{1.1.1.2}, where the ambient
  hypothesis that $X$ is of finite type over $\Fq$ can be replaced by
  the hypothesis that $X$ is locally of finite type over $\Fq$.

  Finally, the fact that $(f\circ g)^* = g^* \circ f^*$ follows from the analogous
  statements about the pullback functor on $\ell$-adic constructible sheaves.
\end{proof}

%We end this section with a simple result on products of quasicharacter sheaves, which is needed to show that the isomorphism above is functorial.

\begin{lemma}\label{lem:product}
If $G_1$ and $G_2$ are smooth commutative group schemes over $\Fq$ then the rule
$\boxtimes : (\qcs{L}_1,\qcs{L}_2)\to \qcs{L}_1\boxtimes\qcs{L}_2$ defines an equivalence of categories
\[
\QC(G_1)\times \QC(G_2) \to \QC(G_1\times G_2)
\]
such that
\[
\begin{tikzcd}[column sep=60]
\arrow{d}{\TrFrob{G_1} \times \TrFrob{G_2}} \QCiso{G_1}\times \QCiso{G_2} \arrow{r}{\boxtimes}
& \arrow{d}{\TrFrob{G_1\times G_2}} \QCiso{G_1\times G_2}\\
(G_1)(\Fq)^*\times (G_2)(\Fq)^* \arrow{r}{(\chi_1,\chi_2)\mapsto \chi_1\otimes \chi_2}  & (G_1\times G_2)(\Fq)^*
\end{tikzcd}
\]
commutes.
\end{lemma}
\begin{proof}
The only non-trivial part of the proof is to show that 
\[\boxtimes
 : \QC(G_1)\times \QC(G_2) \to \QC(G_1\times G_2)
 \]
is essentially surjective, so we will only address that point here.

Set $G \ceq G_1\times G_2$
and write $e_1$ and $e_2$ for the identity elements of $G_1$ and $G_2$.
Define $f : G\to G\times G$ by $f(g_1,g_2) \ceq (g_1,e_2,e_1,g_2)$.
Observe that $m\circ f = \id_G$.
Let $p_1$, $p_2$ be the projection morphisms pictured below:
\[
\begin{tikzcd}
G & \arrow[swap]{l}{p_1} G\times G \arrow{r}{p_2} & G.
\end{tikzcd}
\]
Let $r_1$ and $r_2$ be the projection morphisms pictured below,
with sections $q_1$ and $q_2$, also morphisms of group schemes:
\[
\begin{tikzcd}
G_1  \arrow[swap, bend right]{r}{q_1} &
\arrow[swap, bend right]{l}{r_1} G_1\times G_2 \arrow[bend left]{r}{r_2} &
\arrow[bend left]{l}{q_2} G_2.
\end{tikzcd}
\]
Observe that $p_1\circ f = q_1 \circ r_1$ and $p_2 \circ f = q_2\circ r_2$.

Now, let $\qcs{L} \ceq (\gqcs{L},\mu,\phi)$ be a quasicharacter sheaf on $G$.
Set $\qcs{L}_1 \ceq q_1^* \qcs{L}$ and $\qcs{L}_2 \ceq q_2^* \qcs{L}$;
by Lemma~\ref{lem:pullback}, $\qcs{L}_1$ a quasicharacter sheaf on $G_1$
and $\qcs{L}_2$ is a quasicharacter sheaf on $G_2$.
We will obtain an isomorphism $\qcs{L} \iso  \qcs{L}_1\boxtimes \qcs{L}_2$.
Applying the functor $f^*$ to the isomorphism $\mu$ yields
\begin{equation}\label{eq:fm}
f^*\mu : f^* m^* \gqcs{L} \to f^*(\gqcs{L}\boxtimes \gqcs{L}) .
\end{equation}
We have already seen that $m\circ f = \id_G$, so $f^* m^* \gqcs{L} = \gqcs{L}$.  
Since $f^*p_1^*\gqcs{L} = r_1^* q_1^* \gqcs{L} = r_1^* \gqcs{L}_1$ and $f^*p_2^*\gqcs{L} = r_2^* q_2^* \gqcs{L} = r_2^*\gqcs{L}_2$,
we have 
\[
f^*(\gqcs{L}\boxtimes \gqcs{L})  = f^*p_1^*\gqcs{L}\otimes f^* p_2^*\gqcs{L} = \gqcs{L}_1\boxtimes \gqcs{L}_2.
\]
It follows that \eqref{eq:fm} gives an isomorphism $\gqcs{L} \to  \gqcs{L}_1\boxtimes \gqcs{L}_2$.
It is a matter of routine to show that this morphism satisfies
\ref{QC.3} as it applies here,
from which it follows that we have exhibited an isomorphism
$\qcs{L} \to \qcs{L}_1\boxtimes \qcs{L}_2$ of quasicharacters sheaves on $G\times G$.
This completes the proof that $\boxtimes$ is essentially surjective.
\end{proof}

Using these results on pullbacks and products, we may prove a naturality property of $\TrFrob{G}$.

\begin{proposition}\label{prop:functorialG}
Trace of Frobenius $\TrFrob{G} : \QCiso{G} \to G(\Fq)^*$ is a natural transformation
between the two contravariant additive functors
\begin{align*}
F_1 : G &\mapsto \QCiso{G} \\
F_2 : G &\mapsto G(\Fq)^*
\end{align*}
from the category of smooth commutative group schemes over $\Fq$ to the category of abelian groups.
%Likewise, for $\TrFrob{G} : \lQCiso{G} \to G(\Fq)^*$, {\it mut.\hskip-1pt mut.}
\end{proposition}

\begin{proof}
The first part of Lemma~\ref{lem:pullback} shows that $F_1$ is a functor,
while the second part shows that Trace of Frobenius is a natural transformation
$T: F_1 \to F_2$. When further combined with Lemma~\ref{lem:product},
we see that $F_1$ is an additive functor and $T: F_1 \to F_2$ is a natural
transformation between additive functors,
concluding the proof of Proposition~\ref{prop:functorialG}.
\end{proof}

%\subsection{Morphisms of quasicharacter sheaves}\label{ssec:mor}

\section{Quasicharacter sheaves on \'etale commutative group schemes} \label{sec:etale}

%\subsection{Quasicharacter sheaves, revisited}

%\'Etale group schemes form a counterpoint to connected groups,
%since the component group of a smooth commutative group scheme
%is an \'etale group scheme \cite{vdGeer-Moonen:AbelianVarieties}*{III, \S 4}.
%However, the function-sheaf dictionary is substantially different in the two cases.
%To see why, we begin by specializing the definition of quasicharacter sheaves to the case
%of \'etale commutative group schemes,
%using the equivalence $G \mapsto G(\bFq)$
%from the category of \'etale group schemes over $\Fq$ to the category of groups equipped
%with an action of $\Gal(\bFq/\Fq)$, continuous for the discrete topology on the group.

In this section we find a complete characterization of the category of quasicharacter sheaves on \'etale commutative group schemes over finite fields.

\subsection{Stalks of quasicharacter sheaves}\label{ssec:stalks}

The equivalence $G \mapsto G(\bFq)$
from the category of \'etale commutative group schemes over $\Fq$ to the category of commutative groups equipped
with an action of $\Gal(\bFq/\Fq)$, continuous for the discrete topology on the group,
provides the following simple description of quasicharacter sheaves.
%
A quasicharacter sheaf $\qcs{L}$ on an \'etale commutative group scheme $G$ over $\Fq$ is:
\begin{enumerate}
 \labitem{(qc.1)}{qc.1} an indexed set of one-dimensional
  $\EE$-vector spaces $\gqcs{L}_x$, as $x$ runs over
  $G(\bFq)$;

 \labitem{(qc.2)}{qc.2} an indexed set of isomorphisms
  $\mu_{x,y} : \gqcs{L}_{x+y} \xrightarrow{\iso} \gqcs{L}_{x} \otimes\gqcs{L}_{y}$,
  for all $x,y \in G(\bFq)$, such that
  \[
   \begin{tikzcd}[row sep=40]
    \gqcs{L}_{x+y+z} \arrow{rr}{\mu_{x+y,z}} \arrow[swap]{d}{\mu_{x,y+z}}
    && \gqcs{L}_{x+y}\otimes\gqcs{L}_{z} \dar{\mu_{x,y} \tight{0.5}{\otimes}{1} \id} \\
    \gqcs{L}_{x} \otimes\gqcs{L}_{y+z} \arrow{rr}{\id \otimes\mu_{y,z}}
    && \gqcs{L}_{x} \otimes\gqcs{L}_{y} \otimes\gqcs{L}_{z}
   \end{tikzcd}
  \]
  commutes, for all $x,y,z\in G(\bFq)$; and
 \labitem{(qc.3)}{qc.3} an indexed set of isomorphisms $\phi_{x} : \gqcs{L}_{\Frob{}(x)} \to \gqcs{L}_x$
  such that
  \[
   \begin{tikzcd}[row sep=40]
    \gqcs{L}_{\Frob{}(x)+\Frob{}(y)} \arrow[swap]{d}{\phi_{x+y}} \arrow{rr}{\mu_{\Frob{}(x),\Frob{}(y)}}
    && \gqcs{L}_{\Frob{}(x)}\otimes\gqcs{L}_{\Frob{}(y)} \dar{\phi_x \tight{0}{\otimes}{0} \phi_y} \\
    \gqcs{L}_{x+y} \arrow{rr}{\mu_{x,y}}
    && \gqcs{L}_x \otimes\gqcs{L}_y
   \end{tikzcd}
  \]
  commutes, for all $x,y\in G(\bFq)$.
\end{enumerate}
Under this equivalence, a morphism $\rho : \qcs{L} \to \qcs{L'}$ of quasicharacter sheaves on $G$ is given by
\begin{enumerate}
 \labitem{(qc.4)}{qc.4} an indexed set $\rho_x : \gqcs{L}_x \to \gqcs{L'}_x$
  of linear transformations such that
  \[
   \begin{tikzcd}[column sep=40]
    \arrow[swap]{d}{\phi_x} \gqcs{L}_{\Frob{}(x)} \rar{\rho_{\Frob{}(x)}} & \gqcs{L'}_{\Frob{}(x)} \dar{\phi_x'}
    &\arrow[draw=none]{d}[pos=.4,description]{\text{\normalsize{and}}}
    & \arrow[swap]{d}{\mu_{x,y}} \gqcs{L}_{x+y} \rar{\rho_{x+y}} & \gqcs{L'}_{x+y} \dar{\mu'_{x,y}} \\
    \gqcs{L}_x \rar{\rho_x} & \gqcs{L'}_x
    & {} & \gqcs{L}_x\otimes\gqcs{L}_y \rar{\rho_x\otimes\rho_y} & \gqcs{L'}_x \otimes\gqcs{L'}_y
   \end{tikzcd}
  \]
  both commute for all $x, y \in G(\bFq)$.
\end{enumerate}

We will see that $T_G : \QCiso{G} \to G(\Fq)^*$ may not provide complete
information about isomorphism classes of quasicharacter sheaves on $G$ when $G$ is not a connected algebraic group.
Our main tool for understanding this phenomenon
is a group homomorphism $S_G: \QCiso{G} \to \Hh^2(E^\bullet_G)$ defined in Section~\ref{ssec:S}, for which the next two sections are preparation.

\subsection{A spectral sequence}\label{ssec:E}

The zeroth page of the Hochschild-Serre spectral sequence is a double complex $E^{\bullet, \bullet}$ defined by
\[
E^{i,j} = C^i(\Weil{}, C^j(G(\bFq), \EEx)),
\]
The derivative of group cohomology yields two derivatives:
\begin{align*}
d_0 = d_G &: E^{i,j} \to E^{i,j+1} \\
d_{\Weil{}} &: E^{i,j} \to E^{i+1,j}.
\end{align*}
Combining these yields a derivative $d = d_G + (-1)^j d_{\Weil{}}$ on the total complex
\[
E^n_G = \bigoplus_{i+j=n} E^{i,j}.
\]
The machinery of spectral sequences gives us a sequence of pages $E_r^{i,j}$, converging to a page $E_{\infty}^{i,j}$. We summarize the key properties of this spectral sequence in the following proposition.

\begin{proposition}
\begin{enumerate}
\item The second page is given by $E_2^{i,j} = \Hh^i(\Weil{}, \Hh^j(G(\bFq), \EEx))$,
\item there is an isomorphism $\Hh^n(\Weil{} \ltimes G(\bFq), \EEx) \cong \Hh^n(E_G^\bullet)$,
\item there is a filtration $\Hh^n(\Weil{} \ltimes G(\bFq), \EEx) = F_n \supset \cdots \supset F_0 \supset F_{-1} = 0$ where $F_i / F_{i-1} \cong E_{\infty}^{i, n-i}$.
\end{enumerate}
\end{proposition}
%\todo{Is this a lemma? Is the corollary a proposition?}

Moreover, since $\Weil{} \cong \ZZ$ has cohomological dimension $1$, $E_2^{i,j} = 0$ for $i > 1$ and the sequence degenerates at the second page: $E_{\infty}^{i,j} = E_2^{i,j}$. We obtain the following corollary:

\begin{corollary}
There is a short exact sequence
 \[
  \begin{tikzcd}
    0 \arrow{r}
    & \Hh^0(\Weil{},\Hh^2({\bar G},\EEx)) \arrow{r}
    & \Hh^2(E^\bullet_G) \arrow{r}
    & \Hh^1(\Weil{},\Hh^1({\bar G},\EEx)) \arrow{r}
    & 0
  \end{tikzcd}
 \]
\end{corollary}

This sequence will play a key role in understanding the kernel of $T_G$, as described in the next few sections.
For this application, we need a good understanding of these maps to and from the total complex.

\begin{proposition} \label{prop:ses_desc}
\begin{enumerate}
\item Every class $[\alpha\oplus\beta\oplus\gamma] \in \Hh^2({\bar G},\EEx)$ is cohomologous to one with $\gamma=0$.
\item The map $\Hh^2(E^\bullet_G) \to \Hh^1(\Weil{},\Hh^1({\bar G},\EEx))$ is given by $[\alpha\oplus\beta\oplus 0] \mapsto [\beta]$.
\item Suppose $a \in Z^2({\bar G}, \EEx)$ represents a class in $\Hh^2({\bar G},\EEx)$ fixed by Frobenius.
The map $\Hh^0(\Weil{},\Hh^2({\bar G},\EEx)) \to \Hh^2(E^\bullet_G)$ is given by $[a] \mapsto [a \oplus 0 \oplus 0]$.
\end{enumerate}
\end{proposition}
\begin{proof}
Since $\Hh^2(\Weil{}, C^0({\bar G}, \EEx)) = 0$, we may find a $\gamma_1 \in C^1(\Weil{}, C^0({\bar G}, \EEx))$ with $d_{\Weil{}}\gamma_1 = \gamma$.
Subtracting $d \gamma_1$ from $\alpha\oplus\beta\oplus\gamma$, we may assume that $\gamma = 0$.

The latter two claims follow from tracing through the definition of latter pages in the spectral sequence; see \cite{Vakil:spectral_sequences} following \cite{Weibel:Homological_Algebra}*{Ch 5}, for example.
\end{proof}

\subsection{From quasicharacter sheaves to the total complex}\label{ssec:S}

In this section we define an isomorphism
\[
S_G : \QCiso{G} \to \Hh^2(E^\bullet_G).
\]
Let $\qcs{L} = (\gqcs{L},\mu,\phi)$ be a quasicharacter sheaf on $G$.
For each geometric point $x\in {\bar G}$, choose a basis $\{ v_x \}$ for $\gqcs{L}_x$.
Through this choice, $\qcs{L}$ determines functions
\begin{align*}
a : {\bar G}\times {\bar G} &\to \EEx & b : {\bar G} &\to \EEx \\
\mu_{x,y}(v_{x+y}) &= a(x,y) v_x \otimes v_y & \phi_x(v_{\Frob{G}(x)}) &= b(x) v_x.
\end{align*}
Condition~\ref{QC.2} implies that
\begin{equation}\label{2-cocyle}
a(x+y,z) a(x,y) = a(x,y+z) a(y,z)
\end{equation}
for all $x,y,z\in {\bar G}$, so $a \in Z^2({\bar G},\EEx)$.  Similarly, condition~\ref{QC.3} gives
\begin{equation}\label{nohom}
\frac{a(\Frob{G}(x),\Frob{G}(y))}{a(x,y)} =  \frac{b(x+y)}{b(x) b(y)}
\end{equation}
for $x, y \in {\bar G}$.
Let $\alpha \in C^0(\Weil{},C^2({\bar G},\EEx)$ be the $0$-cochain corresponding to $a$ and let $\beta\in C^1(\Weil{},C^1({\bar G},\EEx)$ be the cocycle such that $\beta(\Frob{})$ is $b$ \emph{written additively}.
Then
\[
d_G\alpha =0, \qquad\qquad
d_{\Weil{}} \alpha = d_{G} \beta,\qquad\qquad
d_{\Weil{}} \beta =0;
\]
in other words,
\[\alpha\oplus \beta \in Z^2(E^\bullet_G).\]
Although the cocycle $\alpha\oplus \beta$ is not well defined by $\qcs{L}$, its class in $Z^2(E^\bullet_G)$ is.
To see this, let $\{ v'_x \in \gqcs{L}_x^\times \tq x \in {\bar G}\}$ be another choice and let $\alpha'\oplus \beta' \in Z^2(E^\bullet_G)$ be defined by $\qcs{L}$ and this choice, as above.
Now let $\delta \in C^0(\Weil{},C^1({\bar G},\EEx))$ be the additive version of the function $d : {\bar G}\to \EEx$ defined by $v'_x = d(x) v_x$.
Then, chasing through \ref{QC.2} and \ref{QC.3} we find
\[
\alpha'\oplus\beta' = \alpha\oplus\beta + d\delta,
\]
so the class $[\alpha\oplus\beta]$ of $\alpha\oplus\beta$ in $\Hh^2(E^\bullet_G)$ is independent of the choice made above. It is also easy to see that $[\alpha\oplus\beta] = [\alpha_0\oplus\beta_0]$ when $\qcs{L} \iso \qcs{L}_0$,
which concludes the definition of the function
\begin{align*}
S_G : \QCiso{G} &\to \Hh^2(E^\bullet_G)\\
[\qcs{L}] &\mapsto [\alpha\oplus \beta].
\end{align*}
It is also easy to see that $[\alpha_1\oplus\beta_1] + [\alpha_2\oplus\beta_2] = [\alpha_3\oplus\beta_3]$ when $\qcs{L}_3 = \qcs{L}_1\otimes \qcs{L}_2$, so $S_G$ is a group homomorphism.

\begin{remark}
Although we will only use the group homomorphism $S_G : \QCiso{G}\to \Hh^2(E^\bullet_G)$ when $G$ is an \'etale commutative group scheme, the function is defined for all smooth commutative group schemes $G$.
However, the next result is false in that context.
\end{remark}

\begin{proposition}
If $G$ is \'etale then $S_G$ is an isomorphism.
\end{proposition}
\begin{proof}
%We first show that $S_G$ is injective.  
Suppose $\qcs{L} \in \QCiso{G}$ with $S_G(\qcs{L}) = [\alpha \oplus \beta] = 0$,
so that $\alpha \oplus \beta = d\sigma$ for some $\sigma \in C^0(\Weil{},C^1({\bar G},\EEx) = C^1({\bar G},\EEx)$.
For each $x\in {\bar G}$, define $\sigma_x : \gqcs{L}_x \to \EEx$ by $v_x \mapsto \sigma(x)$.
Then the indexed set of isomorphisms $\{ \sigma_x : \gqcs{L}_x \to \EE \tq x\in {\bar G}\}$
defines an isomorphism $\qcs{L} \to (\EE)_G$.
Since $\qcs{L} = 0 \in \QCiso{G}$, $S_G$ is injective.

To see that $S_G$ is surjective, begin with $\alpha\oplus\beta\oplus 0 \in Z^2(E^\bullet_G)$.
Since $d_{\Weil{}} \beta = 0$, we may define $a = \alpha \in C^2({\bar G},\EEx)$ and
$b = \beta(\Frob{}) \in C^1({\bar G},\EEx)$, which are related to $\alpha$ and $\beta$ as above.
Set $\gqcs{L}_x = \EEx$, define $\mu_{x,y} : \gqcs{L}_{x+y} \to \gqcs{L}_x\otimes\gqcs{L}_y$
by $\mu_{x,y}(1) = a(x,y) 1\otimes 1$ and $\phi_x : \gqcs{L}_{\Frob{G}(x)} \to \gqcs{L}_x$ by $\phi_x(1)= b(x)$.
Then \ref{qc.1} holds since $d_G \alpha =0$ and \ref{qc.2} holds since $d_{\Weil{}}\alpha =d_G \beta$.
Tracing the construction backward, we have defined a quasicharacter sheaf $\qcs{L}$ on $G$ with
$S_G(\qcs{L}) = [\alpha\oplus\beta\oplus\gamma]$, showing that $S_G$ is surjective.
\end{proof}

\subsection{Objects, when $G$ is etale}\label{ssec:SandT}

In this section we find the relationship between the group homomorphisms $\TrFrob{G}$ and $S_G$, and use this to find the group $\QCiso{G}$ when $G$ is an \'etale commutative group scheme over $\Fq$.

%
We begin with a simple, general result relating duals, invariants and coinvariants.

\begin{lemma} \label{lem:dual-inv}
Let $X$ be an abelian group equipped with an action of $\Weil{}$.
 Then
\begin{align*}
 (X^*)_{\Frob{}} &\to (X^{\Frob{}})^* \\
 [f] &\mapsto f|_{X^{\Frob{}}}
\end{align*}
is an isomorphism.
\end{lemma}

\begin{proof}
We can describe $X^{\Frob{}}$ as the kernel of the map $X \xrightarrow{\Frob{}-1} X$;
let $Y = (\Frob{}-1)X$ be the augmentation ideal.  Dualizing the sequence
\[
 0 \to X^{\Frob{}} \to X \to Y \to 0
\]
yields
\[
 0 \to Y^* \to X^* \to (X^{\Frob{}})^* \to \Ext^1_\ZZ(Y, \EEx).
\]
Since $\Ext^1_\ZZ(-,\EEx)$ vanishes, we get a natural isomorphism from the cokernel of $Y^* \xrightarrow{\Frob{}-1} X^*$ to $(X^{\Frob{}})^*$.
\end{proof}

\begin{proposition}\label{prop:sur_etale}
If $G$ is \'etale then $\TrFrob{G} : \QCiso{G} \to G(\Fq)^*$ is surjective.
\end{proposition}
\begin{proof}
Pick $\chi \in G(\Fq)^*$.
By Lemma~\ref{lem:dual-inv}, there is some $b\in G(\bFq)^*$ such that $b\vert_{G(\Fq)^*} = \chi$.
Set $\gqcs{L}_x = \EE$ for every $x\in G(\bFq)$.
Define $\mu_{x,y} : \gqcs{L}_{x+y} \to \gqcs{L}_x\otimes \gqcs{L}_y$ by $\mu_{x,y}(1) = 1 \otimes 1$ and
$\phi_{x} : \gqcs{L}_{\Frob{}(x)} \to \gqcs{L}_x$ by $\phi_{x}(1) = b(x)$.
Since $b : G(\bFq) \to \EEx$ is a group homomorphism,
condition \eqref{nohom} is satisfied with $a =1$ and $\qcs{L} = (\gqcs{L}, \mu, \phi)$
is a quasicharacter sheaf with $\trFrob{\qcs{L}} = \chi$.
\end{proof}

\begin{proposition} \label{prop:etale-iso}
 If $G$ is \'etale then the map $S_G : \QCiso{G}\to \Hh^2(E^\bullet_G)$ induces an isomorphism of short exact sequences
\[
\begin{tikzcd}
 0 \arrow{r} & \ker \TrFrob{G} \arrow{d} \arrow{r} & \QCiso{G}\arrow{d}{S_G} \arrow{r}{\TrFrob{G}} \arrow{r} & G(\Fq)^* \arrow{d} \arrow{r} & 0\\
  0 \arrow{r} & \Hh^0(\Weil{},\Hh^2({\bar G},\EEx)) \arrow{r} & \Hh^2(E^\bullet_G) \arrow{r} & \Hh^1(\Weil{},\Hh^1({\bar G},\EEx)) \arrow{r} & 0.
 \end{tikzcd}
 \]
\end{proposition}
\begin{proof}
This result follows easily from Propositions~\ref{prop:ses_desc} and \ref{prop:sur_etale}.
\end{proof}

\subsection{Morphisms}\label{ssec:mor-etale}

Most of this paper focuses on the question of determining the isomorphism classes of objects; a complete understanding of the morphisms in $\QC(G)$ also requires a description of the automorphisms of an arbitrary quasicharacter sheaf $\qcs{L}$.

\begin{proposition}\label{prop:autornaught_etale}
Let $G$ be an \'etale commutative group scheme over $\Fq$.
If $\qcs{L}$ and $\qcs{L}'$ are quasicharacter sheaves on $G$ then
every $\rho\in \Hom(\qcs{L},\qcs{L}')$ is either trivial or an isomorphism. Moreover, the trace map induces an isomorphism of groups
\[
\Aut(\qcs{L}) \to \Hom(G(\bFq)_{\Weil{}}, \EEx).
\]
\end{proposition}

\begin{proof}
We have already seen, in Lemma~\ref{lem:autornaught}, that every $\rho\in \Hom(\qcs{L},\qcs{L}')$ is either trivial or an isomorphism.
Now suppose $\rho \in \Aut(\qcs{L})$.
The second diagram in \ref{qc.4} shows that the association $x \mapsto \rho_x$ is a homomorphism from $G(\bFq)$ to $\EEx$ and the first diagram in \ref{qc.4} shows that it factors through $G(\bFq)_{\Weil{}}$.  Conversely, if $\rho : G(\bFq)_{\Weil{}} \to \EEx$ is any homomorphism then defining $\rho_x$ as multiplication by $\rho(x)$ will satisfy the two diagrams.  Composition of morphisms corresponds to pointwise multiplication in this correspondence, showing that the resulting bijection is actually a group isomorphism.
\end{proof}

%Note that Proposition~\ref{prop:autornaught_etale} tells us that if $G$ is an \'etale commutative group scheme over $\Fq$ then every hom-set is either trivial or $\{ 0 \} \cup \left(G(\bFq)_{\Weil{}}\right)^*$, non-canonically.

\section{Quasicharacter sheaves defined by discrete isogenies} \label{sec:disc-isog}

Before turning our attention to quasicharacter sheaves on connected commutative algebraic groups in Section~\ref{ssec:connected}, we treat two special classes of quasicharacter sheaves on arbitrary smooth commutative group schemes $G$:  in Section~\ref{ssec:descentG}, those that descend from local systems on $\bG$ to local systems on $G$; and in Section~\ref{ssec:discrete_isogenies}, those that are defined by discrete isogenies onto $G$. The latter will play a role in Sections~\ref{ssec:connected} and \ref{ssec:restriction}.

\subsection{Descent to G}\label{ssec:descentG}

In this section we consider a category of sheaves on $G$ obtained by
replacing the Weil sheaf $(\gqcs{L}, \phi)$ on $\bG$ in the definition of a quasicharacter sheaf with an $\ell$-adic local system on $G$ itself.

\begin{definition}
Let $\bQC(G)$ be the category of pairs $(\qcs{E},\mu_\qcs{E})$
where $\qcs{E}$ an $\ell$-adic local system on $G$ of rank~one,
equipped with an isomorphism $\mu_\qcs{E} : m^* \qcs{E} \to \qcs{E} \boxtimes \qcs{E}$
satisfying the analogue of \ref{QC.1} on $G$;
morphisms in $\bQC(G)$ are defined as in the second part of
\ref{QC.3}.
\end{definition}

We put a rigid monoidal structure on $\bQC(G)$ in the same way as for $\QC(G)$.

\begin{proposition}\label{prop:BG}
Extension of scalars defines a full and faithful functor
\[
B_G : \bQC(G) \to \QC(G).
\]
\end{proposition}

\begin{proof}
 Let $b_G : {\bar G} \to G$ be the pullback of $\Spec{\bFq} \to \Spec{\Fq}$ along $G\to \Spec{\Fq}$.
 Suppose $(\qcs{E},\mu_\qcs{E})$ in an object of $\bQC(G)$.
 Then $\qcs{E}$ is an $\ell$-adic constructible sheaf on $G$ and
 $b_G^* \qcs{E}$ comes equipped with an isomorphism
 $\phi_\qcs{E} : \Frob{G}^* b_G^*\qcs{E} \to b_G^* \qcs{E}$.
 The functor $\qcs{E} \mapsto (b_G^* \qcs{E},\phi_\qcs{E})$
 from $\ell$-adic constructible sheaves on $G$ to $\ell$-adic constructible sheaves on $G$
 is full and faithful; see \cite{deligne-katz:SGA7.2}*{Expos\'e XIII} or \cite{beilinson-bernstein-deligne:81a}*{Prop. 5.2.1}.
 This functor preserves local constancy, so takes local systems to local systems.
 The isomorphism $\mu \ceq b_{G\times G}^*\mu_\qcs{E}$ satisfies \ref{QC.2}
 with $b_G^*\qcs{E}$ playing the role of $\gqcs{L}$.
 Moreover, $\phi_\qcs{E}$ is compatible with $\mu_\qcs{E}$ in the sense of \ref{QC.3}.
 This construction defines the functor $B_G : (\qcs{E},\mu_\qcs{E}) \mapsto (b_G^*\qcs{E},b_{G\times G}^*\mu_\qcs{E}, \phi_\qcs{E})$
 and also shows that it is full and faithful.
\end{proof}

We will say that a quasicharacter sheaf $\qcs{L} \in \QC(G)$ \emph{descends to $G$} if it is isomorphic to some $B_G(\qcs{E}, \mu_\qcs{E})$.

\subsection{Discrete isogenies}\label{ssec:discrete_isogenies}

A finite, \'etale, surjective morphism $H\to G$ of smooth group schemes over $\Fq$ for which the action of $\Gal(\bFq/\Fq)$ on the kernel is trivial is called a {\it discrete isogeny}.

\begin{proposition}\label{prop:finite}
Let $f: H \to G$ be a discrete isogeny; let $A$ be the kernel of $f$.
Let $V$ be a $1$-dimensional representation of $A$ 
equipped with an isomorphism $V\to V\otimes V$.
Let $\psi : A \to \EEx$ be the character of $V$.
Then $(f_! V_H)_\psi$ (the $\psi$-isotypic component of $f_!V_H$) is an object of $\bQC(G)$.
\end{proposition}

\begin{proof}
Let $f$, $A$, $V$ and $\psi$ be as above; set $\qcs{E} = (f_! V_H)_\psi$.
Since $A$ is abelian, $\qcs{E}$ is an $\ell$-adic local system on $G$ of rank one.
We must show that comes equipped with an isomorphism $\mu_\qcs{E} : m^* \qcs{E} \to \qcs{E}\boxtimes\qcs{E}$.
To do this we use \'etale descent to see that pullback along $f$ gives an equivalence between $\ell$-adic local systems on $G$ and $A$-equivariant local systems on $H$ \cite{bernstein-luntz:equivariant_sheaves}*{Prop 8.1.1}. 
In particular, $f^*\qcs{E}$ is the $A$-equivariant constant sheaf $V$ on $H$ with character $\psi$.
Since $f$ is a morphism of group schemes, the functor $f^*$ defines $\mu_\qcs{E} : m^*\qcs{E} \to \qcs{E}\boxtimes\qcs{E}$
from the isomorphism $m^*\psi \iso \psi \boxtimes\psi$ determined by $V\to V\otimes V$.
\end{proof}

We remark that, since $V$ is $1$-dimensional, the choice of $V \to V\otimes V$ is exactly the choice of an isomorphism $V\iso \EE$.

\subsection{Quasicharacter sheaves on connected commutative algebraic groups}\label{ssec:connected}

In general, $\bQC(G)$ is an essentially
proper subcategory of $\QC(G)$. 
However, if $G$ is connected and of finite type, the categories are equivalent, as we now show.

\begin{lemma}\label{lem:bounded_connected}
If $G$ is a connected commutative algebraic group over $\Fq$ then 
\[
B_G : \bQC(G) \to \QC(G)
\]
 is an equivalence of categories.
\end{lemma}

\begin{proof}
Choose any $\Fq$-rational point $g$ on $G$ and let $\bg$ be the geometric point on $G$ lying above $g$.
Recall that the \emph{Weil group} of $G$, which we will denote by $\W(G,\bg)$, is a subgroup of the \'etale
fundamental group defined by the following diagram:
\[
 \begin{tikzcd}
 1 \rar & \ar[equal]{d} \pi_1(\bG, \bg) \rar & \W(G,\bg) \rar \dar[hook] & \Weil{} \rar \dar[hook] & 1 \\
 1 \rar &  \pi_1(\bG, \bg) \rar & \pi_1(G,\bg) \rar & \Gal(\bFq/\Fq) \rar & 1.
 \end{tikzcd}
\]
The $\Fq$-rational point $g$ under the geometric point $\bg$ determines a splitting
$\Weil{}\to \W(G,\bg)$ of $\W(G,\bg)\to \Weil{}$.
%
  Since $G$ is connected, the geometric point $\bg$ determines
  an equivalence between the category of $\ell$-adic Weil local systems on $G$ and
  $\ell$-adic representations of $\W(G,\bg)$ \cite{deligne:80a}*{1.1.12}.
  
  Now let $(\gqcs{L},\mu,\phi)$ be a quasicharacter sheaf on $G$
  and let $\rho : \W(G, \bg) \to \EEx$ be the character determined by $(\gqcs{L},\phi)$.
  Composing with the splitting $\Weil{} \to \W(G,\bg)$ yields an $\ell$-adic character
  $\rho_g : \Weil{} \to \EEx$, which is the same as the Trace of Frobenius defined in Section~\ref{ssec:Frob}, for every $\Fq$ rational point $g$ on $G$:
  $
  \rho_g(\Frob{}) =  \trFrob{\qcs{L}}(g).
  $
%
  On the other hand, we have already seen that $\trFrob{\qcs{L}} : G(\Fq) \to \EEx$
  is a group homomorphism. 
  Since $G$ is an algebraic group over $\Fq$, $G(\Fq)$ is finite.
  Therefore $\trFrob{\qcs{L}}(g) = \rho_g(\Frob{})$ is a root of unity
  for every $g\in G(\Fq)$.  Since $\Weil{}$ is generated by
  $\Frob{}$ and $\rho_g : \Weil{} \to \EEx$ is
  a character, it follows that the image of $\rho_g$ is a finite group.
  Thus, $\rho_g$ extends to an $\ell$-adic character of $\Gal(\bFq/\Fq)$,
  which we will also denote $\rho_g$.
%
  We may now lift the $\ell$-adic character $\rho_g : \Gal(\bFq/\Fq) \to \EEx$
  to an $\ell$-adic character $\pi_1(G,\bg) \to \EEx$ using the canonical topological group homomorphism
  $\pi_1(G,\bg) \to \Gal(\bFq/\Fq)$. 
 % 
  The $\Fq$ rational point $g$ also
  determines an equivalence between the category of $\ell$-adic
  representations of $\pi_1(G,\bg)$ and $\ell$-adic local systems on $G$. Let
  $\qcs{E}$ be a local system on $G$ in the isomorphism class
  determined by this $\ell$-adic character of $\pi_1(G,\bg)$.
  Then $b_G^*\qcs{E} \iso \gqcs{L}$.
  
  Since $b_{G\times G}^*$ is full and faithful (again, see
\cite{deligne-katz:SGA7.2}*{Expos\'e XIII} or \cite{beilinson-bernstein-deligne:81a}*{Prop. 5.2.1}),
 \[
  b_{G\times G}^* : \Hom(m^*\qcs{E},\qcs{E}\boxtimes\qcs{E}) \to \Hom({\bar m}^*\gqcs{L},\gqcs{L}\boxtimes\gqcs{L})
 \]
  is a bijection
  (hom taken in the categories on constructible $\ell$-adic sheaves on
  $G\times G$ and ${\bar G}\times {\bar G}$ respectively,
  in which $\ell$-adic local systems sit as full subcategories).
  Let $\mu_\qcs{E} : m^*\qcs{E} \to \qcs{E}\boxtimes\qcs{E}$ be the isomorphism matching
  $\mu : {\bar m}^*\gqcs{L} \to \gqcs{L}\boxtimes\gqcs{L}$,
  the latter appearing in the definition of $\qcs{L}$.
  Then, as in Section~\ref{ssec:descentG}, $(\qcs{E},\mu_\qcs{E})$ is an object of $\bQC(G)$
  and $\qcs{L} \ceq (\gqcs{L},\mu,\phi)$ is isomorphic to $(b_G^*\qcs{E},b_{G\times G}^*\mu_\qcs{E})$ in $\QC(G)$.
  Thus, the full and faithful functor $B_G : \bQC(G) \to \QC(G)$ from Section~\ref{ssec:descentG}
  is also essentially surjective, hence an equivalence.
\end{proof}

\begin{proposition}\label{prop:connected}
 If $G$ is a connected, commutative algebraic group over $\Fq$ then:
 \begin{enumerate}
 \item $\TrFrob{G} : \QCiso{G} \to G(\Fq)^*$ is an isomorphism of groups;
 \item every quasicharacter sheaf on $G$ is isomorphic to one defined by a discrete isogeny;%as in Proposition~\ref{prop:finite};
 \item $\Aut(\qcs{L}) = 1$, for all quasicharacter sheaves $\qcs{L}$ on $G$;
%  \item for all quasicharacter sheaves $\qcs{L}$, $\qcs{L}'$ on $G$ and for every $\rho \in \Hom(\qcs{L},\qcs{L}')$, either $\rho$ is trivial or an isomorphism.
 \end{enumerate}
 \end{proposition}

\begin{proof}
In Lemma~\ref{lem:bounded_connected} we saw that every quasicharacter sheaf $\qcs{L}$ on $G$ descends to $G$; let $\qcs{E}$ be an object of $\bQC(G)$ for which $B_G(\qcs{E}) \iso \qcs{L}$.
 Since the functor $B_G : \bQC(G) \to \QC(G)$ is full and faithful, $\Aut(\qcs{L}) = \Aut(\qcs{E})$.
From here, Deligne's function-sheaf dictionary for connected commutative algebraic groups over finite fields, as in \cite{deligne:SGA4.5}*{Sommes trig.} or \cite{laumon:87a}*{1.1.3}, gives us all we need, as we briefly recall. %\todo{Fix citelist} %\citelist{\cite{deligne:SGA4.5}*{Sommes trig.},\cite{laumon:87a}*{1.1.3}}
The key observation is that, by \'etale descent, pullback by the Lang isogeny $\Lang : G\to G$ defines an equivalence of categories from $\bQC(G)$ to the category of $1$-dimensional $\ell$-adic representations $V$ of $G(\Fq)$ equipped with an isomorphism $V \to V\otimes V$ such that the trace of $\Lang^*\qcs{E}$ is $\trFrob{\qcs{E}}^{-1}$ for every $\qcs{E}$ in $\bQC(G)$. 
(Note that this is a particular case of the argument in the proof of Proposition~\ref{prop:finite}.)
Using the equivalence given by $\Lang^*$, if $\Lang^*\qcs{E} = V$ with character $\psi$ and isomorphism $V\to V\otimes V$ then 
$\qcs{E} \iso (\Lang_! V)_\psi$, the $\psi$-isotypic component of the push-forward $\Lang_* V$ of the constant sheaf $V$ on $G$ equipped with an isomorphism $\mu_\qcs{E} : m^* \qcs{E} \to \qcs{E} \boxtimes\qcs{E}$ determined by $V\to V\otimes V$. 
Moreover, $\Aut(\qcs{E})$ is the group of automorphisms of $\rho : V\to V$ for which 
\[
\begin{tikzcd}
\arrow{d}{} V \arrow{r}{\rho} & V\arrow{d}{}\\
V\otimes V \arrow{r}{\rho\otimes \rho} & V\otimes V
\end{tikzcd}
\]
commutes. 
Since the only such isomorphism $\rho$ is $\id_V$, it follows that $\Aut(\qcs{E}) = 1$, completing the proof.
\end{proof}

%\begin{remark}
We have just seen that, for a connected commutative algebraic group $G$ over $\Fq$, the category of quasicharacter sheaves on $G$ is equivalent to the category of characters $\psi$ of $G(\Fq)$.
We have also just seen that if the character of $\Lang^*\qcs{E}$ is $\psi$ then the canonical isomorphism $m^*\psi \iso \psi \boxtimes \psi$ determines the isomorphism $\mu_\qcs{E} : \qcs{E} \to \qcs{E}\boxtimes\qcs{E}$ which is part of the data that determines a quasicharacter sheaf on $G$.
That leads to a perspective on the function-sheaf dictionary common in the literature in which one considers $1$-dimensional local systems $\qcs{E}$ on $G$ for which \emph{there exists} an isomorphism $m^*\qcs{E} \iso \qcs{E} \boxtimes\qcs{E}$; see \cite{kamgarpour:09a}*{Intro}, for example.
As a slight variation, one may also consider $1$-dimensional local systems $\gqcs{L}$ on $\bG$ for which \emph{there exists} an isomorphism $\Frob{G}^*\gqcs{L} \iso \gqcs{L}$ and an isomorphism $\bm^*\gqcs{L} \iso \gqcs{L} \boxtimes\gqcs{L}$.
%One may show that all such $\gqcs{L}$ are determined by extensions of $\bG$ by $\EEx$ which are fixed by Frobenius and that the trace of Frobenius provides a canonical isomorphism from $\Hh^2(\bG,\EEx)^{\Frob{}}$ to $G(\Fq)^*$; {\it cf.\ }
%One may show that all such $\gqcs{L}$ are determined by extensions of $\bG$ by $\EEx$ which are fixed by Frobenius and that the trace of Frobenius provides a canonical isomorphism from $\Hh^2(\bG,\EEx)^{\Frob{}}$ to $G(\Fq)^*$; {\it cf.\ } \cite{kamgarpour:09a}*{Prop 2.15}.

Although the category of quasicharacter sheaves on $G$ does specialize to that common notion when $G$ is connected and of finite type, the common notion is not appropriate if one wishes to extend the dictionary to smooth commutative group schemes over finite fields. 
In particular, as we have already seen in Section~\ref{sec:etale}, for a given quasicharacter sheaf $\qcs{L} = (\gqcs{L},\mu,\phi)$ there may be a different isomorphism $\mu' : \bm^*\gqcs{L} \to \gqcs{L}\boxtimes\gqcs{L}$ for which $\qcs{L}'=(\gqcs{L},\mu',\phi)$ is also a quasicharacter sheaf on $G$, not isomorphic to $\qcs{L}$ in $\QC(G)$.
Indeed, Proposition~\ref{prop:etale-iso} shows that when $G$ is \'etale, $\Hh^2(\bG,\EEx)^{\Weil{}}$ measures the possibilities for $\mu'$.
The common perspective on the function-sheaf dictionary leads only to the part of category of quasicharacter sheaves that is invisible to the trace of Frobenius.

We will see in Section~\ref{sec:main} that, for any smooth commutative group scheme $G$, the part of category of quasicharacter sheaves that is invisible to the trace of Frobenius are measured by $\Hh^2(\pi_0(\bG),\EEx)^{\Weil{}}$.
%\end{remark}

\section{The function-sheaf dictionary for smooth commutative group schemes}\label{sec:main}


\subsection{Restriction to the identity component} \label{ssec:restriction}

Consider the short exact sequence
defining the component group scheme for $G$:
\begin{equation}\label{eq:pi0}
\begin{tikzcd}
0 \rar & G^0 \arrow{r}{\iota_0} & G \arrow{r}{\pi_0} & \pi_0(G) \rar & 0.
\end{tikzcd}
\end{equation}
Since $\pi_0(G)$ is a \'etale commutative group scheme -- and thus smooth --
Lemma~\ref{lem:pullback} implies that \eqref{eq:pi0} defines the sequence of functors
\begin{equation}\label{eq:pi1}
\begin{tikzcd}
\QC(0) \rar & \QC(\pi_0(G)) \arrow{r}{\pi_0^*} & \QC(G) \arrow{r}{\iota_0^*} & \QC(G^0) \rar & \QC(0)
\end{tikzcd}
\end{equation}
and therefore, after passing to isomorphism classes, the sequence of abelian groups
\begin{equation}\label{eq:pi2}
\begin{tikzcd}
0 \rar &
\QCiso{\pi_0(G)} \arrow{r}{\pi_0^*} & \QCiso{G} \arrow{r}{\iota_0^*} & \QCiso{G^0} \rar & 0.
\end{tikzcd}
\end{equation}
 Note that we found the groups $\QCiso{\pi_0(G)}$ and $\QCiso{G^0}$
in Sections~\ref{ssec:SandT} and \ref{ssec:connected}, respectively.
We will shortly see that \eqref{eq:pi2} is exact.


\begin{lemma}\label{lemma:ext}
Every discrete isogeny to $G^0$ extends to a discrete
isogeny to $G$ inducing an isomorphism on component groups.
\end{lemma}

\begin{proof}
Let $\pi: B \to G^0$ be a discrete isogeny; set $A \ceq \ker \pi$.
  We will find a discrete isogeny $f: H\to G$
  such that that $H^0 = B$, $f^0 =\pi$ and
  $\pi_0(f) : \pi_0(H)\to \pi_0(G)$ is an isomorphism of component
  groups.  Namely, we will fit $\pi$ into the following diagram,
  \begin{equation}\label{extension-diagram}
  \begin{tikzcd}
  A \arrow[equal]{r} \dar & A \dar \\
  B \rar \dar[swap]{\pi} & H \rar \dar[swap]{f} & \pi_0(H) \arrow{d}[below,rotate=90]{\sim}[swap]{\pi_0(f)} \\
  G^0 \rar & G \rar & \pi_0(G),
  \end{tikzcd}
  \end{equation}
  where all rows and columns are exact and all maps are defined over
  $\Fq$.  We will do so by passing back and forth between group
  schemes over $\Fq$ and their $\bFq$-points.

  Extensions of $G^0(\bFq)$ by $A(\bFq)$, such as $B(\bFq)$,
  correspond to classes in $\Ext^1_{\ZZ[\Weil{}]}(G^0(\bFq), A(\bFq))$.
  Similarly, extensions of $G(\bFq)$ by $A(\bFq)$ correspond to
  classes in $\Ext^1_{\ZZ[\Weil{}]}(G(\bFq), A(\bFq))$.  The map
  $G^0(\bFq) \to G(\bFq)$ induces the map
  \[
  \Ext^1_{\ZZ[\Weil{}]}(G(\bFq), A(\bFq)) \to \Ext^1_{\ZZ[\Weil{}]}(G^0(\bFq), A(\bFq))
  \]
  fitting into the long exact sequence 
  \[
  \Ext^1_{\ZZ[\Weil{}]}(G(\bFq), A(\bFq)) \to \Ext^1_{\ZZ[\Weil{}]}(G^0(\bFq), A(\bFq)) \to \Ext^2_{\ZZ[\Weil{}]}(\pi_0(G)(\bFq), A(\bFq))
  \]
  derived from applying
  the functor $\Hom(\mbox{---}, A(\bFq))$ to $G^0(\bFq) \to G(\bFq) \to \pi_0(G)(\bFq)$.
  Since $\Weil{} \cong \ZZ$ has cohomological dimension $1$ \cite{brown:CohomologyGrps}*{Ex. 4.3},
  $\Ext^2_{\ZZ[\Weil{}]}(\pi_0(G)(\bFq), A(\bFq))$ vanishes \cite{cartan-eilenberg:HomologicalAlgebra}*{Thm. 2.6}.

  We therefore have the existence of diagram \eqref{extension-diagram}
  at the level of $\bFq$-points.  This expresses $H(\bFq)$ as a
  disjoint union of translates of $B(\bFq)$; by transport of structure
  we may take $H$ to be a group scheme over $\bFq$.  Similarly, the
  restriction of $f$ to each component of $H$ is a morphism of
  schemes, and thus $f$ is as well.  Finally, the whole diagram
  descends to a diagram of $\Fq$-schemes since the $\bFq$-points of
  the objects come equipped with continuous $\Gal(\bFq/\Fq)$-actions and the
  morphisms are $\Gal(\bFq/\Fq)$-equivariant.
\end{proof}

We now wish to use the apply the results of Section~\ref{ssec:connected} to the identity component of $G$; to do so, we must know that the identity component of $G$ is actually an algebraic group over $\Fq$.

\begin{lemma} \label{lem:G0alg-grp}
If $G$ is a commutative smooth group scheme over $\Fq$ then its identity component, $G^0$, is a connected algebraic group over $\Fq$.
\end{lemma}
\begin{proof}
 Since $G$ is a smooth group scheme over $\Fq$, its
 identity component $G^0$ of $G$ is a connected smooth,
 group scheme of finite type over $\Fq$, reduced over some finite extension of $\Fq$
 \cite{vdGeer-Moonen:AbelianVarieties}*{3.17}.
 Since $\Fq$ is a finite field and hence perfect, $G^0$ is actually reduced over $\Fq$
 \cite{EGAIV2}*{Prop 6.4.1}.  Since every group scheme over a field is separated
 \cite{vdGeer-Moonen:AbelianVarieties}*{3.12},
 it follows that $G^0$ is a connected algebraic group.
\end{proof}

\begin{proposition}\label{prop:restriction}
%For every quasicharacter sheaf $\qcs{L}^0$ on $G^0$ there is some finite quasicharacter sheaf
%$\qcs{L}$ on $G$ such that $\qcs{L}\vert_{G^0} \iso \qcs{L}^0$.
%As a consequence, t
The restriction functor $\iota_0^* : \QC(G)\to \QC(G^0)$ is essentially surjective.
\end{proposition}

\begin{proof}
  By Lemma~\ref{lem:G0alg-grp} and Proposition~\ref{prop:connected}, every
  quasicharacter sheaf on $G^0$ is isomorphic to $(\pi_! \EE)_\psi$ for some discrete isogeny $\pi : B \to G^0$ and character $\psi : \ker \pi \to \EEx$.
  So to prove the proposition it suffices to show that $(\pi_! \EE)_\psi$ extends to a quasicharacter sheaf on $G$.
%
 %Let $(\pi,\psi)$ be a finite quasicharacter sheaf on $G^0$.
 By Lemma~\ref{lemma:ext}, there is an extension of the
 discrete isogeny $\pi : B \to G^0$ to a discrete isogeny $f : H \to G$
 such that $\pi_0(f) : \pi_0(H)\to \pi_0(G)$ is an isomorphism.
 Then $(f_! \EE)_\psi$ is a quasicharacter sheaf on $G$ and
 $(f_! \EE)_\psi\vert_{G^0} \iso (\pi_! \EE)_\psi$.
\end{proof}

\subsection{The component group sequence} \label{ssec:component}

\begin{lemma}\label{lem:extension}
The group homomorphism $\pi_0^*: \QCiso{\pi_0(G)} \to \QCiso{G}$ is injective.
\end{lemma}
\begin{proof}
Let $\qcs{L}$ be a quasicharacter sheaf on $\pi_0(G)$ and let $\rho : \pi_0^*\qcs{L} \to (\EE)_{G}$ be an isomorphism in $\QC(G)$. For each $x\in \pi_0(\bG)$, the restriction $\pi_0^*\gqcs{L}\vert_{\bG^x}$ is the constant sheaf $(\gqcs{L}_x)_{\bG^x}$ so the isomorphism $\rho_{\bG^x} : (\gqcs{L}_x)_{\bG^x} \to (\EE)_{\bG^x}$ determines an isomorphism $\rho_x : \gqcs{L}_x \to (\EE)_x$. The collection $\{ \rho_x \tq x\in \pi_0(\bG) \}$ determines an isomorphism $\qcs{L} \to (\EE)_{\pi_0(G)}$  in $\QC(\pi_0(G))$.
\end{proof}


\begin{proposition}\label{prop:middleexact}
 The sequence
 \[
  \begin{tikzcd}
  0 \rar & \QCiso{\pi_0(G)} \arrow{r}{\pi_0^*} & \QCiso{G} \arrow{r}{\iota_0^*} & \QCiso{G^0} \rar & 0.
  \end{tikzcd}
 \]
 is exact.
\end{proposition}

\begin{proof}
The sequence is exact at $\QCiso{G^0}$ by Proposition~\ref{prop:restriction}
and exact at $\QCiso{\pi_0(G)}$ by Lemma~\ref{lem:extension}.
Here we show that it is also exact at $\QCiso{G}$.
First note that $\iota_0^* \circ \pi_0^*$ is trivial by Lemma~\ref{lem:pullback}.
So it suffices to show that if $\qcs{L} = (\gqcs{L},\mu,\phi)$ is a quasicharacter sheaf on $G$
with $\qcs{L}\vert_{G^0} = (\EE)_{G^0}$ then $\qcs{L}$ is in the essential image of $\pi_0^*$.

For each $x\in \pi_0(\bG)$, set $\bG^x \ceq \pi_0^{-1}(x)$.
Let $g, g'$ be geometric points in the same
geometric connected component $\bG^x$.
Set $a = g^{-1}g'$ and note that $a$ is a geometric point in $\bG^0$.
Let $\mu_{g,a} : \gqcs{L}_{ga} \to \gqcs{L}_g \otimes \gqcs{L}_a$
be the isomorphism of vector spaces obtained by restriction of
$\mu : m^*\gqcs{L} \to \gqcs{L} \boxtimes \gqcs{L}$ to the
geometric point $(g,a)$ on $\bG^x \times \bG^0$.
Since $\qcs{L}\vert_{G^0} = (\EE)_{G^0}$,
the stalk of $\gqcs{L}$ at $a$ is $\EE$.
In this way the pair of geometric points $g, g' \in \bG^x$
determines an isomorphism $\varphi_{g,g'} \ceq \mu_{g,a}^{-1}$
from $\gqcs{L}_{g}$ to $\gqcs{L}_{g'}$.

The isomorphisms $\varphi_{g,g'}: \gqcs{L}_{g} \to \gqcs{L}_{g'}$ are canonical
in the following sense: if $g,g'\in \bG^x$ and $h,h'\in \bG^y$
then it follows from \ref{QC.2} and \ref{QC.3}
that
 \begin{equation}\label{eq:qc}
  \begin{tikzcd}[column sep=55]
   \gqcs{L}_{gh} \arrow{r}{\varphi_{gh,g'h'}} \arrow[swap]{d}{\mu_{g,h}}
  & \gqcs{L}_{g'h'} \arrow{d}{\mu_{g',h'}}
  &\arrow[draw=none]{d}[pos=.4,description]{\text{\normalsize{and}}}
  &  \gqcs{L}_{\Frob{}(g)} \arrow{r}{\varphi_{\Frob{}(g),\Frob{}(g')}} \arrow[swap]{d}{\phi_{g}} & \gqcs{L}_{\Frob{}(g')} \arrow{d}{\phi_{g'}} \\
  \gqcs{L}_{g} \otimes \gqcs{L}_{h} \arrow{r}{\varphi_{g,g'}\otimes \varphi_{h,h'}}
  & \gqcs{L}_{g'} \otimes \gqcs{L}_{h'}
  & {}
  & \gqcs{L}_{g} \arrow{r}{\varphi_{g,g'}} & \gqcs{L}_{g'}
  \end{tikzcd}
 \end{equation}
both commute.

For each $x\in \pi_0(\bG)$, pick $g(x)\in \bG^x$
and set $\gqcs{E}_x \ceq \gqcs{L}_{g(x)}$.
Let $\phi_x : \gqcs{E}_{\Frob{}(x)} \to \gqcs{E}_x$
be the isomorphism of $\EE$-vector spaces obtained by composing
$\varphi_{g(\Frob{}(x)),\Frob{}(g(x))} : \gqcs{L}_{g(\Frob{}(x))} \to \gqcs{L}_{\Frob{}(g(x))}$
with $\phi_{g(x)} : \gqcs{L}_{\Frob{}(g(x))} \to \gqcs{L}_{g(x)}$.
For each pair $x,y\in \pi_0(\bG)$
let $\mu_{x,y} : \gqcs{E}_{x+y}\to \gqcs{E}_x\otimes \gqcs{E}_y$
be the isomorphism of $\EE$-vector spaces obtained by composing
$\varphi_{g(x+y),g(x)g(y)} : \gqcs{L}_{g(x+y)} \to \gqcs{L}_{g(x)g(y)}$
with $\mu_{g(x),g(y)} : \gqcs{L}_{g(x)g(y)} \to \gqcs{L}_{g(x)}\otimes \gqcs{L}_{g(y)}$.
Using \eqref{eq:qc}, it follows that \ref{qc.1}, \ref{qc.2} and \ref{qc.3} are satisfied for
$\qcs{E} \ceq (\gqcs{E}_x, \mu_{x,y}, \phi_x)$, thus defining a quasicharacter sheaf on $\pi_0(G)$.

The pullback $\pi_0^*(\qcs{E})$ of $\qcs{E}$ along $\pi_0 : G \to \pi_0(G)$ is constant
on geometric connected components, with stalks given by
$(\pi_0^* \qcs{E})_g = \qcs{E}_{x}$ for all $g\in \bG^x$.  Thus both $\pi_0^*\qcs{E}$ and $\qcs{L}$
are constant on geometric connected components of $G$.
The choices above define isomorphisms
$\gqcs{L}\vert_{\bG^x} \to  (\gqcs{E}_{x})_{\bG^x}$ for each $x\in \pi_0(\bG)$.
The resulting isomorphism $\gqcs{L} \to \pi_0^* \gqcs{E}$ satisfies \ref{QC.4},
thus defining an isomorphism $\qcs{L} \to \pi_0^* \qcs{E}$ in $\QC(G)$.
\end{proof}

\subsection{The dictionary}
\label{ssec:snake}

We saw in Proposition~\ref{prop:functorialG} that $\TrFrob{G} : \QCiso{G} \to G(\Fq)^*$ is a functorial group homomorphism.
In this section we improve that result.

\begin{theorem}\label{thm:snake}
  If $G$ is a smooth commutative group scheme over $\Fq$ then
  \[
  \TrFrob{G} : \QCiso{G} \to G(\Fq)^*
  \]
is surjective with kernel canonically isomorphic to $\Hh^2(\pi_0({\bar G}),\EEx)^{\Weil{}}$.
\end{theorem}

\begin{proof}
  Recall the short exact sequence \eqref{eq:pi0}
  defining the component group scheme for $G$:
  \[
  \begin{tikzcd}
    1 \rar & G^0 \rar & G \rar & \pi_0(G) \rar & 0.
  \end{tikzcd}
  \]
  Let
  \[
  \begin{tikzcd}[row sep=20]
%  & 0 \arrow{d} & 0 \arrow{d} & 0\arrow{d} \\
    0 \arrow[dashed]{r} & \ker \TrFrob{\pi_0(G)} \arrow[dashed]{r} \dar & \arrow{d} \ker \TrFrob{G} \arrow[dashed]{r} & \ker \TrFrob{G^0} =0 \arrow[dotted, out=-10, in=170]{dddll} \dar & \\
    0 \rar & \QCiso{\pi_0(G)} \rar \dar{\TrFrob{\pi_0(G)}}
    & \QCiso{G} \rar \dar{\TrFrob{G}} & \QCiso{G^0} \rar \dar{\TrFrob{G^0}} & 0\\
    0 \rar & \pi_0(G)(\Fq)^* \rar \dar
    & \arrow{d} G(\Fq)^* \rar & G^0(\Fq)^* \rar \dar & 0\\
   &  \coker \TrFrob{\pi_0(G)} =0 \arrow[dashed]{r} & \coker \TrFrob{G} \arrow[dashed]{r} & \coker \TrFrob{G^0} =0 & 
%    & \arrow{d} \coker \TrFrob{\pi_0(G)} =0 \arrow[dashed]{r} & \arrow{d} \coker \TrFrob{G} \arrow[dashed]{r} &  \arrow{d} \coker \TrFrob{G^0} =0 & \\
%      & 0 & 0 & 0 \\
  \end{tikzcd}
  \]
  be the commutative diagram of abelian groups obtained by applying
  Lemma~\ref{lem:pullback} to \eqref{eq:pi0}.
 %
  The sequence of abelian groups
  \begin{equation}\label{eq:pi0k}
  \begin{tikzcd}
    1 \rar & G^0(\Fq) \rar & G(\Fq) \rar & \pi_0(G)(\Fq) \rar & 0,
  \end{tikzcd}
  \end{equation}
  is exact since $\Hh^1(\Fq,G^0) =0$ by Lemma~\ref{lem:G0alg-grp} and Lang's theorem on connected algebraic groups over finite fields \cite{lang:56a}.
  Since $\EEx$ is divisible, $\Hom(\ - \ ,\EEx)$ is exact and thus the dual sequence of
  character groups is also exact.
%
  The upper row is exact by Proposition~\ref{prop:middleexact}.
  Now Lemma~\ref{lem:G0alg-grp} and Proposition~\ref{prop:connected}
  imply that $\ker \TrFrob{G^0} =0$ and $\coker \TrFrob{G^0}=0$,
  while Proposition~\ref{prop:etale-iso} gives $\ker \TrFrob{\pi_0(G)} \iso \Hh^0(\Weil{},\Hh^2(\pi_0({\bar G}),\EEx))$
  and $\coker \TrFrob{\pi_0(G)}=0$.
%
It follows from the snake lemma that $\coker \TrFrob{G} =0$
and $\ker \TrFrob{\pi_0(G)} \to \ker \TrFrob{G}$ is an isomorphism.
This calculates $\ker  \TrFrob{G}$ and shows that
\[
  \begin{tikzcd}
0 \arrow{r} & \Hh^0(\Weil{},\Hh^2(\pi_0(\bG),\EEx)) \arrow{r} & \QCiso{G} \arrow{r}{\TrFrob{G}} & G(\Fq)^* \arrow{r} & 0 
  \end{tikzcd}
\]
is exact.
\end{proof}

\subsection{Morphisms of quasicharacters} \label{ssec:qcmor}

\begin{theorem}\label{thm:autornaught}
Let $G$ be a smooth commutative group scheme over $\Fq$.
There is a canonical isomorphism
\[
\Aut(\qcs{L}) \iso \Hom(\pi_0(\bG)_{\Weil{}},\EEx).
\]
\end{theorem}
\begin{proof} 
%For the first part of the proposition, argue as in the analogous part of Proposition~\ref{prop:autornaught_etale}.
%For the second, f
Fix $\qcs{L} = (\gqcs{L},\mu,\phi)$ and consider the group homomorphism from $\Aut(\qcs{L})$ to $\Hom(\bG_{\Weil{}},\EEx)$ defined in Proposition~\ref{prop:autornaught_etale}.
This homomorphism is injective because morphisms of sheaves are determined by the linear transformations induced on stalks.  
Note that homomorphisms in the image of $\Aut(\qcs{L}) \to \Hom(\bG_{\Weil{}},\EEx)$ are continuous where $\bG_{\Weil{}}$ is given the topology of the base of the espace \'etal\'e attached to $\gqcs{L}$.
Since $\ell$ is invertible in $\Fq$, it now follows that the image of $\Aut(\qcs{L}) \to \Hom(\bG_{\Weil{}},\EEx)$ is contained in $\Hom(\pi_0(\bG_{\Weil{}}),\EEx)$. 
We also have $\pi_0(\bG_{\Weil{}})=\pi_0(\bG)_{\Weil{}}$. 
To see that $\Aut(\qcs{L}) \to \Hom(\pi_0(\bG)_{\Weil{}},\EEx)$ is surjective, begin with $\theta\in\Hom(\pi_0(\bG)_{\Weil{}},\EEx)$ and, for each $[x] \in \pi_0(\bG)_{\Weil{}}$ define $\bar\rho^y: \gqcs{L}^y \to \gqcs{L}^y$ by scalar multiplication by $\theta([x])\in \EEx$ for each $y\in [x]$.
This defines an isomorphism $\bar\rho : \gqcs{L}\to \gqcs{L}$ of local systems on $\bG$ compatible with $\mu$ and $\phi$, and thus an isomorphism $\rho :\qcs{L}\to \qcs{L}$ with maps to $\theta$ under $\Aut(\qcs{L}) \to \Hom(\pi_0(\bG)_{\Weil{}},\EEx)$.
\end{proof}

\subsection{Base change}\label{ssec:basechange}

When using quasicharacter sheaves to study characters, it is useful to understand
how quasicharacter sheaves behave under change of fields.
Let $k'$ be a finite extension of $k$. Then $k \hookrightarrow k'$ induces a group homomorphism
$i_{k'/k} : G(k) \hookrightarrow G(k')$ and thus a homomorphism
\begin{align*}
i_{k'/k}^* : G(k')^* &\to G(k)^* \\
\chi &\mapsto \chi\circ i_{k'/k}.
\end{align*}
We can interpret this operation on characters in terms of quasicharacter sheaves:

\begin{proposition} \label{prop:csbe}
Set $G_{k'} \ceq G\times_\Spec{k} \Spec{k'}$ and let
\[
\QC(\Res_{k'/k}(G_{k'})) \xrightarrow{\iota^*} \QC(G)
\]
be the functor obtained by pullback along the canonical closed immersion 
\[\iota : G \hookrightarrow \Res_{k'/k}(G_{k'})\] of $k$-schemes.
The following diagram commutes:
\[
\begin{tikzcd}
\QCiso{\Res_{k'/k}(G_{k'})} \arrow[two heads]{r}{\iota^*} \dar[swap]{\TrFrob{\Res_{k'/k}(G_{k'})}} & \QCiso{G} \dar{\TrFrob{G}} \\
G(k')^* \arrow[two heads]{r}{i_{k'/k}^*} & G(k)^*.
\end{tikzcd}
\]
\end{proposition}
\begin{proof}
The closed immersion $\iota : G \hookrightarrow \Res_{k'/k}(G_{k'})$ is given by \cite{bosch-lutkebohmert-reynaud:NeronModels}*{\S 7.6}.
Proposition~\ref{prop:csbe} follows immediately from Lemma~\ref{lem:pullback} together with the identifications
\[
\Res_{k'/k}(G_{k'})(k) \cong G_{k'}(k') \cong G(k')
\]
from the definitions of Weil restriction and base change.
\end{proof}

In the opposite direction, let $\Nm : G(k') \to G(k)$ be the norm map and consider the group homomorphism:
\begin{align*}
\Nm^* : G(k)^* &\to G(k')^* \\
\chi &\mapsto \chi\circ \Nm.
\end{align*}
We can also interpret this operation on characters in terms of quasicharacter sheaves.

If $\qcs{L} \ceq (\gqcs{L}, \mu, \phi)$ is a quasicharacter sheaf on $G$, we define
%a quasicharacter sheaf 
$\qcs{L}' \ceq (\gqcs{L}, \mu, \phi_{k'})$ on the base change
$G_{k'}$ of $G$ to $k'$ by setting
\[
\phi_{k'} \ceq \phi \circ \Frob{G}^*(\phi) \circ \cdots \circ (\Frob{G}^{n-1})^*(\phi).
\]
The commutativity of the diagram (QC.3) for $\phi_{k'}$
follows from the fact that $\Frob{G_{k'}} = \Frob{G}^n$.
Note that we may also think about the construction of $\phi_{k'}$ from $\phi$
as taking the action $\varphi$ of the Weil group for $k$%, $\Weil{k}$, 
on $\gqcs{L}$
defined in Section~\ref{ssec:category} and restricting it to the Weil group for $k'$.
%, $\Weil{k'}$.

\begin{proposition}\label{prop:basechange}
With notation above,
the rule $\nu_{k'/k}: (\gqcs{L}, \mu, \phi) \mapsto (\gqcs{L}, \mu, \phi_{k'})$
 defines a monoidal functor $\QC(G) \to \QC(G_{k'})$
 such that the following diagram commutes:
\[
\begin{tikzcd}[column sep=60]
\QCiso{G} \rar{\nu_{k'/k}} \dar{\TrFrob{G}} & \QCiso{G_{k'}} \dar{\TrFrob{G_{k'}}} \\
G(k)^*  \rar{\Nm^*} & G(k')^*.
\end{tikzcd}
\]
\end{proposition}

\begin{proof}
Let $\qcs{L} \ceq (\gqcs{L}, \mu, \phi) \in \QC(G)$ and write $F$ for $\Frob{G}$.  For any $x \in G(k')$,
we may compute the value of $t_{G_{k'}}(\nu_{k'/k}\qcs{L})(x)= t_{\nu_{k'/k}\qcs{L}}(x)$ as the trace of $\phi_{k'}$ on $\gqcs{L}_x$,
and the value of $\Nm^*(\TrFrob{G}(\qcs{L}))(x)$ as the trace of $\phi$ on $\gqcs{L}_{\Nm(x)}$.
Applying \ref{QC.3} to the stalk of $\gqcs{L}^{\boxtimes n}$ at the point $(x, \Frob{}(x), \ldots, \Frob{}^{n-1}(x))$ yields a diagram
\[
\begin{tikzcd}
\gqcs{L}_{\Nm(x)} \rar \dar{\phi_{\Nm(x)}} & \gqcs{L}_{F(x)} \otimes \gqcs{L}_{F^2(x)} \otimes \cdots \otimes \gqcs{L}_x
\dar{\phi_x \otimes (F^*\phi)_x \otimes \cdots \otimes ((F^{n-1})^*\phi)_x} \\
\gqcs{L}_{\Nm(x)} \rar & \gqcs{L}_x \otimes \gqcs{L}_{F(x)} \otimes \cdots \otimes \gqcs{L}_{F^{n-1}(x)}.
\end{tikzcd}
\]
Choose a basis vector $v$ for $\gqcs{L}_{\Nm(x)}$ and write $v_0 \otimes v_1 \otimes \cdots \otimes v_{n-1}$ for the image of $v$ under the
bottom map,
for $v_i \in \gqcs{L}_{\Frob{}^i(x)}$.  By \ref{QC.2}, $v$ maps to
$v_1 \otimes v_2 \otimes \cdots \otimes v_0$ along the top of the diagram.
Let $\alpha_i \in \EEx$ represent $((F^i)^*\phi)_x$ with respect to these bases and let $\alpha$ be
the trace of $\phi_{\Nm(x)}$.  We may now equate the trace $\alpha$ of $\phi$ on $\gqcs{L}_{\Nm(x)}$
with the product $\alpha_0 \cdots \alpha_{n-1}$, which is the trace of $\phi_{k'}$ on $\gqcs{L}_x$.
\end{proof}

Finally, let $G'$ be a smooth commutative group scheme over $k'$.
We explain how to geometrize the canonical isomorphism between characters of $G'(k')$ and of $(\Res_{k'/k}G')(k)$.
We may decompose the base change $(\Res_{k'/k}G')_{k'}$ of $\Res_{k'/k}G'$ to $k'$
into a product of copies of $G'$, indexed by elements of $\Gal(k'/k)$:
\[
(\Res_{k'/k}G')_{k'} \cong \prod_{\Gal(k'/k)} G'.
\]
Since products and coproducts agree for group schemes we have a natural inclusion of $k'$-schemes
\[
G' \hookrightarrow (\Res_{k'/k}G')_{k'}
\]
mapping $G'$ into the summand corresponding to $1 \in \Gal(k'/k)$.  Composing $\nu_{k'/k}$
from Proposition~\ref{prop:basechange} with pullback along this map yields a functor
\[
\rho : \QC(\Res_{k'/k}G') \to \QC(G').
\]

\begin{proposition}
Let $k'/k$ be a finite extension and let $G'$ be a smooth commutative group scheme over $k'$.
Then the functor 
\[
\rho : \QC(\Res_{k'/k}G') \to \QC(G'),
\]
defined above, induces
\[
\begin{tikzcd}
\QCiso{\Res_{k'/k} G'} \dar{\TrFrob{\Res_{k'/k} G'}} \rar{\rho} & \QCiso{G'} \dar{\TrFrob{G'}}\\
G'(k')^* \rar & G'(k')^*,
\end{tikzcd}
\]
where the bottom map is the identity.
\end{proposition}
\begin{proof}
By Lemma~\ref{lem:pullback} the pullback part of the definition of $\rho$ corresponds to the map
\[
(\Res_{k'/k}G')(k') \to G'(k')^*
\]
induced by $g \mapsto (g, 1, \ldots, 1)$.  Since the action of $\Gal(k'/k)$ on
\[
(\Res_{k'/k}G')_{k'} \cong \prod_{\Gal(k'/k)} G'
\]
is given by permuting coordinates, composition with the norm map yields the identity on $G'(k')$.
\end{proof}

%\todo{Can we improve on this result by proving that $\rho$ is an equivalence of categories?}


\section{Applications}\label{sec:applications}% to algebraic tori and abelian varieties over \texorpdfstring{$p$}{p}-adic fields}

Let $K$ be a local field (in the sense of Serre) with residue field $\Fq$. 
In this section we consider connected commutative algebraic groups over $K$ that admit a N\'eron model, by which we mean a locally of finite type N\'eron model.
By \cite{bosch-lutkebohmert-reynaud:NeronModels}*{\S 10.2, Thm 2}, these are precisely the connected commutative algebraic groups over $K$ that contain no subgroup of type $\mathbb{G}_\text{a}$.
These algebraic groups over $K$ form an additive category, denoted by $\mathcal{N}_K$ below, in a natural way, as a full subcategory of connected commutative algebraic groups over $K$. This category includes algebraic tori over $K$, abelian varieties over $K$ and unipotent $K$-wound groups.

\subsection{Quasicharacters}

Let $R$ be the ring of integers of $K$.
Write $\m$ for the maximal ideal of $R$ and set $R_n = R/\m^{n+1}$, for every non-negative integer $n$.
Suppose $X_K \in \mathcal{N}_K$ with N\'eron model $X$ over $R$.
Note that $X(K) = X(R)$.
A {\it quasicharacter of $X(K)$} is a group homomorphism $X(K) \to \EEx$ that factors through $X(R) \to X(R_n)$, for some non-negative integer $n$;
the group of quasicharacters of $X(K)$ will be denoted by 
\[
\Hom_\text{qc}(X(K),\EEx)
\]
 and the subgroup of those that factor through $X(R_n)$ will be denoted by 
 \[
 \Hom_n(X(K),\EEx).
\]
In this section we will see how to geometrize and categorify quasicharacters of $X(K)$ using quasicharacter sheaves.

\subsection{Review of the Greenberg transform} \label{ssec:rev_Greenberg}

Let $K$, $R$ and $R_n$ be as above.
We will need the Greenberg functor, which provides
a functor from the category of schemes 
over $R_n$, for each $n\in \NN$, to the category of schemes over $\Fq$.
See \cite{bertrapelle-gonzales:Greenberg} for the definition and fundamental properties of the Greenberg functor as we use it; other important references include
\cite{greenberg:61}, \cite{greenberg:63a},
\cite{demazure-gabriel:GroupesAlgebriques}*{V, \S 4, no. 1},
\cite{bosch-lutkebohmert-reynaud:NeronModels}*{Ch. 9, \S 6},
\cite{nicaise-sebag:motivicSerre}*{\S 2.2}. %citelist
%
For any non-negative integer $n$ we will write
\[
\Gr^R_n : \Sch{R} \to \Sch{\Fq}
\]
for the functor produced by composing pullback along $\Spec{R_n} \to \Spec{R}$ with the Greenberg functor. 
This functor respects open immersions, closed immersions, \'etale morphisms, smooth morphisms and geometric components.  Moreover, there is a canonical isomorphism
\[
\Gr^R_n(X)(\Fq) \iso X(R_n)
\]
for any scheme $X$ over $R$.

For any $n\leq m$,  the surjective ring homomorphism $R_{m} \to R_n$ determines a
natural transformation 
\[
\varrho^R_{n\leq m} : \Gr^R_{m} \to \Gr^R_n
\]
between additive functors.
Crucially, $\varrho^R_{n\leq m}(X): \Gr^R_{m}(X)\to \Gr^R_n(X)$ is an affine morphism of $\Fq$-schemes, for every $R$-scheme $X$ and every $n\leq m$ \cite{bertrapelle-gonzales:Greenberg}*{Prop 4.3}.
This observation is key to the proof that, for any scheme $X$ over $R$, the projective limit 
\[
\Gr_R(X) \ceq \varprojlim_{n\in \NN} \Gr^R_n(X),
\]
taken with respect to the surjective morphisms $\varrho^R_{n\leq m}(X) : \Gr^R_{m}(X) \to \Gr^R_n(X)$,
exists in the category of group schemes over $\Fq$.
This leads to the definition of what we shall call the {\it Greenberg transform}:
\[
\Gr_R : \Sch{R} \to \Sch{\Fq}.
\]
By construction, the $\Fq$-scheme $\Gr_R(X)$ comes equipped with morphisms 
\[
\varrho^R_n(X) : \Gr^R(X) \to \Gr^R_n(X),\qquad \forall n\in \NN.
\]

\subsection{Quasicharacter sheaves on the Greenberg transform of a N\'eron model} \label{ssec:qc_on_GN}
 
Let $X_K \in \mathcal{N}_K$ and $X$ be as above.
Set $S = \Spec{R}$ and $S_n = \Spec{R_n}$;
% for every non-negative integer $n$;
note that $S_0 = \Spec{\Fq}$ is the special fibre of $S$.

For every non-negative integer $n$, $\Gr^R_n(X)$ is a {\it smooth} commutative group scheme over $S_0$
with component group scheme $\pi_0(X) \times_S S_0$ and $\Fq$-rational points $X(R_n).$
%
The Greenberg transform $\Gr_R(X)$ of $X$ is a commutative group scheme over $\Fq$
with component group scheme $\pi_0(X) \times_S S_0$
and $\Fq$-rational points $X(K).$
However, $\Gr_R(X)$ is not locally of finite type and therefore not smooth.
%
The morphism of $\Fq$-schemes $\varrho^R_n(X) : \Gr_R(X) \to \Gr^R_n(N)$ induces a functor
\[
\varrho^R_n(X)^* : \QC(\Gr^R_n(X)) \to \QC(\Gr_R(X)),
\]
as in Lemma~\ref{lem:pullback}.
%This functor is faithful, so we may view $\QC(\Gr^R_n(X))$ as a subcategory of $\QC(\Gr_R(X))$.

We now define a category which will geometrize quasicharacters of $X(K)$.
We begin by considering the rigid monoidal category $\QC(\Gr_R(X))$ defined in Section~\ref{ssec:category} without insisting that the commutative group scheme is smooth.

\begin{definition}
A {\it quasicharacter sheaf for $X_K$} is an object of
the following rigid monoidal subcategory of $\QC(\Gr_R(X))$, denoted by $\QC(X_K)$:
\begin{enumerate}
\item
objects in $\QC(X_K)$ are the $\ell$-adic sheaves $\varrho^R_n(X)^*\qcs{L}$, for $n\in \NN$ and $\qcs{L} \in \QC(\Gr^R_n(X))$; 
\item
morphism $\varrho^R_n(X)^*\qcs{L} \to \varrho^R_m(X)^*\qcs{L}'$ in $\QC(X_K)$ are those morphisms in $\QC(\Gr_R(X))$ which take the form $\varrho^R_m(X)^*\rho$ for $\rho \in \Hom(\varrho^R_{n\leq m}(X)^*\qcs{L},\qcs{L}')$ when $n\leq m$, and $\varrho^R_n(X)^*\rho$ for $\rho \in \Hom(\qcs{L},\varrho^R_{m\leq n}(X)^*\qcs{L}')$ when $m\leq n$.
\end{enumerate}

\end{definition}


\begin{remark}
If $\varrho^R_n(X)^* : \QC(\Gr^R_n(X)) \to \QC(\Gr_R(X))$ is full then the construction above can be improved by forming $\QC(X_K)$ from the essential images of the functors $\varrho^R_n(X)^*$; however, we do not know if $\varrho^R_n(X)^*$ is full.
\end{remark}

\begin{remark}
We offer the following alternate construction of $\QC(X_K)$, which does not make use of subcategories.
For objects, one considers triples 
\[
\qcs{F} \ceq (n, \{\qcs{F}_i\}_{n\leq i}, \{\alpha_{i \le j}\}_{n\le i \le j}),
\] where $n$
is a non-negative integer, each $\qcs{F}_i$ is a quasicharacter sheaf on $\Gr^R_i(X)$ and each 
\[
\alpha_{i \le j} : \qcs{L}_j \to \varrho^R_{i \le j}(X)^* \qcs{L}_i
\]
 is an isomorphism; here $\alpha_{i \le i}$ is the identity and the $\alpha_{i \le j}$ are compatible with each other.  
If $\qcs{F} \ceq (n, \{\qcs{F}_i\}, \{\alpha_{i \le j}\})$
and $\qcs{F}' \ceq (m, \{\qcs{F}'_i\}, \{\alpha'_{i \le j}\})$ are objects then $\Hom(\qcs{F}, \qcs{F}')$ is the set
of equivalence classes of pairs $(k, \{\beta_i\}_{k \le i})$, where $n,m \le k$ and the $\beta_i : \qcs{F}_i \to \qcs{F}'_i$ are
morphisms of quasicharacter sheaves so that
\[
\begin{tikzcd}
\qcs{F}_j \rar{\alpha_j} \dar{\beta_i} & \varrho^R_{i \le j}(X)^* \qcs{F}_i \dar{f_{i \le j}^*\beta_j} \\
\qcs{F}'_j \rar{\alpha_j} & \varrho^R_{i \le j}(X)^* \qcs{L}'_i
\end{tikzcd}
\]
commutes for all $k\le i\le j$; we identify two such pairs $(k, \{\beta_i\})$ and $(l, \{\gamma_i\})$ if $\beta_i = \gamma_i$
for sufficiently large $i$.  Identities and composites are defined in the natural way.
\end{remark}


\begin{theorem}\label{thm:QCXK}
Let $K$ and $R$ be as above. 
\begin{enumerate}
\item
The trace of Frobenius provides a natural transformation between the additive functors
\[
F_{\QC}: X_K \mapsto \QCiso{X_K}
\qquad\text{and}\qquad
F_{\text{qc}}: X_K \mapsto \Hom_{\text{qc}}(X(K),\EEx)
\]
as functors from $\mathcal{N}_K$ to the category of abelian groups.
\end{enumerate} 
Regarding this natural transformation, for every $X_K \in \mathcal{N}_K$ with N\'eron model $X$:
\begin{enumerate}[resume]
\item there is a canonical short exact sequence of abelian groups 
\[
0 \to \Hh^2(\pi_0(X)_{\bFq},\EEx)^{\Weil{}} \to \QCiso{X_K} \to \Hom_\text{qc}(X(K),\EEx) \to 0;
\] 
\item for all quasicharacter sheaves $\qcs{F}$, $\qcs{F}'$ on $\Gr_R(X)$, and for every $\rho \in \Hom(\qcs{F},\qcs{F}')$, either $\rho$ is trivial or $\rho$ is an isomorphism;
\item for all quasicharacter sheaves $\qcs{F}$ on $\Gr_R(X)$ there is a canonical isomorphism
\[
\Aut(\qcs{F}) \iso \Hom((\pi_0(X)_{\bFq})_{\Weil{}},\EEx).
\]
\end{enumerate}
\end{theorem}

\begin{proof}
For part (i), use Proposition~\ref{prop:functorialG} with $G = \Gr^R_n(X)$, the fact that N\'eron models are unique up to isomorphism, the fact that each $\QC(\Gr^R_n(X))$ is a full subcategory of $\QC(X_K)$ and the observation that $\QC(X_K)$ a `union' of the subcategories $\QC(\Gr^R_n(X))$ in $\QC(\Gr_R(X))$.
For part (ii), use Theorem~\ref{thm:snake} with $G = \Gr^R_n(X)$ and then argue as in part (i).
For part (iii), argue as in the proof of Lemma~\ref{lem:autornaught}.
For part (iv), use Theorem~\ref{thm:autornaught} with $G = \Gr^R_n(X)$, the fact that the component group of $\Gr^R_n(X)$ is independent of $n$ and then argue as in part (i).
\end{proof}

\subsection{Quasicharacters for $p$-adic tori} \label{ssec:qc_tori}

As we explained in the Introduction, our original motivation for this paper was to find a geometrization and categorification of quasicharacters of $p$-adic tori. This is is now provided by specializing Theorem~\ref{thm:QCXK} to the case when $X_K= T\in \mathcal{N}_K$ is an algebraic torus over $K$, in which case we write $\underline{T}$ for the Neron model $X$. Now,
\[
 \pi_0(\underline{T})_{\bFq} = X_*(T)_{\mathcal{I}_K},
\]
where $X_*(T)$ is the cocharacter lattice of $T$ and $\mathcal{I}_K$ is the inertia group for $K$ \cite{bitan:discriminant}*{Eq 3.1}. 
Accordingly, the short exact sequence in Theorem~\ref{thm:QCXK} becomes
\begin{equation}
0 \to \Hh^2(X_*(T)_{\mathcal{I}_K},\EEx)^{\Weil{}} \to \QCiso{T} \to \Hom_\text{qc}(T(K),\EEx) \to 0.
\end{equation}
Again by Theorem~\ref{thm:QCXK}, the automorphism groups in the $\QC(T)$ are given, for every quasicharacter sheaf $\qcs{F}$ for $T$, by
\begin{equation}
\Aut(\qcs{F}) \iso \Hom(X_*(T)_{\Weil{K}},\EEx) \iso \Hom(X_*(T),\EEx)^{\Weil{K}} = (\check{T}_\ell)^{\Weil{K}}
\end{equation}
where $\Weil{K}$ is the Weil group for $K$ and $\check{T}_\ell$ is the $\ell$-adic dual torus to $T$.



\subsection{Weil restriction and quasicharacters}\label{ssec:wrK}

Let $K'/K$ be a finite Galois extension of local fields and
let $k'/k$ be the corresponding extension of residue fields.
Let $R$ and $R'$ be the rings of integers of $K$ and $K'$, respectively.
Let $X_K$ be a connected commutative algebraic group over $K$
that admits a N\'eron model $X$ over $R$.
Set $X_{K'} \ceq X_K \times_\Spec{K} \Spec{K'}$
Let $X'$ be a N\'eron model for $X_{K'}$.

\begin{proposition}\label{prop:wrK}
The canonical closed immersion 
\[
X_K \hookrightarrow \Res_{K'/K} X_{K'}
\]
of $K$-group schemes
induces a map of $\Fq$-group schemes 
\[
f : \Gr_R(X) \to \Res_{k'/k} \Gr_{R'}(X')
\] 
which, through quasicharacter sheaves, induces
\[
\begin{tikzcd}[column sep=60]
\Hom_{\text{qc}}(X(K'), \EEx) \arrow{r}{\chi \mapsto \chi\vert_{X(K)}} &\Hom_{\text{qc}}(X(K), \EEx).
\end{tikzcd}
\]
\end{proposition}

\begin{proof}
Adapting the argument in \cite{bosch-lutkebohmert-reynaud:NeronModels}*{\S 7.6, Prop 6} to include locally finite type N\'eron models,
one may show that $\Res_{R'/R}(X')$ is a N\'eron model for $\Res_{K'/K}(X_{K'})$.
Thus, by the N\'eron mapping property, the canonical closed immersion
\[
X_K\hookrightarrow \Res_{K'/K}(X_{K'})
\]
 extends uniquely to a morphism
\begin{equation}\label{me}
X\to \Res_{R'/R}(X')
\end{equation}
 of smooth $R$-group schemes.
%
Applying the functor $\Gr^R_{n}$ to \eqref{me}
and using \cite{bertrapelle-gonzales:Greenberg}*{Thm 1.1} defines the morphism of smooth group schemes
\begin{equation}\label{men}
f_n: \Gr_{n-1}^R(X) \to \Res_{k'/k} \Gr_{en-1}^{R'}(X'),
\end{equation}
where $e$ is the ramification index of $K'/K$.
Using Lemma~\ref{lem:pullback}, \eqref{men} induces a functor 
\begin{equation}\label{men-pulled}
f_n^* : \QC(\Res_{k'/k} \Gr_{en-1}^{R'}(X'))\to \QC(\Gr_{n-1}^{R}(X)).
\end{equation}
Since 
\[
\left(\Res_{k'/k} \Gr_{en-1}^{R'}(X') \right)(\Fq) = \left(\Gr_{en-1}^{R'}(X')\right)(k'),
\]
it follows from Lemma~\ref{lem:pullback} that the pullback functor \eqref{men-pulled} actually induces
\[
\Hom(X'(R'_{en-1}),\EEx)  \to  \Hom(X(R_{n-1}),\EEx) .
\]
Since $X'$ is a N\'eron model for $X_{K'}$ and $X$ is a N\'eron model for $X_K$,
 this may be re-written as
\[ 
\Hom_{en-1}(X(K'),\EEx) \to \Hom_{n-1}(X(K)),\EEx)
\]
Passing to limits now defines
\[ 
\Hom_\text{qc}(X(K'),\EEx) \to \Hom_\text{qc}(X(K)),\EEx)
\]
Argue as in Proposition~\ref{prop:csbe} to see that this is indeed restriction of characters.
\end{proof}

\subsection{Transfer of quasicharacters}\label{ssec:transfer}

Let $K$ and $L$ be local fields with rings of integers $\OK$ and $\OL$, respectively. 
Pick uniformizers $\varpi_K$ and $\varpi_L$ for $\OK$ and $\OL$, respectively;
what follows will not depend on these choices.

Suppose $X_K\in \mathcal{N}_K$ with N\'eron model $X$ and $Y_{L}\in \mathcal{N}_L$ with N\'eron model $Y$.
Suppose $m$ is a positive integer such that 
\[
\OK/\varpi_K^{m}\OK \iso \OL/\varpi_L^{m}\OL.
\]
%(in which case $K$ and $L$ are said to be $m$-close).
Suppose also that
\begin{equation}\label{eq:schematic_transfer}
X \times_{\Spec{\OK}} \Spec{\OK/\varpi_K^{m}\OK} \iso Y \times_{\Spec{\OL}} \Spec{\OL/\varpi_L^{m}\OL}
\end{equation}
as smooth group schemes over $\OK/\varpi_K^{m}\OK$. 
Then
$
\Gr^{\OK}_{m-1}(X) \iso \Gr^{\OL}_{m-1}(Y)
$
as smooth group schemes over $\Fq$; accordingly, by Lemma~\ref{lem:pullback} the isomorphism above determines an equivalence of categories
\begin{equation}\label{eq:categorical_transfer}
\QC(\Gr^{\OK}_{m-1}(X)) \cong \QC(\Gr^{\OL}_{m-1}(Y))
\end{equation}
which induces an isomorphism
\begin{equation}\label{eq:transfer}
\Hom_{m-1}(X(K),\EEx)  \iso  \Hom_{m-1}(Y(L),\EEx).
\end{equation}
The isomorphism \eqref{eq:transfer} is an instance of {\it transfer} of (certain) quasicharacters between $X(K)$ and $Y(L)$. 
We now recognize this transfer of quasicharacters as a consequence of the equivalence of categories of quasicharacter sheaves \eqref{eq:categorical_transfer}.

The isomorphism \eqref{eq:schematic_transfer} can indeed exist between quasicharacters of algebraic tori over local fields, even when the characteristics of $K$ and $L$ differ.
Suppose $T_K$ and $M_L$ are tori over non-archimedian local fields $K$ and $L$,
splitting over $K'$ and $L'$ respectively.
Then $T_K$ and $M_L$ are said to be \emph{$n$-congruent} \cite{chai-yu:01a}*{\S 2} if there are isomorphisms
 \begin{align*}
  \alpha : \OO{K'}/\varpi_K^n \OO{K'} &\to \OO{L'}/\varpi_{L}^n \OO{L'} \\
  \beta : \Gal(K'/K) &\to \Gal(L'/L) \\
  \phi : X^*(T_K) &\to X^*(M_L)
 \end{align*}
 satisfying the conditions
 \begin{enumerate}
  \item $\alpha$ induces an isomorphism $\OK/\pi_K^n \OK \to \OO{L}/\pi_{L}^n \OO{L}$,
  \item $\alpha$ is $\Gal(K'/K)$-equivariant relative to $\beta$, and
  \item $\phi$ is $\Gal(K'/K)$-equivariant relative to $\beta$.
 \end{enumerate}
If $T_K$ and $M_L$ are $n$-congruent then $\alpha$, $\beta$ and $\phi$ determine an isomorphism 
\begin{equation}\label{transfer}
  \Hom_{n-1}(T_K(K), \EEx) \iso \Hom_{n-1}(M_L(M),\EEx).
\end{equation}
Note that if $T_K$ and $M_L$ are $n$-congruent, then they are $m$-congruent for every
$m \leq n$.
%the isomorphism \eqref{transfer} is level-preserving at integers less than $N$.
%

Now let $T$ be a N\'eron model for $T_K$ and let $M$ be a N\'eron model for $M_L$.
One of the main results of \cite{chai-yu:01a} gives an isomorphism of group schemes 
\[
T \times_{\Spec{\OK}} \Spec{\OK/\varpi_K^n\OK} \iso M \times_{\Spec{\OL}} \Spec{\OL/\varpi_L^n\OL}
\] 
assuming that $T_K$ and $M_L$ are sufficiently congruent.
They define a quantity $h$ (the smallest integer so that $\varpi^h$ lies in the
Jacobian ideal associated to a natural embedding of $T_K$ into an induced torus \cite{chai-yu:01a}*{\S 8.1}) and show  that if $n > 3h$ and $T_K$ and $M_L$ are $n$-congruent then there is a canonical isomorphism of smooth group schemes
 $
\Gr_{n-3h-1}(T) \to \Gr_{n-3h-1}(M)
 $
 determined by $\alpha, \beta$ and $\phi$ \cite{chai-yu:01a}*{Thm. 8.5}.
Combining this with the paragraph above gives the following instance of the geometrization and categorification of the transfer of quasicharacters.

\begin{proposition}\label{prop:transfer}
 With notation above, suppose that $T_K$ and $M_L$ are $n$-congruent and $n > 3h$.  Set $m = n-3h$.
 Then there is a canonical equivalence of categories
 \[
 \QC(\Gr^{\OK}_{m-1}(T)) \iso \QC(\Gr^{\OL}_{m-1}(M))
 \]
 determined by $\alpha, \beta$ and $\phi$ inducing an isomorphism
 \[
\Hom_{m-1}(T_K(K), \EEx) \iso  \Hom_{m-1}(M_L(L), \EEx)
 \]
compatible with \eqref{transfer}.% ($m < N$).
\end{proposition}


\acknowl{We thank Masoud Kamgarpour, Pramod Achar and Hadi Salmasian
for allowing us to hijack much of our Research in Teams meeting at BIRS into a discussion of
quasicharacter sheaves; their knowledge and help have been invaluable.
We thank Takashi Suzuki for some very helpful observations and suggestions, especially related to our use of the Hochschild-Serre spectral sequence.
We thank Joseph Bernstein for suggesting a connection between our category of quasicharacter sheaves for $p$-adic tori and quasicharacters of its pure rational forms.
We thank Alessandra Bertrapelle and Cristian Gonz\'ales-Avil\'es for disabusing us of a misapprehension concerning the Greenberg realization functor and drawing our attention to their result on Weil restriction and the Greenberg transform.
}


%-------------------------------------------------------------------------%
% GENERAL INSTRUCTIONS                                                    %
% Please keep formatting macros to a minimum.                             %
% Avoid redundant source code such as unused definitions or longer        %
% passages of comments (% or {comment}).                                  %
% Do not worry about bad page breaks, etc. and avoid adding extra space   %
% and using glue to improve the appearance of the manuscript.             %
% Please ensure that the material has been carefully proofread and that   %
% all files used are made available to the editors/publisher.             %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% PACKAGES                                                                %
% Missing packages can be downloaded at www.tug.org/ctan.html.            %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% MULTILINE EQUATIONS                                                     %
% For numbered/unnumbered multiline equations use align/align* instead of %
% eqnarray. (Other available environments for multiline displays are      %
% gather, multline, aligned, split, etc.)                                 %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% QED SYMBOL                                                              %
% The \qedhere command forces the QED symbol to go on the present line,   %
% which might be useful if the last part of a proof environment is, e.g., %
% a displayed equation or list environment.                               %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% SOME MORE MATH                                                          %
% -- Avoid blank lines before or after a display, unless you really want  %
%    to start a new paragraph.                                            %
% -- Use equation*, gather* or the bracket pair \[ and \] instead of      %
%    double dollar signs $$.                                              %
% -- Use \operatorname{...} for math operators that are not predefined    %
%    or define new operators with \DeclareMathOperator. lim-like          %
%    operators can be defined with \DeclareOperator*                      %
% -- Use \quad for spacings in displayed formulas.                        %
% -- Use \substack{... \\ ...} for multiline subscripts on, e.g., sums.   %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% ENUMERATIONS                                                            %
% By default, the labels of first level enumerations are (i), (ii), etc.  %
% You may change them to become, e.g., A., B. etc., using an optional     %
% argument: \begin{enumerate}[A.]                                         %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% FIGURES AND TABLES                                                      %
% You may include a figure writing                                        %
% \begin{figure}[t]                                                       %
%   \includegraphics[width=.8\textwidth]{xxx.yyy}                         %
%   \caption{Caption.}\label{fig:zzz}                                     %
% \end{figure}                                                            %
% A table is included similar using the table environment.                %
% Sub-captions are created as follows:                                    %
% \begin{figure}[t]                                                       %
%   \subfloat[Caption a]{\includegraphics[width=.45\textwidth]{...}}      %
%   \hfill                                                                %
%   \subfloat[Caption b]{\includegraphics[width=.45\textwidth]{...}}      %
%   \caption{Caption.}                                                    %
% \end{figure}                                                            %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% QUOTATION MARKS                                                         %
% Double quotation marks are produced using `` and ''. The opening quote  %
% then looks like a superscript 66 and the closing quote like a           %
% superscript 99.                                                         %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% HYPHEN VS. DASH                                                         %
% The hyphen (-) is used for compound words like $n$-dimensional.         %
% (Don't write things like $n-$dimensional!)                              %
% The en-dash (--) is used for number ranges and it can stand for `and',  %
% e.g., between two names: ``Various generalizations of the               %
% Cauchy--Schwarz inequality are presented on pages 63--67.''             %
% To partition a sentence one may use the em-dash (---) with no space     %
% on either side; we prefer the en-dash with a blank on both sides.       %
% The mathematical minus sign is produced by a single - within            %
% mathematics mode.                                                       %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% REFERENCES                                                              %
% Use \label and \ref for all cross-references to equations, figures,     %
% tables, sections, subsections, etc.                                     %
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% BIBLIOGRAPHY                                                            %
% References should be collected at the end of the paper and numbered in  %
% alphabetical order of the authors' names. Titles of journals should be  %
% abbreviated as in Mathematical Reviews. Please do not use small caps    %
% for the names of the authors. The preferred style is shown in the       %
% examples below.                                                         %
% Refer to the bibliography entries using \cite commands.                 %
% Using BibTeX, you simply have to add the names of your databases as     %
%   \bibliography{mydatabase}                                             %
% The file crelle.bst then ensures the correct style.                     %
%-------------------------------------------------------------------------%
%\bibliographystyle{amsalpha}
\bibliography{bibliography/Biblio}   



\end{document}